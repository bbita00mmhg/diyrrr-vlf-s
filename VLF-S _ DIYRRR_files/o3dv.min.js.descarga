var OV=(()=>{var Gi=Object.defineProperty;var Un=Object.getOwnPropertyDescriptor;var zn=Object.getOwnPropertyNames;var Hn=Object.prototype.hasOwnProperty;var _n=o=>Gi(o,"__esModule",{value:!0});var kn=(o,e)=>{for(var t in e)Gi(o,t,{get:e[t],enumerable:!0})},jn=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of zn(e))!Hn.call(o,i)&&(t||i!=="default")&&Gi(o,i,{get:()=>e[i],enumerable:!(r=Un(e,i))||r.enumerable});return o};var Wn=(o=>(e,t)=>o&&o.get(e)||(t=jn(_n({}),e,1),o&&o.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var Xn={};kn(Xn,{AddCheckbox:()=>Dn,AddCoord2D:()=>Yi,AddCoord3D:()=>Ur,AddDiv:()=>Mr,AddDomElement:()=>Ye,AddRangeSlider:()=>Vn,AddSelect:()=>Pn,AddToggle:()=>On,ArrayBufferToAsciiString:()=>Zi,ArrayBufferToUtf8String:()=>K,ArrayToColor:()=>Br,ArrayToCoord3D:()=>Ae,ArrayToQuaternion:()=>$e,AsciiStringToArrayBuffer:()=>Qi,Base64DataURIToArrayBuffer:()=>ot,BezierTweenFunction:()=>rn,BigEps:()=>Ot,BinaryReader:()=>de,BinaryWriter:()=>Be,BoundingBoxCalculator3D:()=>Kt,Box3D:()=>bt,CalculateSurfaceArea:()=>yn,CalculateTriangleNormal:()=>at,CalculateVolume:()=>En,Camera:()=>Ne,CameraIsEqual3D:()=>hi,CheckModel:()=>hn,ClearDomElement:()=>bn,ClickDetector:()=>Mi,Color:()=>N,ColorComponentFromFloat:()=>ue,ColorFromFloatComponents:()=>Pe,ColorIsEqual:()=>ke,ColorToHexString:()=>Or,ConvertColorToThreeColor:()=>fe,ConvertMeshToMeshBuffer:()=>Mt,ConvertModelToThreeObject:()=>pi,ConvertThreeColorToColor:()=>Rt,ConvertThreeGeometryToMesh:()=>qe,Coord2D:()=>F,Coord3D:()=>M,Coord4D:()=>Me,CoordDistance2D:()=>Ut,CoordDistance3D:()=>pe,CoordIsEqual2D:()=>we,CoordIsEqual3D:()=>ce,CopyObjectAttributes:()=>xt,CreateDiv:()=>Bn,CreateDomElement:()=>Ti,CreateModelUrlParameters:()=>In,CreateObjectUrl:()=>lt,CreateObjectUrlWithMimeType:()=>_t,CreateUrlBuilder:()=>Li,CreateUrlParser:()=>Mn,CrossVector3D:()=>ve,DegRad:()=>Ke,Direction:()=>v,DotVector3D:()=>Ht,EmbeddedViewer:()=>Ai,Eps:()=>qi,ExportedFile:()=>W,Exporter:()=>Ri,Exporter3dm:()=>kt,ExporterBase:()=>ie,ExporterGltf:()=>jt,ExporterModel:()=>Wt,ExporterObj:()=>qt,ExporterOff:()=>Xt,ExporterPly:()=>Yt,ExporterSettings:()=>Xr,ExporterStl:()=>Jt,FaceMaterial:()=>zt,File:()=>vt,FileFormat:()=>B,FileList:()=>At,FileSource:()=>Y,FinalizeModel:()=>ri,FlipMeshTrianglesOrientation:()=>qr,GenerateCone:()=>or,GenerateCuboid:()=>ii,GenerateCylinder:()=>ni,GeneratePlatonicSolid:()=>oi,GenerateSphere:()=>si,Generator:()=>ht,GeneratorHelper:()=>sr,GeneratorParams:()=>Nt,GetBoundingBox:()=>Fi,GetDefaultCamera:()=>bi,GetDomElementClientCoordinates:()=>Je,GetDomElementExternalHeight:()=>xi,GetDomElementExternalWidth:()=>gi,GetDomElementInnerDimensions:()=>Ci,GetDomElementOuterHeight:()=>Rn,GetDomElementOuterWidth:()=>Gn,GetExternalLibPath:()=>Pt,GetFileExtension:()=>Ve,GetFileExtensionFromMimeType:()=>Qe,GetFileName:()=>J,GetIntegerFromStyle:()=>Z,GetMeshType:()=>et,GetShadingType:()=>ti,GetShadingTypeOfObject:()=>Hi,GetTetrahedronSignedVolume:()=>Bi,GetTopology:()=>Ni,GetTriangleArea:()=>Oi,HasDefaultMaterial:()=>on,HasHighpDriverIssue:()=>ei,HexStringToColor:()=>Ji,ImportError:()=>ft,ImportErrorCode:()=>He,ImportResult:()=>ai,ImportSettings:()=>xr,Importer:()=>Cr,Importer3dm:()=>er,Importer3ds:()=>tr,ImporterBase:()=>H,ImporterFileAccessor:()=>ui,ImporterGltf:()=>ir,ImporterIfc:()=>nr,ImporterO3dv:()=>lr,ImporterObj:()=>ar,ImporterOff:()=>ur,ImporterPly:()=>hr,ImporterStl:()=>dr,ImporterStp:()=>fr,ImporterThree3mf:()=>gr,ImporterThreeBase:()=>Xe,ImporterThreeDae:()=>cr,ImporterThreeFbx:()=>mr,ImporterThreeSvg:()=>Pi,ImporterThreeWrl:()=>pr,Init3DViewerElement:()=>_i,Init3DViewerElements:()=>Ln,InsertDomElementAfter:()=>Sn,InsertDomElementBefore:()=>wn,IntegerToHexString:()=>re,IsDefined:()=>gt,IsDomElementVisible:()=>An,IsEqual:()=>P,IsEqualEps:()=>Bt,IsGreater:()=>Pr,IsGreaterOrEqual:()=>Et,IsLower:()=>Ct,IsLowerOrEqual:()=>Tt,IsModelEmpty:()=>Gt,IsNegative:()=>_e,IsPositive:()=>ye,IsPowerOfTwo:()=>Di,IsSolid:()=>sn,IsZero:()=>nt,LinearToSRGB:()=>st,LinearTweenFunction:()=>nn,LoadExternalLibrary:()=>ae,MaterialBase:()=>Lr,MaterialType:()=>$,Matrix:()=>L,MatrixIsEqual:()=>Wr,MeasureTool:()=>ki,Mesh:()=>j,MeshBuffer:()=>_r,MeshInstance:()=>Ft,MeshInstanceId:()=>tt,MeshPrimitiveBuffer:()=>Hr,MeshType:()=>Le,Model:()=>$t,ModelObject3D:()=>We,ModelToThreeConversionOutput:()=>Er,ModelToThreeConversionParams:()=>Tr,MouseInteraction:()=>Ei,NameFromLine:()=>ze,Navigation:()=>Ir,NavigationType:()=>le,NextPowerOfTwo:()=>fn,Node:()=>Ce,NodeType:()=>Ge,Object3D:()=>$r,Octree:()=>Zt,OctreeNode:()=>wt,ParabolicTweenFunction:()=>Yr,ParameterConverter:()=>X,ParameterListBuilder:()=>fi,ParameterListParser:()=>di,ParametersFromLine:()=>Re,PhongMaterial:()=>q,PhysicalMaterial:()=>je,Property:()=>ne,PropertyGroup:()=>Ie,PropertyType:()=>he,Quaternion:()=>ge,QuaternionFromAxisAngle:()=>jr,QuaternionFromXYZ:()=>en,QuaternionIsEqual:()=>$i,RadDeg:()=>Xi,ReadFile:()=>Dr,ReadLines:()=>be,ReplaceDefaultMaterialColor:()=>ln,RequestUrl:()=>Nr,RevokeObjectUrl:()=>kr,RunTaskAsync:()=>Vt,RunTasks:()=>Ar,RunTasksBatch:()=>Gr,SRGBToLinear:()=>Oe,SetDomElementHeight:()=>zi,SetDomElementOuterHeight:()=>Nn,SetDomElementOuterWidth:()=>Fn,SetDomElementWidth:()=>Ui,SetExternalLibLocation:()=>Wi,SetThreeMeshPolygonOffset:()=>Ii,ShadingModel:()=>vi,ShadingType:()=>se,ShowDomElement:()=>vn,SubCoord2D:()=>Lt,SubCoord3D:()=>ee,TaskRunner:()=>Dt,TextWriter:()=>xe,TextureIsEqual:()=>Ki,TextureMap:()=>Se,TextureMapIsEqual:()=>Ze,ThreeConversionStateHandler:()=>mi,ThreeModelLoader:()=>yr,ThreeNodeTree:()=>ci,Topology:()=>Qt,TopologyEdge:()=>Kr,TopologyTriangle:()=>Qr,TopologyTriangleEdge:()=>Zr,TopologyVertex:()=>Jr,TouchInteraction:()=>yi,TransformFileHostUrls:()=>Vr,TransformMesh:()=>Ue,Transformation:()=>k,TransformationIsEqual:()=>tn,TraverseThreeObject:()=>wi,Triangle:()=>z,TweenCoord3D:()=>St,UpVector:()=>Si,UpdateMaterialTransparency:()=>oe,Utf8StringToArrayBuffer:()=>It,ValueOrDefault:()=>Ee,VectorAngle3D:()=>zr,VectorLength3D:()=>yt,Viewer:()=>Sr,ViewerExtraGeometry:()=>wr,ViewerGeometry:()=>br,WaitWhile:()=>Rr});function gt(o){return o!=null}function Ee(o,e){return o??e}function xt(o,e){if(!!gt(o))for(let t of Object.keys(o))gt(o[t])&&(e[t]=o[t])}var Dt=class{constructor(){this.count=null,this.current=null,this.callbacks=null}Run(e,t){this.count=e,this.current=0,this.callbacks=t,e===0?this.TaskReady():this.RunOnce()}RunBatch(e,t,r){let i=0;e>0&&(i=parseInt((e-1)/t,10)+1),this.Run(i,{runTask:(n,s)=>{let l=n*t,a=Math.min((n+1)*t,e)-1;r.runTask(l,a,s)},onReady:r.onReady})}RunOnce(){setTimeout(()=>{this.callbacks.runTask(this.current,this.TaskReady.bind(this))},0)}TaskReady(){this.current+=1,this.current<this.count?this.RunOnce():this.callbacks.onReady&&this.callbacks.onReady()}};function Vt(o){setTimeout(()=>{o()},0)}function Ar(o,e){new Dt().Run(o,e)}function Gr(o,e,t){new Dt().RunBatch(o,e,t)}function Rr(o){function e(t){t()&&setTimeout(()=>{e(t)},1)}e(o)}var Fr=null,ji=new Set;function Wi(o){Fr=o}function Pt(o){return Fr===null?null:Fr+"/"+o}function ae(o){return new Promise((e,t)=>{if(Fr===null){t();return}if(ji.has(o)){e();return}let r=document.createElement("script");r.type="text/javascript",r.src=Pt(o),r.onload=()=>{ji.add(o),e()},r.onerror=()=>{t()},document.head.appendChild(r)})}var Y={Url:1,File:2,Decompressed:3},B={Text:1,Binary:2};function J(o){let e=o.lastIndexOf("/");e===-1&&(e=o.lastIndexOf("\\"));let t=o;e!==-1&&(t=o.substring(e+1));let r=t.indexOf("?");return r!==-1&&(t=t.substring(0,r)),decodeURI(t)}function Ve(o){let e=J(o),t=e.lastIndexOf(".");return t===-1?"":e.substring(t+1).toLowerCase()}function Nr(o,e){return new Promise((t,r)=>{let i=new XMLHttpRequest;if(i.open("GET",o,!0),e===B.Text)i.responseType="text";else if(e===B.Binary)i.responseType="arraybuffer";else{r();return}i.onload=function(){i.status===200?t(i.response):r()},i.onerror=function(){r()},i.send(null)})}function Dr(o,e){return new Promise((t,r)=>{let i=new FileReader;i.onloadend=function(n){n.target.readyState===FileReader.DONE&&t(n.target.result)},i.onerror=function(){r()},e===B.Text?i.readAsText(o):e===B.Binary?i.readAsArrayBuffer(o):r()})}function Vr(o){for(let e=0;e<o.length;e++){let t=o[e];if(t.search(/www\.dropbox\.com/u)!==-1){t=t.replace("www.dropbox.com","dl.dropbox.com");let r=t.indexOf("?");r!==-1&&(t=t.substring(0,r)),o[e]=t}else if(t.search(/github\.com/u)!==-1){t=t.replace("github.com","raw.githubusercontent.com"),t=t.replace("/blob","");let r=t.indexOf("?");r!==-1&&(t=t.substring(0,r)),o[e]=t}}}var qi=1e-8,Ot=1e-4,Xi=57.29577951308232,Ke=.017453292519943;function nt(o){return Math.abs(o)<1e-8}function Ct(o,e){return e-o>1e-8}function Pr(o,e){return o-e>1e-8}function Tt(o,e){return e-o>-1e-8}function Et(o,e){return o-e>-1e-8}function P(o,e){return Math.abs(e-o)<1e-8}function Bt(o,e,t){return Math.abs(e-o)<t}function ye(o){return o>1e-8}function _e(o){return o<-1e-8}var v={X:1,Y:2,Z:3};var F=class{constructor(e,t){this.x=e,this.y=t}Clone(){return new F(this.x,this.y)}};function we(o,e){return P(o.x,e.x)&&P(o.y,e.y)}function Yi(o,e){return new F(o.x+e.x,o.y+e.y)}function Lt(o,e){return new F(o.x-e.x,o.y-e.y)}function Ut(o,e){return Math.sqrt((o.x-e.x)*(o.x-e.x)+(o.y-e.y)*(o.y-e.y))}var N=class{constructor(e,t,r){this.r=e,this.g=t,this.b=r}Set(e,t,r){this.r=e,this.g=t,this.b=r}Clone(){return new N(this.r,this.g,this.b)}};function ue(o){return parseInt(Math.round(o*255),10)}function Pe(o,e,t){return new N(ue(o),ue(e),ue(t))}function Oe(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function st(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}function re(o){let e=parseInt(o,10).toString(16);for(;e.length<2;)e="0"+e;return e}function Or(o){let e=re(o.r),t=re(o.g),r=re(o.b);return e+t+r}function Ji(o){if(o.length!==6)return null;let e=parseInt(o.substring(0,2),16),t=parseInt(o.substring(2,4),16),r=parseInt(o.substring(4,6),16);return new N(e,t,r)}function Br(o){return new N(o[0],o[1],o[2])}function ke(o,e){return o.r===e.r&&o.g===e.g&&o.b===e.b}var Se=class{constructor(){this.name=null,this.url=null,this.buffer=null,this.offset=new F(0,0),this.scale=new F(1,1),this.rotation=0}IsValid(){return this.name!==null&&this.url!==null&&this.buffer!==null}HasTransformation(){return!we(this.offset,new F(0,0))||!we(this.scale,new F(1,1))||!P(this.rotation,0)}IsEqual(e){return!(this.name!==e.name||this.url!==e.url||!we(this.offset,e.offset)||!we(this.scale,e.scale)||!P(this.rotation,e.rotation))}};function Ze(o,e){return o===null&&e===null?!0:o===null||e===null?!1:o.IsEqual(e)}var $={Phong:1,Physical:2},Lr=class{constructor(e){this.type=e,this.isDefault=!1,this.name="",this.color=new N(0,0,0),this.vertexColors=!1}IsEqual(e){return!(this.type!==e.type||this.isDefault!==e.isDefault||this.name!==e.name||!ke(this.color,e.color)||this.vertexColors!==e.vertexColors)}},zt=class extends Lr{constructor(e){super(e);this.emissive=new N(0,0,0),this.opacity=1,this.transparent=!1,this.diffuseMap=null,this.bumpMap=null,this.normalMap=null,this.emissiveMap=null,this.alphaTest=0,this.multiplyDiffuseMap=!1}IsEqual(e){return!(!super.IsEqual(e)||!ke(this.emissive,e.emissive)||!P(this.opacity,e.opacity)||this.transparent!==e.transparent||!Ze(this.diffuseMap,e.diffuseMap)||!Ze(this.bumpMap,e.bumpMap)||!Ze(this.normalMap,e.normalMap)||!Ze(this.emissiveMap,e.emissiveMap)||!P(this.alphaTest,e.alphaTest)||this.multiplyDiffuseMap!==e.multiplyDiffuseMap)}EnumerateTextureMaps(e){this.diffuseMap!==null&&e(this.diffuseMap),this.bumpMap!==null&&e(this.bumpMap),this.normalMap!==null&&e(this.normalMap),this.emissiveMap!==null&&e(this.emissiveMap)}},q=class extends zt{constructor(){super($.Phong);this.ambient=new N(0,0,0),this.specular=new N(0,0,0),this.shininess=0,this.specularMap=null}IsEqual(e){return!(!super.IsEqual(e)||!ke(this.ambient,e.ambient)||!ke(this.specular,e.specular)||!P(this.shininess,e.shininess)||!Ze(this.specularMap,e.specularMap))}EnumerateTextureMaps(e){super.EnumerateTextureMaps(e),this.specularMap!==null&&e(this.specularMap)}},je=class extends zt{constructor(){super($.Physical);this.metalness=0,this.roughness=1,this.metalnessMap=null}IsEqual(e){return!(!super.IsEqual(e)||!P(this.metalness,e.metalness)||!P(this.roughness,e.roughness)||!Ze(this.metalnessMap,e.metalnessMap))}EnumerateTextureMaps(e){super.EnumerateTextureMaps(e),this.metalnessMap!==null&&e(this.metalnessMap)}};function Ki(o,e){return!(o.name!==e.name||o.url!==e.url||!we(o.offset,e.offset)||!we(o.scale,e.scale)||!P(o.rotation,e.rotation))}var M=class{constructor(e,t,r){this.x=e,this.y=t,this.z=r}Length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}MultiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}Normalize(){let e=this.Length();return e>0&&this.MultiplyScalar(1/e),this}Offset(e,t){let r=e.Clone().Normalize();return this.x+=r.x*t,this.y+=r.y*t,this.z+=r.z*t,this}Rotate(e,t,r){let i=e.Clone().Normalize(),n=i.x,s=i.y,l=i.z,a=this.x-r.x,u=this.y-r.y,h=this.z-r.z,f=Math.sin(t),d=Math.cos(t);return this.x=-n*(-n*a-s*u-l*h)*(1-d)+a*d+(-l*u+s*h)*f,this.y=-s*(-n*a-s*u-l*h)*(1-d)+u*d+(l*a-n*h)*f,this.z=-l*(-n*a-s*u-l*h)*(1-d)+h*d+(-s*a+n*u)*f,this.x+=r.x,this.y+=r.y,this.z+=r.z,this}Clone(){return new M(this.x,this.y,this.z)}};function ce(o,e){return P(o.x,e.x)&&P(o.y,e.y)&&P(o.z,e.z)}function Ur(o,e){return new M(o.x+e.x,o.y+e.y,o.z+e.z)}function ee(o,e){return new M(o.x-e.x,o.y-e.y,o.z-e.z)}function pe(o,e){return Math.sqrt((o.x-e.x)*(o.x-e.x)+(o.y-e.y)*(o.y-e.y)+(o.z-e.z)*(o.z-e.z))}function Ht(o,e){return o.x*e.x+o.y*e.y+o.z*e.z}function zr(o,e){let t=o.Clone().Normalize(),r=e.Clone().Normalize();if(ce(t,r))return 0;let i=Ht(t,r);return Math.acos(i)}function ve(o,e){let t=new M(0,0,0);return t.x=o.y*e.z-o.z*e.y,t.y=o.z*e.x-o.x*e.z,t.z=o.x*e.y-o.y*e.x,t}function yt(o,e,t){return Math.sqrt(o*o+e*e+t*t)}function Ae(o){return new M(o[0],o[1],o[2])}var Hr=class{constructor(){this.indices=[],this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.material=null}GetBounds(){let e=[1/0,1/0,1/0],t=[-1/0,-1/0,-1/0];for(let r=0;r<this.vertices.length/3;r++)for(let i=0;i<3;i++)e[i]=Math.min(e[i],this.vertices[r*3+i]),t[i]=Math.max(t[i],this.vertices[r*3+i]);return{min:e,max:t}}GetByteLength(e,t){let r=this.indices.length,i=this.vertices.length+this.colors.length+this.normals.length+this.uvs.length;return r*e+i*t}},_r=class{constructor(){this.primitives=[]}PrimitiveCount(){return this.primitives.length}GetPrimitive(e){return this.primitives[e]}GetByteLength(e,t){let r=0;for(let i=0;i<this.primitives.length;i++)r+=this.primitives[i].GetByteLength(e,t);return r}};function Mt(o){function e(l,a,u,h){function f(m,g,x){return g!==null?m.GetVertexColor(g):x?new N(0,0,0):null}function d(m,g,x){return g!==null?m.GetTextureUV(g):x?new F(0,0):null}function c(m,g,x){let C=m.VertexColorCount()>0,E=m.TextureUVCount()>0,T=m.GetVertex(g.vertex),I=m.GetNormal(g.normal),w=x.vertices.length/3;x.indices.push(w),x.vertices.push(T.x,T.y,T.z);let y=f(m,g.color,C);y!==null&&x.colors.push(y.r/255,y.g/255,y.b/255),x.normals.push(I.x,I.y,I.z);let S=d(m,g.uv,E);return S!==null&&x.uvs.push(S.x,S.y),{index:w,color:y,normal:I,uv:S}}function p(m,g,x){function C(I,w,y){if(y===null&&w===null)return!0;let S=f(I,w,!0);return ke(y,S)}function E(I,w,y){let S=I.GetNormal(w);return ce(y,S)}function T(I,w,y){if(y===null&&w===null)return!0;let S=d(I,w,!0);return we(y,S)}for(let I=0;I<g.length;I++){let w=g[I],y=C(m,x.color,w.color),S=E(m,x.normal,w.normal),b=T(m,x.uv,w.uv);if(y&&S&&b)return w}return null}if(h.has(a.vertex)){let m=h.get(a.vertex),g=p(l,m,a);if(g!==null)u.indices.push(g.index);else{let x=c(l,a,u);m.push(x)}}else{let m=c(l,a,u);h.set(a.vertex,[m])}}let t=new _r,r=o.TriangleCount();if(r===0)return null;let i=[];for(let l=0;l<r;l++)i.push(l);i.sort((l,a)=>{let u=o.GetTriangle(l),h=o.GetTriangle(a);return u.mat-h.mat});let n=null,s=null;for(let l=0;l<i.length;l++){let a=i[l],u=o.GetTriangle(a);(n===null||n.material!==u.mat)&&(n=new Hr,n.material=u.mat,s=new Map,t.primitives.push(n));let h={vertex:u.v0,color:u.c0,normal:u.n0,uv:u.u0},f={vertex:u.v1,color:u.c1,normal:u.n1,uv:u.u1},d={vertex:u.v2,color:u.c2,normal:u.n2,uv:u.u2};e(o,h,n,s),e(o,f,n,s),e(o,d,n,s)}return t}function K(o){return new TextDecoder("utf-8").decode(o)}function Zi(o){let e="",t=new Uint8Array(o);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return e}function Qi(o){let e=new ArrayBuffer(o.length),t=new Uint8Array(e);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return e}function It(o){return new TextEncoder().encode(o).buffer}function ot(o){let e="data:";if(!o.startsWith(e))return null;let t=o.indexOf(";");if(t===-1)return null;let r=o.indexOf(",");if(r===-1)return null;let i=o.substring(e.length,e.length+t-5),n=atob(o.substring(r+1)),s=new ArrayBuffer(n.length),l=new Uint8Array(s);for(let a=0;a<n.length;a++)l[a]=n.charCodeAt(a);return{mimeType:i,buffer:s}}function Qe(o){if(o==null)return"";let e=o.split("/");return e.length===0?"":e[e.length-1]}function lt(o){let e=new Blob([o]);return URL.createObjectURL(e)}function _t(o,e){let t=new Blob([o],{type:e});return URL.createObjectURL(t)}function kr(o){URL.revokeObjectURL(o)}var W=class{constructor(e){this.name=e,this.content=null}GetName(){return this.name}SetName(e){this.name=e}GetTextContent(){return K(this.content)}GetBufferContent(){return this.content}SetTextContent(e){let t=It(e);this.content=t}SetBufferContent(e){this.content=e}},ie=class{constructor(){}CanExport(e,t){return!1}Export(e,t,r){let i=[];this.ExportContent(e,t,i,()=>{r(i)})}ExportContent(e,t,r,i){}GetExportedMaterialName(e){return this.GetExportedName(e,"Material")}GetExportedMeshName(e){return this.GetExportedName(e,"Mesh")}GetExportedName(e,t){return e.length===0?t:e}};var kt=class extends ie{constructor(){super();this.rhino=null}CanExport(e,t){return e===B.Binary&&t==="3dm"}ExportContent(e,t,r,i){this.rhino===null?ae("loaders/rhino3dm.min.js").then(()=>{rhino3dm().then(n=>{this.rhino=n,this.ExportRhinoContent(e,r,i)})}).catch(()=>{i()}):this.ExportRhinoContent(e,r,i)}ExportRhinoContent(e,t,r){function i(u){return{r:u.r,g:u.g,b:u.b,a:255}}let n=new W("model.3dm");t.push(n);let s=new this.rhino.File3dm;e.EnumerateTransformedMeshes(u=>{let h=Mt(u);for(let f=0;f<h.PrimitiveCount();f++){let d=h.GetPrimitive(f),c={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:d.vertices},normal:{itemSize:3,type:"Float32Array",array:d.normals}},index:{type:"Uint16Array",array:d.indices}}},p=e.GetMaterial(d.material),m=new this.rhino.Material;m.name=this.GetExportedMaterialName(p.name),p.type===$.Phong&&(m.ambientColor=i(p.ambient),m.specularColor=i(p.specular)),m.diffuseColor=i(p.color),m.transparency=1-p.opacity;let g=s.materials().count();s.materials().add(m);let x=new this.rhino.Mesh.createFromThreejsJSON(c),C=new this.rhino.ObjectAttributes;C.name=this.GetExportedMeshName(u.GetName()),C.materialSource=this.rhino.ObjectMaterialSource.MaterialFromObject,C.materialIndex=g,s.objects().add(x,C)}});let l=new this.rhino.File3dmWriteOptions;l.version=6;let a=s.toByteArray(l);n.SetBufferContent(a),r()}};var Be=class{constructor(e,t){this.arrayBuffer=new ArrayBuffer(e),this.dataView=new DataView(this.arrayBuffer),this.isLittleEndian=t,this.position=0}GetPosition(){return this.position}SetPosition(e){this.position=e}End(){return this.position>=this.arrayBuffer.byteLength}GetBuffer(){return this.arrayBuffer}WriteArrayBuffer(e){let t=new Uint8Array(e);new Uint8Array(this.arrayBuffer).set(t,this.position),this.position+=e.byteLength}WriteBoolean8(e){this.dataView.setInt8(this.position,e?1:0),this.position=this.position+1}WriteCharacter8(e){this.dataView.setInt8(this.position,e),this.position=this.position+1}WriteUnsignedCharacter8(e){this.dataView.setUint8(this.position,e),this.position=this.position+1}WriteInteger16(e){this.dataView.setInt16(this.position,e,this.isLittleEndian),this.position=this.position+2}WriteUnsignedInteger16(e){this.dataView.setUint16(this.position,e,this.isLittleEndian),this.position=this.position+2}WriteInteger32(e){this.dataView.setInt32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteUnsignedInteger32(e){this.dataView.setUint32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteFloat32(e){this.dataView.setFloat32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteDouble64(e){this.dataView.setFloat64(this.position,e,this.isLittleEndian),this.position=this.position+8}};var jt=class extends ie{constructor(){super();this.components={index:{type:5125,size:4},number:{type:5126,size:4}}}CanExport(e,t){return e===B.Text&&t==="gltf"||e===B.Binary&&t==="glb"}ExportContent(e,t,r,i){t===B.Text?this.ExportAsciiContent(e,r):t===B.Binary&&this.ExportBinaryContent(e,r),i()}ExportAsciiContent(e,t){let r=new W("model.gltf"),i=new W("model.bin");t.push(r),t.push(i);let n=this.GetMeshData(e),s=this.GetMainBuffer(n),l=this.GetMainJson(n);l.buffers.push({uri:i.GetName(),byteLength:s.byteLength});let a=new Map;this.ExportMaterials(e,l,u=>{let h=J(u.name);if(a.has(h))return a.get(h);{let f=new W(h);f.SetBufferContent(u.buffer),t.push(f);let d=l.textures.length;return a.set(h,d),l.images.push({uri:h}),l.textures.push({source:d}),d}}),r.SetTextContent(JSON.stringify(l,null,4)),i.SetBufferContent(s)}ExportBinaryContent(e,t){function r(T){let I=T%4;return I===0?T:T+(4-I)}function i(T,I,w){for(let y=0;y<w;y++)T.WriteUnsignedCharacter8(I)}let n=new W("model.glb");t.push(n);let s=this.GetMeshData(e),l=this.GetMainBuffer(s),a=this.GetMainJson(s),u=[],h=l.byteLength,f=new Map;this.ExportMaterials(e,a,T=>{let I=J(T.name),w=Ve(T.name);if(f.has(I))return f.get(I);{let y=a.bufferViews.length,S=a.textures.length;f.set(I,S);let b=T.buffer;return u.push(b),a.bufferViews.push({buffer:0,byteOffset:h,byteLength:b.byteLength}),h+=b.byteLength,a.images.push({bufferView:y,mimeType:"image/"+w}),a.textures.push({source:S}),S}});let d=l.byteLength;for(let T=0;T<u.length;T++)d+=u[T].byteLength;let c=r(d);a.buffers.push({byteLength:c});let p=JSON.stringify(a),m=It(p),g=m.byteLength,x=r(g),C=12+8+x+8+c,E=new Be(C,!0);E.WriteUnsignedInteger32(1179937895),E.WriteUnsignedInteger32(2),E.WriteUnsignedInteger32(C),E.WriteUnsignedInteger32(x),E.WriteUnsignedInteger32(1313821514),E.WriteArrayBuffer(m),i(E,32,x-g),E.WriteUnsignedInteger32(c),E.WriteUnsignedInteger32(5130562),E.WriteArrayBuffer(l);for(let T=0;T<u.length;T++){let I=u[T];E.WriteArrayBuffer(I)}i(E,0,c-d),n.SetBufferContent(E.GetBuffer())}GetMeshData(e){let t=[];return e.EnumerateTransformedMeshes(r=>{let i=Mt(r);t.push({name:r.GetName(),buffer:i,offsets:[],sizes:[]})}),t}GetMainBuffer(e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].buffer.GetByteLength(this.components.index.size,this.components.number.size);let r=new Be(t,!0);for(let i=0;i<e.length;i++){let n=e[i];for(let s=0;s<n.buffer.PrimitiveCount();s++){let l=n.buffer.GetPrimitive(s),a=r.GetPosition();for(let u=0;u<l.indices.length;u++)r.WriteUnsignedInteger32(l.indices[u]);for(let u=0;u<l.vertices.length;u++)r.WriteFloat32(l.vertices[u]);for(let u=0;u<l.colors.length;u++)r.WriteFloat32(Oe(l.colors[u]));for(let u=0;u<l.normals.length;u++)r.WriteFloat32(l.normals[u]);for(let u=0;u<l.uvs.length;u++){let h=l.uvs[u];u%2===1&&(h*=-1),r.WriteFloat32(h)}n.offsets.push(a),n.sizes.push(r.GetPosition()-a)}}return r.GetBuffer()}GetMainJson(e){class t{constructor(n,s){this.mainJson=n,this.byteOffset=s}AddBufferView(n){return this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:n}),this.byteOffset+=n,this.mainJson.bufferViews.length-1}}let r={asset:{generator:"https://3dviewer.net",version:"2.0"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]};for(let i=0;i<e.length;i++){let n=e[i];r.scenes[0].nodes.push(i),r.nodes.push({mesh:i});let s={name:this.GetExportedMeshName(n.name),primitives:[]},l=n.buffer.primitives;for(let a=0;a<l.length;a++){let u=l[a],h=new t(r,n.offsets[a]),f=h.AddBufferView(u.indices.length*this.components.index.size),d=h.AddBufferView(u.vertices.length*this.components.number.size),c=null;u.colors.length>0&&(c=h.AddBufferView(u.colors.length*this.components.number.size));let p=h.AddBufferView(u.normals.length*this.components.number.size),m=null;u.uvs.length>0&&(m=h.AddBufferView(u.uvs.length*this.components.number.size));let g={attributes:{},mode:4,material:u.material},x=u.GetBounds();r.accessors.push({bufferView:f,byteOffset:0,componentType:this.components.index.type,count:u.indices.length,type:"SCALAR"}),g.indices=r.accessors.length-1,r.accessors.push({bufferView:d,byteOffset:0,componentType:this.components.number.type,count:u.vertices.length/3,min:x.min,max:x.max,type:"VEC3"}),g.attributes.POSITION=r.accessors.length-1,c!==null&&(r.accessors.push({bufferView:c,byteOffset:0,componentType:this.components.number.type,count:u.colors.length/3,type:"VEC3"}),g.attributes.COLOR_0=r.accessors.length-1),r.accessors.push({bufferView:p,byteOffset:0,componentType:this.components.number.type,count:u.normals.length/3,type:"VEC3"}),g.attributes.NORMAL=r.accessors.length-1,m!==null&&(r.accessors.push({bufferView:m,byteOffset:0,componentType:this.components.number.type,count:u.uvs.length/2,type:"VEC2"}),g.attributes.TEXCOORD_0=r.accessors.length-1),s.primitives.push(g)}r.meshes.push(s)}return r}ExportMaterials(e,t,r){function i(n,s,l,a){function u(g,x){return[Oe(g.r/255),Oe(g.g/255),Oe(g.b/255),x]}function h(g){return[Oe(g.r/255),Oe(g.g/255),Oe(g.b/255)]}function f(g,x,C){if(x===null||!x.IsValid())return null;g.images===void 0&&(g.images=[]),g.textures===void 0&&(g.textures=[]);let T={index:C(x)};if(x.HasTransformation()){let I="KHR_texture_transform";g.extensionsUsed===void 0&&(g.extensionsUsed=[]),g.extensionsUsed.indexOf(I)===-1&&g.extensionsUsed.push(I),T.extensions={KHR_texture_transform:{offset:[x.offset.x,-x.offset.y],scale:[x.scale.x,x.scale.y],rotation:-x.rotation}}}return T}let d={name:n.GetExportedMaterialName(l.name),pbrMetallicRoughness:{baseColorFactor:u(l.color,l.opacity)},emissiveFactor:h(l.emissive),doubleSided:!0,alphaMode:"OPAQUE"};l.transparent&&(d.alphaMode="BLEND");let c=f(s,l.diffuseMap,a);if(c!==null&&(l.multiplyDiffuseMap||(d.pbrMetallicRoughness.baseColorFactor=u(new N(255,255,255),l.opacity)),d.pbrMetallicRoughness.baseColorTexture=c),l.type===$.Physical){let g=f(s,l.metalnessMap,a);g!==null?d.pbrMetallicRoughness.metallicRoughnessTexture=g:(d.pbrMetallicRoughness.metallicFactor=l.metalness,d.pbrMetallicRoughness.roughnessFactor=l.roughness)}let p=f(s,l.normalMap,a);p!==null&&(d.normalTexture=p);let m=f(s,l.emissiveMap,a);m!==null&&(d.emissiveTexture=m),s.materials.push(d)}for(let n=0;n<e.MaterialCount();n++){let s=e.GetMaterial(n);i(this,t,s,r)}}};var Me=class{constructor(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i}Clone(){return new Me(this.x,this.y,this.z,this.w)}};var ge=class{constructor(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i}};function $i(o,e){return P(o.x,e.x)&&P(o.y,e.y)&&P(o.z,e.z)&&P(o.w,e.w)}function $e(o){return new ge(o[0],o[1],o[2],o[3])}function jr(o,e){let t=e/2,r=Math.sin(t);return new ge(o.x*r,o.y*r,o.z*r,Math.cos(t))}function en(o,e,t,r){let i=Math.cos(o/2),n=Math.cos(e/2),s=Math.cos(t/2),l=Math.sin(o/2),a=Math.sin(e/2),u=Math.sin(t/2),h=new ge(0,0,0,1);if(r==="XYZ")h.x=l*n*s+i*a*u,h.y=i*a*s-l*n*u,h.z=i*n*u+l*a*s,h.w=i*n*s-l*a*u;else if(r==="YXZ")h.x=l*n*s+i*a*u,h.y=i*a*s-l*n*u,h.z=i*n*u-l*a*s,h.w=i*n*s+l*a*u;else if(r==="ZXY")h.x=l*n*s-i*a*u,h.y=i*a*s+l*n*u,h.z=i*n*u+l*a*s,h.w=i*n*s-l*a*u;else if(r==="ZYX")h.x=l*n*s-i*a*u,h.y=i*a*s+l*n*u,h.z=i*n*u-l*a*s,h.w=i*n*s+l*a*u;else if(r==="YZX")h.x=l*n*s+i*a*u,h.y=i*a*s+l*n*u,h.z=i*n*u-l*a*s,h.w=i*n*s-l*a*u;else if(r==="XZY")h.x=l*n*s-i*a*u,h.y=i*a*s-l*n*u,h.z=i*n*u+l*a*s,h.w=i*n*s+l*a*u;else return null;return h}var L=class{constructor(e){this.matrix=null,e!=null&&(this.matrix=e)}IsValid(){return this.matrix!==null}Set(e){return this.matrix=e,this}Get(){return this.matrix}Clone(){let e=[this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]];return new L(e)}CreateIdentity(){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}IsIdentity(){let e=new L().CreateIdentity().Get();for(let t=0;t<16;t++)if(!P(this.matrix[t],e[t]))return!1;return!0}CreateTranslation(e,t,r){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1],this}CreateRotation(e,t,r,i){let n=e+e,s=t+t,l=r+r,a=e*n,u=e*s,h=e*l,f=t*s,d=t*l,c=r*l,p=i*n,m=i*s,g=i*l;return this.matrix=[1-(f+c),u+g,h-m,0,u-g,1-(a+c),d+p,0,h+m,d-p,1-(a+f),0,0,0,0,1],this}CreateRotationAxisAngle(e,t){let r=jr(e,t);return this.CreateRotation(r.x,r.y,r.z,r.w)}CreateScale(e,t,r){return this.matrix=[e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1],this}ComposeTRS(e,t,r){let i=e.x,n=e.y,s=e.z,l=t.x,a=t.y,u=t.z,h=t.w,f=r.x,d=r.y,c=r.z,p=l+l,m=a+a,g=u+u,x=l*p,C=l*m,E=l*g,T=a*m,I=a*g,w=u*g,y=h*p,S=h*m,b=h*g;return this.matrix=[(1-(T+w))*f,(C+b)*f,(E-S)*f,0,(C-b)*d,(1-(x+w))*d,(I+y)*d,0,(E+S)*c,(I-y)*c,(1-(x+T))*c,0,i,n,s,1],this}DecomposeTRS(){let e=new M(this.matrix[12],this.matrix[13],this.matrix[14]),t=yt(this.matrix[0],this.matrix[1],this.matrix[2]),r=yt(this.matrix[4],this.matrix[5],this.matrix[6]),i=yt(this.matrix[8],this.matrix[9],this.matrix[10]),n=this.Determinant();_e(n)&&(t*=-1);let s=new M(t,r,i),l=this.matrix[0]/t,a=this.matrix[4]/r,u=this.matrix[8]/i,h=this.matrix[1]/t,f=this.matrix[5]/r,d=this.matrix[9]/i,c=this.matrix[2]/t,p=this.matrix[6]/r,m=this.matrix[10]/i,g=null,x=l+f+m;if(x>0){let C=Math.sqrt(x+1)*2;g=new ge((p-d)/C,(u-c)/C,(h-a)/C,.25*C)}else if(l>f&&l>m){let C=Math.sqrt(1+l-f-m)*2;g=new ge(.25*C,(a+h)/C,(u+c)/C,(p-d)/C)}else if(f>m){let C=Math.sqrt(1+f-l-m)*2;g=new ge((a+h)/C,.25*C,(d+p)/C,(u-c)/C)}else{let C=Math.sqrt(1+m-l-f)*2;g=new ge((u+c)/C,(d+p)/C,.25*C,(h-a)/C)}return{translation:e,rotation:g,scale:s}}Determinant(){let e=this.matrix[0],t=this.matrix[1],r=this.matrix[2],i=this.matrix[3],n=this.matrix[4],s=this.matrix[5],l=this.matrix[6],a=this.matrix[7],u=this.matrix[8],h=this.matrix[9],f=this.matrix[10],d=this.matrix[11],c=this.matrix[12],p=this.matrix[13],m=this.matrix[14],g=this.matrix[15],x=e*s-t*n,C=e*l-r*n,E=e*a-i*n,T=t*l-r*s,I=t*a-i*s,w=r*a-i*l,y=u*p-h*c,S=u*m-f*c,b=u*g-d*c,G=h*m-f*p,O=h*g-d*p,R=f*g-d*m;return x*R-C*O+E*G+T*b-I*S+w*y}Invert(){let e=this.matrix[0],t=this.matrix[1],r=this.matrix[2],i=this.matrix[3],n=this.matrix[4],s=this.matrix[5],l=this.matrix[6],a=this.matrix[7],u=this.matrix[8],h=this.matrix[9],f=this.matrix[10],d=this.matrix[11],c=this.matrix[12],p=this.matrix[13],m=this.matrix[14],g=this.matrix[15],x=e*s-t*n,C=e*l-r*n,E=e*a-i*n,T=t*l-r*s,I=t*a-i*s,w=r*a-i*l,y=u*p-h*c,S=u*m-f*c,b=u*g-d*c,G=h*m-f*p,O=h*g-d*p,R=f*g-d*m,D=x*R-C*O+E*G+T*b-I*S+w*y;if(P(D,0))return null;let V=[(s*R-l*O+a*G)/D,(r*O-t*R-i*G)/D,(p*w-m*I+g*T)/D,(f*I-h*w-d*T)/D,(l*b-n*R-a*S)/D,(e*R-r*b+i*S)/D,(m*E-c*w-g*C)/D,(u*w-f*E+d*C)/D,(n*O-s*b+a*y)/D,(t*b-e*O-i*y)/D,(c*I-p*E+g*x)/D,(h*E-u*I-d*x)/D,(s*S-n*G-l*y)/D,(e*G-t*S+r*y)/D,(p*C-c*T-m*x)/D,(u*T-h*C+f*x)/D];return new L(V)}Transpose(){let e=[this.matrix[0],this.matrix[4],this.matrix[8],this.matrix[12],this.matrix[1],this.matrix[5],this.matrix[9],this.matrix[13],this.matrix[2],this.matrix[6],this.matrix[10],this.matrix[14],this.matrix[3],this.matrix[7],this.matrix[11],this.matrix[15]];return new L(e)}InvertTranspose(){let e=this.Invert();return e===null?null:e.Transpose()}MultiplyVector(e){let t=e.x,r=e.y,i=e.z,n=e.w,s=this.matrix[0],l=this.matrix[1],a=this.matrix[2],u=this.matrix[3],h=this.matrix[4],f=this.matrix[5],d=this.matrix[6],c=this.matrix[7],p=this.matrix[8],m=this.matrix[9],g=this.matrix[10],x=this.matrix[11],C=this.matrix[12],E=this.matrix[13],T=this.matrix[14],I=this.matrix[15];return new Me(t*s+r*h+i*p+n*C,t*l+r*f+i*m+n*E,t*a+r*d+i*g+n*T,t*u+r*c+i*x+n*I)}MultiplyMatrix(e){let t=this.matrix[0],r=this.matrix[1],i=this.matrix[2],n=this.matrix[3],s=this.matrix[4],l=this.matrix[5],a=this.matrix[6],u=this.matrix[7],h=this.matrix[8],f=this.matrix[9],d=this.matrix[10],c=this.matrix[11],p=this.matrix[12],m=this.matrix[13],g=this.matrix[14],x=this.matrix[15],C=e.matrix[0],E=e.matrix[1],T=e.matrix[2],I=e.matrix[3],w=e.matrix[4],y=e.matrix[5],S=e.matrix[6],b=e.matrix[7],G=e.matrix[8],O=e.matrix[9],R=e.matrix[10],D=e.matrix[11],V=e.matrix[12],te=e.matrix[13],U=e.matrix[14],me=e.matrix[15],De=[t*C+r*w+i*G+n*V,t*E+r*y+i*O+n*te,t*T+r*S+i*R+n*U,t*I+r*b+i*D+n*me,s*C+l*w+a*G+u*V,s*E+l*y+a*O+u*te,s*T+l*S+a*R+u*U,s*I+l*b+a*D+u*me,h*C+f*w+d*G+c*V,h*E+f*y+d*O+c*te,h*T+f*S+d*R+c*U,h*I+f*b+d*D+c*me,p*C+m*w+g*G+x*V,p*E+m*y+g*O+x*te,p*T+m*S+g*R+x*U,p*I+m*b+g*D+x*me];return new L(De)}};function Wr(o,e){let t=o.Get(),r=e.Get();for(let i=0;i<16;i++)if(!P(t[i],r[i]))return!1;return!0}var k=class{constructor(e){e!=null?this.matrix=e:(this.matrix=new L,this.matrix.CreateIdentity())}SetMatrix(e){return this.matrix=e,this}GetMatrix(){return this.matrix}IsIdentity(){return this.matrix.IsIdentity()}AppendMatrix(e){return this.matrix=this.matrix.MultiplyMatrix(e),this}Append(e){return this.AppendMatrix(e.GetMatrix()),this}TransformCoord3D(e){let t=new Me(e.x,e.y,e.z,1),r=this.matrix.MultiplyVector(t);return new M(r.x,r.y,r.z)}Clone(){let e=this.matrix.Clone();return new k(e)}};function tn(o,e){return Wr(o.GetMatrix(),e.GetMatrix())}var Le={Empty:0,TriangleMesh:1};function et(o){return o.TriangleCount()>0?Le.TriangleMesh:Le.Empty}function at(o,e,t){let r=ee(e,o),i=ee(t,o),n=ve(r,i);return n.Normalize(),n}function Ue(o,e){if(!e.IsIdentity()){for(let t=0;t<o.VertexCount();t++){let r=o.GetVertex(t),i=e.TransformCoord3D(r);r.x=i.x,r.y=i.y,r.z=i.z}if(o.NormalCount()>0){let t=e.GetMatrix().InvertTranspose();if(t!==null){let r=new k(t);for(let i=0;i<o.NormalCount();i++){let n=o.GetNormal(i),s=r.TransformCoord3D(n);n.x=s.x,n.y=s.y,n.z=s.z}}}}}function qr(o){for(let e=0;e<o.TriangleCount();e++){let t=o.GetTriangle(e),r=t.v1;t.v1=t.v2,t.v2=r}}var Xr=class{constructor(e){this.transformation=new k,this.isMeshVisible=t=>!0,xt(e,this)}},Wt=class{constructor(e,t){this.model=e,this.settings=t||new Xr}MaterialCount(){return this.model.MaterialCount()}GetMaterial(e){return this.model.GetMaterial(e)}VertexCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexCount()}),e}TriangleCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TriangleCount()}),e}MeshInstanceCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=1}),e}EnumerateMeshInstances(e){this.model.EnumerateMeshInstances(t=>{this.settings.isMeshVisible(t.GetId())&&e(t)})}EnumerateTransformedMeshes(e){this.EnumerateMeshInstances(t=>{let r=t.GetTransformation();this.settings.transformation.IsIdentity()||r.Append(this.settings.transformation);let n=t.GetMesh().Clone();r.IsIdentity()||Ue(n,r),e(n)})}EnumerateVerticesAndTriangles(e){let t=[];this.EnumerateTransformedMeshes(i=>{t.push(i)});for(let i of t)i.EnumerateVertices(n=>{e.onVertex(n.x,n.y,n.z)});let r=0;for(let i of t)i.EnumerateTriangleVertexIndices((n,s,l)=>{e.onTriangle(n+r,s+r,l+r)}),r+=i.VertexCount()}EnumerateTrianglesWithNormals(e){this.EnumerateTransformedMeshes(t=>{t.EnumerateTriangleVertices((r,i,n)=>{let s=at(r,i,n);e(r,i,n,s)})})}};var xe=class{constructor(){this.text="",this.indentation=0}GetText(){return this.text}Indent(e){this.indentation+=e}WriteArrayLine(e){this.WriteLine(e.join(" "))}WriteLine(e){this.WriteIndentation(),this.Write(e+`
`)}WriteIndentation(){for(let e=0;e<this.indentation;e++)this.Write("  ")}Write(e){this.text+=e}};var qt=class extends ie{constructor(){super()}CanExport(e,t){return e===B.Text&&t==="obj"}ExportContent(e,t,r,i){function n(p,m,g,x){if(g===null||!g.IsValid())return;let C=J(g.name);if(p.WriteArrayLine([m,C]),x.findIndex(T=>T.GetName()===C)===-1){let T=new W(C);T.SetBufferContent(g.buffer),x.push(T)}}let s=new W("model.mtl"),l=new W("model.obj");r.push(s),r.push(l);let a=new xe;a.WriteLine(this.GetHeaderText());for(let p=0;p<e.MaterialCount();p++){let m=e.GetMaterial(p);a.WriteArrayLine(["newmtl",this.GetExportedMaterialName(m.name)]),a.WriteArrayLine(["Kd",m.color.r/255,m.color.g/255,m.color.b/255]),a.WriteArrayLine(["d",m.opacity]),m.type===$.Phong&&(a.WriteArrayLine(["Ka",m.ambient.r/255,m.ambient.g/255,m.ambient.b/255]),a.WriteArrayLine(["Ks",m.specular.r/255,m.specular.g/255,m.specular.b/255]),a.WriteArrayLine(["Ns",m.shininess*1e3])),n(a,"map_Kd",m.diffuseMap,r),m.type===$.Phong&&n(a,"map_Ks",m.specularMap,r),n(a,"bump",m.bumpMap,r)}s.SetTextContent(a.GetText());let u=new xe;u.WriteLine(this.GetHeaderText()),u.WriteArrayLine(["mtllib",s.GetName()]);let h=0,f=0,d=0,c=null;e.EnumerateTransformedMeshes(p=>{u.WriteArrayLine(["g",this.GetExportedMeshName(p.GetName())]);for(let m=0;m<p.VertexCount();m++){let g=p.GetVertex(m);u.WriteArrayLine(["v",g.x,g.y,g.z])}for(let m=0;m<p.NormalCount();m++){let g=p.GetNormal(m);u.WriteArrayLine(["vn",g.x,g.y,g.z])}for(let m=0;m<p.TextureUVCount();m++){let g=p.GetTextureUV(m);u.WriteArrayLine(["vt",g.x,g.y])}for(let m=0;m<p.TriangleCount();m++){let g=p.GetTriangle(m),x=g.v0+h+1,C=g.v1+h+1,E=g.v2+h+1,T=g.n0+f+1,I=g.n1+f+1,w=g.n2+f+1;if(g.mat!==null){let G=e.GetMaterial(g.mat),O=this.GetExportedMaterialName(G.name);O!==c&&(u.WriteArrayLine(["usemtl",O]),c=O)}let y="",S="",b="";g.HasTextureUVs()&&(y=g.u0+d+1,S=g.u1+d+1,b=g.u2+d+1),u.WriteArrayLine(["f",[x,y,T].join("/"),[C,S,I].join("/"),[E,b,w].join("/")])}h+=p.VertexCount(),f+=p.NormalCount(),d+=p.TextureUVCount()}),l.SetTextContent(u.GetText()),i()}GetHeaderText(){return"# exported by https://3dviewer.net"}};var Xt=class extends ie{constructor(){super()}CanExport(e,t){return e===B.Text&&t==="off"}ExportContent(e,t,r,i){let n=new W("model.off");r.push(n);let s=new xe;s.WriteLine("OFF"),s.WriteArrayLine([e.VertexCount(),e.TriangleCount(),0]),e.EnumerateVerticesAndTriangles({onVertex:function(l,a,u){s.WriteArrayLine([l,a,u])},onTriangle:function(l,a,u){s.WriteArrayLine([3,l,a,u])}}),n.SetTextContent(s.GetText()),i()}};var Yt=class extends ie{constructor(){super()}CanExport(e,t){return(e===B.Text||e===B.Binary)&&t==="ply"}ExportContent(e,t,r,i){t===B.Text?this.ExportText(e,r):this.ExportBinary(e,r),i()}ExportText(e,t){let r=new W("model.ply");t.push(r);let i=new xe,n=e.VertexCount(),s=e.TriangleCount(),l=this.GetHeaderText("ascii",n,s);i.Write(l),e.EnumerateVerticesAndTriangles({onVertex:function(a,u,h){i.WriteArrayLine([a,u,h])},onTriangle:function(a,u,h){i.WriteArrayLine([3,a,u,h])}}),r.SetTextContent(i.GetText())}ExportBinary(e,t){let r=new W("model.ply");t.push(r);let i=e.VertexCount(),n=e.TriangleCount(),s=this.GetHeaderText("binary_little_endian",i,n),l=s.length+i*3*4+n*(1+3*4),a=new Be(l,!0);for(let u=0;u<s.length;u++)a.WriteUnsignedCharacter8(s.charCodeAt(u));e.EnumerateVerticesAndTriangles({onVertex:function(u,h,f){a.WriteFloat32(u),a.WriteFloat32(h),a.WriteFloat32(f)},onTriangle:function(u,h,f){a.WriteUnsignedCharacter8(3),a.WriteInteger32(u),a.WriteInteger32(h),a.WriteInteger32(f)}}),r.SetBufferContent(a.GetBuffer())}GetHeaderText(e,t,r){let i=new xe;return i.WriteLine("ply"),i.WriteLine("format "+e+" 1.0"),i.WriteLine("element vertex "+t),i.WriteLine("property float x"),i.WriteLine("property float y"),i.WriteLine("property float z"),i.WriteLine("element face "+r),i.WriteLine("property list uchar int vertex_index"),i.WriteLine("end_header"),i.GetText()}};var Jt=class extends ie{constructor(){super()}CanExport(e,t){return(e===B.Text||e===B.Binary)&&t==="stl"}ExportContent(e,t,r,i){t===B.Text?this.ExportText(e,r):this.ExportBinary(e,r),i()}ExportText(e,t){let r=new W("model.stl");t.push(r);let i=new xe;i.WriteLine("solid Model"),e.EnumerateTrianglesWithNormals((n,s,l,a)=>{i.WriteArrayLine(["facet","normal",a.x,a.y,a.z]),i.Indent(1),i.WriteLine("outer loop"),i.Indent(1),i.WriteArrayLine(["vertex",n.x,n.y,n.z]),i.WriteArrayLine(["vertex",s.x,s.y,s.z]),i.WriteArrayLine(["vertex",l.x,l.y,l.z]),i.Indent(-1),i.WriteLine("endloop"),i.Indent(-1),i.WriteLine("endfacet")}),i.WriteLine("endsolid Model"),r.SetTextContent(i.GetText())}ExportBinary(e,t){let r=new W("model.stl");t.push(r);let i=e.TriangleCount(),n=80,s=n+4+i*50,l=new Be(s,!0);for(let a=0;a<n;a++)l.WriteUnsignedCharacter8(0);l.WriteUnsignedInteger32(i),e.EnumerateTrianglesWithNormals((a,u,h,f)=>{l.WriteFloat32(f.x),l.WriteFloat32(f.y),l.WriteFloat32(f.z),l.WriteFloat32(a.x),l.WriteFloat32(a.y),l.WriteFloat32(a.z),l.WriteFloat32(u.x),l.WriteFloat32(u.y),l.WriteFloat32(u.z),l.WriteFloat32(h.x),l.WriteFloat32(h.y),l.WriteFloat32(h.z),l.WriteUnsignedInteger16(0)}),r.SetBufferContent(l.GetBuffer())}};var Ri=class{constructor(){this.exporters=[new qt,new Jt,new Yt,new Xt,new jt,new kt]}AddExporter(e){this.exporters.push(e)}Export(e,t,r,i,n){let s=null;for(let a=0;a<this.exporters.length;a++){let u=this.exporters[a];if(u.CanExport(r,i)){s=u;break}}if(s===null){n.onError();return}let l=new Wt(e,t);s.Export(l,r,a=>{a.length===0?n.onError():n.onSuccess(a)})}};var bt=class{constructor(e,t){this.min=e,this.max=t}GetMin(){return this.min}GetMax(){return this.max}GetCenter(){return new M((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,(this.min.z+this.max.z)/2)}},Kt=class{constructor(){this.box=new bt(new M(1/0,1/0,1/0),new M(-1/0,-1/0,-1/0)),this.isValid=!1}GetBox(){return this.isValid?this.box:null}AddPoint(e){this.box.min.x=Math.min(this.box.min.x,e.x),this.box.min.y=Math.min(this.box.min.y,e.y),this.box.min.z=Math.min(this.box.min.z,e.z),this.box.max.x=Math.max(this.box.max.x,e.x),this.box.max.y=Math.max(this.box.max.y,e.y),this.box.max.z=Math.max(this.box.max.z,e.z),this.isValid=!0}};var wt=class{constructor(e,t){this.boundingBox=e,this.level=t,this.pointItems=[],this.childNodes=[]}AddPoint(e,t,r){let i=this.FindNodeForPoint(e);if(i===null||i.FindPointDirectly(e)!==null)return!1;if(i.pointItems.length<r.maxPointsPerNode||i.level>=r.maxTreeDepth)return i.AddPointDirectly(e,t),!0;{i.CreateChildNodes();let n=i.pointItems;i.pointItems=[];for(let s=0;s<n.length;s++){let l=n[s];if(!i.AddPoint(l.point,l.data,r))return!1}return i.AddPoint(e,t,r)}}FindPoint(e){let t=this.FindNodeForPoint(e);return t===null?null:t.FindPointDirectly(e)}AddPointDirectly(e,t){this.pointItems.push({point:e,data:t})}FindPointDirectly(e){for(let t=0;t<this.pointItems.length;t++){let r=this.pointItems[t];if(ce(e,r.point))return r.data}return null}FindNodeForPoint(e){if(!this.IsPointInBounds(e))return null;if(this.childNodes.length===0)return this;for(let t=0;t<this.childNodes.length;t++){let i=this.childNodes[t].FindNodeForPoint(e);if(i!==null)return i}return null}CreateChildNodes(){function e(l,a,u,h,f,d,c){let p=new bt(new M(a,u,h),new M(a+f,u+d,h+c));l.childNodes.push(new wt(p,l.level+1))}let t=this.boundingBox.min,r=this.boundingBox.GetCenter(),i=(this.boundingBox.max.x-this.boundingBox.min.x)/2,n=(this.boundingBox.max.y-this.boundingBox.min.y)/2,s=(this.boundingBox.max.z-this.boundingBox.min.z)/2;e(this,t.x,t.y,t.z,i,n,s),e(this,r.x,t.y,t.z,i,n,s),e(this,t.x,r.y,t.z,i,n,s),e(this,r.x,r.y,t.z,i,n,s),e(this,t.x,t.y,r.z,i,n,s),e(this,r.x,t.y,r.z,i,n,s),e(this,t.x,r.y,r.z,i,n,s),e(this,r.x,r.y,r.z,i,n,s)}IsPointInBounds(e){return Et(e.x,this.boundingBox.min.x)&&Et(e.y,this.boundingBox.min.y)&&Et(e.z,this.boundingBox.min.z)&&Tt(e.x,this.boundingBox.max.x)&&Tt(e.y,this.boundingBox.max.y)&&Tt(e.z,this.boundingBox.max.z)}},Zt=class{constructor(e,t){this.options={maxPointsPerNode:10,maxTreeDepth:10},t!==void 0&&(t.maxPointsPerNode!==void 0&&(this.options.maxPointsPerNode=t.maxPointsPerNode),t.maxTreeDepth!==void 0&&(this.options.maxTreeDepth=t.maxTreeDepth)),this.rootNode=new wt(e,0)}AddPoint(e,t){return this.rootNode.AddPoint(e,t,this.options)}FindPoint(e){return this.rootNode.FindPoint(e)}};function rn(o,e,t){let r=e/t;return o*(r*r*(3-2*r))}function nn(o,e,t){return e*o/t}function Yr(o,e,t){let r=e/t,i=r*r;return o*(i/(2*(i-r)+1))}function St(o,e,t,r){let i=ee(e,o).Normalize(),n=pe(o,e),s=[];for(let l=0;l<t;l++){let a=r(n,l,t-1);s.push(o.Clone().Offset(i,a))}return s}var vt=class{constructor(e,t){this.source=t,t===Y.Url?(this.fileUrl=e,this.fileObject=null,this.name=J(e),this.extension=Ve(e)):t===Y.File?(this.fileUrl=null,this.fileObject=e,this.name=J(e.name),this.extension=Ve(e.name)):t===Y.Decompressed&&(this.fileUrl=null,this.fileObject=null,this.name=J(e),this.extension=Ve(e)),this.content=null}SetContent(e){this.content=e}},At=class{constructor(){this.files=[]}FillFromFileUrls(e){this.Fill(e,Y.Url)}FillFromFileObjects(e){this.Fill(e,Y.File)}ExtendFromFileList(e){for(let t=0;t<e.length;t++){let r=e[t];this.ContainsFileByPath(r.name)||this.files.push(r)}}GetFiles(){return this.files}GetContent(e){Ar(this.files.length,{runTask:(t,r)=>{this.GetFileContent(this.files[t],r)},onReady:e})}ContainsFileByPath(e){return this.FindFileByPath(e)!==null}FindFileByPath(e){let t=J(e).toLowerCase();for(let r=0;r<this.files.length;r++){let i=this.files[r];if(i.name.toLowerCase()===t)return i}return null}IsOnlyUrlSource(){if(this.files.length===0)return!1;for(let e=0;e<this.files.length;e++){let t=this.files[e];if(t.source!==Y.Url&&t.source!==Y.Decompressed)return!1}return!0}Fill(e,t){this.files=[];for(let r=0;r<e.length;r++){let i=e[r],n=new vt(i,t);this.AddFile(n)}}AddFile(e){this.files.push(e)}GetFileContent(e,t){if(e.content!==null){t();return}let r=null;if(e.source===Y.Url)r=Nr(e.fileUrl,B.Binary);else if(e.source===Y.File)r=Dr(e.fileObject,B.Binary);else{t();return}r.then(i=>{e.SetContent(i)}).catch(()=>{}).finally(()=>{t()})}};var Jr=class{constructor(){this.edges=[],this.triangles=[]}},Kr=class{constructor(e,t){this.vertex1=e,this.vertex2=t,this.triangles=[]}},Zr=class{constructor(e,t){this.edge=e,this.reversed=t}},Qr=class{constructor(){this.triEdge1=null,this.triEdge2=null,this.triEdge3=null}},Qt=class{constructor(){this.vertices=[],this.edges=[],this.triangleEdges=[],this.triangles=[],this.edgeStartToEndVertexMap=new Map}AddVertex(){return this.vertices.push(new Jr),this.vertices.length-1}AddTriangle(e,t,r){function i(u,h,f){u[h].triangles.push(f)}function n(u,h,f,d){let c=u[f],p=h[d];c.edges.push(p.edge)}function s(u,h,f,d){let c=h[f];u[c.edge].triangles.push(d)}let l=this.triangles.length,a=new Qr;a.triEdge1=this.AddTriangleEdge(e,t),a.triEdge2=this.AddTriangleEdge(t,r),a.triEdge3=this.AddTriangleEdge(r,e),i(this.vertices,e,l),i(this.vertices,t,l),i(this.vertices,r,l),n(this.vertices,this.triangleEdges,e,a.triEdge1),n(this.vertices,this.triangleEdges,t,a.triEdge2),n(this.vertices,this.triangleEdges,r,a.triEdge3),s(this.edges,this.triangleEdges,a.triEdge1,l),s(this.edges,this.triangleEdges,a.triEdge2,l),s(this.edges,this.triangleEdges,a.triEdge3,l),this.triangles.push(a)}AddTriangleEdge(e,t){let r=e,i=t,n=!1;t<e&&(r=t,i=e,n=!0);let s=this.AddEdge(r,i);return this.triangleEdges.push(new Zr(s,n)),this.triangleEdges.length-1}AddEdge(e,t){this.edgeStartToEndVertexMap.has(e)||this.edgeStartToEndVertexMap.set(e,[]);let r=this.edgeStartToEndVertexMap.get(e);for(let n=0;n<r.length;n++){let s=r[n];if(s.endVertex===t)return s.edgeIndex}let i=this.edges.length;return r.push({endVertex:t,edgeIndex:i}),this.edges.push(new Kr(e,t)),i}};function Gt(o){let e=!0;return o.EnumerateMeshInstances(t=>{et(t)!==Le.Empty&&(e=!1)}),e}function Fi(o){let e=new Kt;return o.EnumerateVertices(t=>{e.AddPoint(t)}),e.GetBox()}function Ni(o){function e(n,s,l){let a=s.FindPoint(n);return a===null&&(a=l.AddVertex(),s.AddPoint(n,a)),a}let t=Fi(o),r=new Zt(t),i=new Qt;return o.EnumerateTriangleVertices((n,s,l)=>{let a=e(n,r,i),u=e(s,r,i),h=e(l,r,i);i.AddTriangle(a,u,h)}),i}function sn(o){function e(r,i,n){let s=r.triangles[i],l=r.triangleEdges[s.triEdge1],a=r.triangleEdges[s.triEdge2],u=r.triangleEdges[s.triEdge3];return l.edge===n?l.reversed:a.edge===n?a.reversed:u.edge===n?u.reversed:null}let t=Ni(o);for(let r=0;r<t.edges.length;r++){let i=t.edges[r],n=i.triangles.length;if(n===0||n%2!==0)return!1;let s=0;for(let l=0;l<i.triangles.length;l++){let a=i.triangles[l];e(t,a,r)?s+=1:s-=1}if(s!==0)return!1}return!0}function on(o){for(let e=0;e<o.MaterialCount();e++){let t=o.GetMaterial(e);if(t.isDefault&&!t.vertexColors)return!0}return!1}function ln(o,e){for(let t=0;t<o.MaterialCount();t++){let r=o.GetMaterial(t);r.isDefault&&(r.color=e)}}var he={Text:1,Integer:2,Number:3,Boolean:4,Percent:5,Color:6},ne=class{constructor(e,t,r){this.type=e,this.name=t,this.value=r}},Ie=class{constructor(e){this.name=e,this.properties=[]}PropertyCount(){return this.properties.length}AddProperty(e){this.properties.push(e)}GetProperty(e){return this.properties[e]}};var $r=class{constructor(){}VertexCount(){return 0}VertexColorCount(){return 0}NormalCount(){return 0}TextureUVCount(){return 0}TriangleCount(){return 0}EnumerateVertices(e){}EnumerateTriangleVertexIndices(e){}EnumerateTriangleVertices(e){}},We=class extends $r{constructor(){super();this.name="",this.propertyGroups=[]}GetName(){return this.name}SetName(e){this.name=e}PropertyGroupCount(){return this.propertyGroups.length}AddPropertyGroup(e){return this.propertyGroups.push(e),this.propertyGroups.length-1}GetPropertyGroup(e){return this.propertyGroups[e]}};var j=class extends We{constructor(){super();this.vertices=[],this.vertexColors=[],this.normals=[],this.uvs=[],this.triangles=[]}VertexCount(){return this.vertices.length}VertexColorCount(){return this.vertexColors.length}NormalCount(){return this.normals.length}TextureUVCount(){return this.uvs.length}TriangleCount(){return this.triangles.length}AddVertex(e){return this.vertices.push(e),this.vertices.length-1}SetVertex(e,t){this.vertices[e]=t}GetVertex(e){return this.vertices[e]}AddVertexColor(e){return this.vertexColors.push(e),this.vertexColors.length-1}SetVertexColor(e,t){this.vertexColors[e]=t}GetVertexColor(e){return this.vertexColors[e]}AddNormal(e){return this.normals.push(e),this.normals.length-1}SetNormal(e,t){this.normals[e]=t}GetNormal(e){return this.normals[e]}AddTextureUV(e){return this.uvs.push(e),this.uvs.length-1}SetTextureUV(e,t){this.uvs[e]=t}GetTextureUV(e){return this.uvs[e]}AddTriangle(e){return this.triangles.push(e),this.triangles.length-1}GetTriangle(e){return this.triangles[e]}EnumerateVertices(e){for(let t of this.vertices)e(t)}EnumerateTriangleVertexIndices(e){for(let t of this.triangles)e(t.v0,t.v1,t.v2)}EnumerateTriangleVertices(e){for(let t of this.triangles){let r=this.vertices[t.v0],i=this.vertices[t.v1],n=this.vertices[t.v2];e(r,i,n)}}Clone(){let e=new j;e.SetName(this.GetName());for(let t=0;t<this.VertexCount();t++){let r=this.GetVertex(t);e.AddVertex(r.Clone())}for(let t=0;t<this.VertexColorCount();t++){let r=this.GetVertexColor(t);e.AddVertexColor(r.Clone())}for(let t=0;t<this.NormalCount();t++){let r=this.GetNormal(t);e.AddNormal(r.Clone())}for(let t=0;t<this.TextureUVCount();t++){let r=this.GetTextureUV(t);e.AddTextureUV(r.Clone())}for(let t=0;t<this.TriangleCount();t++){let r=this.GetTriangle(t);e.AddTriangle(r.Clone())}return e}};var z=class{constructor(e,t,r){this.v0=e,this.v1=t,this.v2=r,this.c0=null,this.c1=null,this.c2=null,this.n0=null,this.n1=null,this.n2=null,this.u0=null,this.u1=null,this.u2=null,this.mat=null,this.curve=null}HasVertices(){return this.v0!==null&&this.v1!==null&&this.v2!==null}HasVertexColors(){return this.c0!==null&&this.c1!==null&&this.c2!==null}HasNormals(){return this.n0!==null&&this.n1!==null&&this.n2!==null}HasTextureUVs(){return this.u0!==null&&this.u1!==null&&this.u2!==null}SetVertices(e,t,r){return this.v0=e,this.v1=t,this.v2=r,this}SetVertexColors(e,t,r){return this.c0=e,this.c1=t,this.c2=r,this}SetNormals(e,t,r){return this.n0=e,this.n1=t,this.n2=r,this}SetTextureUVs(e,t,r){return this.u0=e,this.u1=t,this.u2=r,this}SetMaterial(e){return this.mat=e,this}SetCurve(e){return this.curve=e,this}Clone(){let e=new z(this.v0,this.v1,this.v2);return e.SetVertexColors(this.c0,this.c1,this.c2),e.SetNormals(this.n0,this.n1,this.n2),e.SetTextureUVs(this.u0,this.u1,this.u2),e.SetMaterial(this.mat),e.SetCurve(this.curve),e}};function ei(){let o=document.createElement("canvas");document.body.appendChild(o);let e={canvas:o,antialias:!0},t=new THREE.WebGLRenderer(e);t.setClearColor("#ffffff",1),t.setSize(10,10);let r=new THREE.Scene,i=new THREE.AmbientLight(8947848);r.add(i);let n=new THREE.DirectionalLight(8947848);n.position.set(0,0,1),r.add(n);let s=new THREE.PerspectiveCamera(45,1,.1,1e3);s.position.set(0,0,1),s.up.set(0,1,0),s.lookAt(new THREE.Vector3(0,0,0)),r.add(s);let l=new THREE.PlaneGeometry(1,1),a=new THREE.Mesh(l,new THREE.MeshPhongMaterial({color:13369344}));r.add(a),t.render(r,s);let u=t.getContext(),h=new Uint8Array(4);u.readPixels(5,5,1,1,u.RGBA,u.UNSIGNED_BYTE,h),document.body.removeChild(o);let f=50;return h[0]<f&&h[1]<f&&h[2]<f}var se={Phong:1,Physical:2};function ti(o){let e=0,t=0;for(let r=0;r<o.MaterialCount();r++){let i=o.GetMaterial(r);i.type===$.Phong?e+=1:i.type===$.Physical&&(t+=1)}return e>=t?se.Phong:se.Physical}function Rt(o){return Pe(o.r,o.g,o.b)}function fe(o){return new THREE.Color(o.r/255,o.g/255,o.b/255)}function qe(o,e){let t=new j,r=o.attributes.position.array;for(let a=0;a<r.length;a+=3){let u=r[a],h=r[a+1],f=r[a+2];t.AddVertex(new M(u,h,f))}let i=o.attributes.color!==void 0;if(i){let a=o.attributes.color.array,u=o.attributes.color.itemSize;for(let h=0;h<a.length;h+=u){let f=new THREE.Color(a[h],a[h+1],a[h+2]);t.AddVertexColor(Rt(f))}}let n=o.attributes.normal!==void 0;if(n){let a=o.attributes.normal.array;for(let u=0;u<a.length;u+=3){let h=a[u],f=a[u+1],d=a[u+2];t.AddNormal(new M(h,f,d))}}let s=o.attributes.uv!==void 0;if(s){let a=o.attributes.uv.array;for(let u=0;u<a.length;u+=2){let h=a[u],f=a[u+1];t.AddTextureUV(new F(h,f))}}let l=null;if(o.index!==null)l=o.index.array;else{l=[];for(let a=0;a<r.length/3;a++)l.push(a)}for(let a=0;a<l.length;a+=3){let u=l[a],h=l[a+1],f=l[a+2],d=new z(u,h,f);i&&d.SetVertexColors(u,h,f),n&&d.SetNormals(u,h,f),s&&d.SetTextureUVs(u,h,f),e!==null&&d.SetMaterial(e),t.AddTriangle(d)}return t}var tt=class{constructor(e,t){this.nodeId=e,this.meshIndex=t}IsEqual(e){return this.nodeId===e.nodeId&&this.meshIndex===e.meshIndex}GetKey(){return this.nodeId.toString()+":"+this.meshIndex.toString()}},Ft=class extends We{constructor(e,t,r){super();this.id=e,this.node=t,this.mesh=r}GetId(){return this.id}GetTransformation(){return this.node.GetWorldTransformation()}GetMesh(){return this.mesh}VertexCount(){return this.mesh.VertexCount()}VertexColorCount(){return this.mesh.VertexColorCount()}NormalCount(){return this.mesh.NormalCount()}TextureUVCount(){return this.mesh.TextureUVCount()}TriangleCount(){return this.mesh.TriangleCount()}EnumerateVertices(e){let t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateVertices(e):this.mesh.EnumerateVertices(r=>{let i=t.TransformCoord3D(r);e(i)})}EnumerateTriangleVertexIndices(e){this.mesh.EnumerateTriangleVertexIndices(e)}EnumerateTriangleVertices(e){let t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateTriangleVertices(e):this.mesh.EnumerateTriangleVertices((r,i,n)=>{let s=t.TransformCoord3D(r),l=t.TransformCoord3D(i),a=t.TransformCoord3D(n);e(s,l,a)})}PropertyGroupCount(){return this.mesh.PropertyGroupCount()}AddPropertyGroup(e){return this.mesh.AddPropertyGroup(e)}GetPropertyGroup(e){return this.mesh.GetPropertyGroup(e)}GetTransformedMesh(){let e=this.node.GetWorldTransformation(),t=this.mesh.Clone();return Ue(t,e),t}};var an=class{constructor(){this.nextId=0}GenerateId(){let e=this.nextId;return this.nextId+=1,e}},Ge={GroupNode:0,MeshNode:1},Ce=class{constructor(){this.type=Ge.GroupNode,this.name="",this.parent=null,this.transformation=new k,this.childNodes=[],this.meshIndices=[],this.idGenerator=new an,this.id=this.idGenerator.GenerateId()}IsEmpty(){return this.childNodes.length===0&&this.meshIndices.length===0}GetType(){return this.type}SetType(e){this.type=e}GetId(){return this.id}GetName(){return this.name}SetName(e){this.name=e}HasParent(){return this.parent!==null}GetParent(){return this.parent}GetTransformation(){return this.transformation}GetWorldTransformation(){let e=this.transformation.Clone(),t=this.parent;for(;t!==null;)e.Append(t.transformation),t=t.parent;return e}SetTransformation(e){this.transformation=e}AddChildNode(e){return e.parent=this,e.idGenerator=this.idGenerator,e.id=e.idGenerator.GenerateId(),this.childNodes.push(e),this.childNodes.length-1}RemoveChildNode(e){e.parent=null;let t=this.childNodes.indexOf(e);this.childNodes.splice(t,1)}GetChildNodes(){return this.childNodes}ChildNodeCount(){return this.childNodes.length}GetChildNode(e){return this.childNodes[e]}AddMeshIndex(e){return this.meshIndices.push(e),this.meshIndices.length-1}MeshIndexCount(){return this.meshIndices.length}GetMeshIndex(e){return this.meshIndices[e]}GetMeshIndices(){return this.meshIndices}Enumerate(e){e(this);for(let t of this.childNodes)t.Enumerate(e)}EnumerateChildren(e){for(let t of this.childNodes)e(t),t.EnumerateChildren(e)}EnumerateMeshIndices(e){for(let t of this.meshIndices)e(t);for(let t of this.childNodes)t.EnumerateMeshIndices(e)}};var $t=class extends We{constructor(){super();this.root=new Ce,this.materials=[],this.meshes=[]}GetRootNode(){return this.root}MaterialCount(){return this.materials.length}MeshCount(){return this.meshes.length}MeshInstanceCount(){let e=0;return this.root.Enumerate(t=>{e+=t.MeshIndexCount()}),e}VertexCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexCount()}),e}VertexColorCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexColorCount()}),e}NormalCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.NormalCount()}),e}TextureUVCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TextureUVCount()}),e}TriangleCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TriangleCount()}),e}AddMaterial(e){return this.materials.push(e),this.materials.length-1}GetMaterial(e){return this.materials[e]}AddMesh(e){return this.meshes.push(e),this.meshes.length-1}AddMeshToRootNode(e){let t=this.AddMesh(e);return this.root.AddMeshIndex(t),t}RemoveMesh(e){this.meshes.splice(e,1),this.root.Enumerate(t=>{for(let r=0;r<t.meshIndices.length;r++)t.meshIndices[r]===e?(t.meshIndices.splice(r,1),r-=1):t.meshIndices[r]>e&&(t.meshIndices[r]-=1)})}GetMesh(e){return this.meshes[e]}GetMeshInstance(e){let t=null;if(this.root.Enumerate(s=>{s.GetId()===e.nodeId&&(t=s)}),t===null||t.GetMeshIndices().indexOf(e.meshIndex)===-1)return null;let i=this.GetMesh(e.meshIndex),n=new tt(t.GetId(),e.meshIndex);return new Ft(n,t,i)}EnumerateMeshes(e){for(let t of this.meshes)e(t)}EnumerateMeshInstances(e){this.root.Enumerate(t=>{for(let r of t.GetMeshIndices()){let i=new tt(t.GetId(),r),n=this.GetMesh(r),s=new Ft(i,t,n);e(s)}})}EnumerateTransformedMeshes(e){this.EnumerateMeshInstances(t=>{let r=t.GetTransformedMesh();e(r)})}EnumerateVertices(e){this.EnumerateMeshInstances(t=>{t.EnumerateVertices(e)})}EnumerateTriangleVertexIndices(e){this.EnumerateMeshInstances(t=>{t.EnumerateTriangleVertexIndices(e)})}EnumerateTriangleVertices(e){this.EnumerateMeshInstances(t=>{t.EnumerateTriangleVertices(e)})}};var un=class{constructor(e){this.params={getDefaultMaterialColor:()=>new N(0,0,0)},xt(e,this.params),this.defaultMaterialIndex=null}Finalize(e){this.Reset(),this.FinalizeMeshes(e),this.FinalizeMaterials(e),this.FinalizeNodes(e)}FinalizeMaterials(e){if(!(e.VertexColorCount()>0))return;let r=new Map;for(let i=0;i<e.MeshCount();i++){let n=e.GetMesh(i);for(let s=0;s<n.TriangleCount();s++){let l=n.GetTriangle(s),a=l.HasVertexColors();r.has(l.mat)?a||r.set(l.mat,!1):r.set(l.mat,a)}}for(let[i,n]of r){let s=e.GetMaterial(i);s.vertexColors=n}}FinalizeMeshes(e){for(let t=0;t<e.MeshCount();t++){let r=e.GetMesh(t);if(et(r)===Le.Empty){e.RemoveMesh(t),t=t-1;continue}this.FinalizeMesh(e,r)}}FinalizeMesh(e,t){function r(n){function s(u,h,f,d,c){function p(C,E){for(let T=0;T<C.length;T++){let I=C[T];if(ce(I,E))return!0}return!1}let m=[],g=c.get(f);for(let C=0;C<g.length;C++){let E=g[C],T=u.GetTriangle(E);if(h.curve===T.curve){let I=d[E];p(m,I)||m.push(I)}}let x=new M(0,0,0);for(let C=0;C<m.length;C++)x=Ur(x,m[C]);return x.MultiplyScalar(1/m.length),x.Normalize(),u.AddNormal(x)}let l=[],a=new Map;for(let u=0;u<n.VertexCount();u++)a.set(u,[]);for(let u=0;u<n.TriangleCount();u++){let h=n.GetTriangle(u),f=n.GetVertex(h.v0),d=n.GetVertex(h.v1),c=n.GetVertex(h.v2),p=at(f,d,c);l.push(p),a.get(h.v0).push(u),a.get(h.v1).push(u),a.get(h.v2).push(u)}for(let u=0;u<n.TriangleCount();u++){let h=n.GetTriangle(u);if(!h.HasNormals()){let f=s(n,h,h.v0,l,a),d=s(n,h,h.v1,l,a),c=s(n,h,h.v2,l,a);h.SetNormals(f,d,c)}}}let i={calculateCurveNormals:!1};for(let n=0;n<t.TriangleCount();n++){let s=t.GetTriangle(n);this.FinalizeTriangle(t,s,i),s.mat===null&&(s.mat=this.GetDefaultMaterialIndex(e))}i.calculateCurveNormals&&r(t)}FinalizeTriangle(e,t,r){if(!t.HasNormals())if(t.curve===null||t.curve===0){let i=e.GetVertex(t.v0),n=e.GetVertex(t.v1),s=e.GetVertex(t.v2),l=at(i,n,s),a=e.AddNormal(l);t.SetNormals(a,a,a)}else r.calculateCurveNormals=!0;t.curve===null&&(t.curve=0)}FinalizeNodes(e){let t=e.GetRootNode(),r=[];t.EnumerateChildren(i=>{i.IsEmpty()&&r.push(i)});for(let i=0;i<r.length;i++){let n=r[i],s=n.GetParent();s!==null&&(s.RemoveChildNode(n),s.IsEmpty()&&r.push(s))}}GetDefaultMaterialIndex(e){if(this.defaultMaterialIndex===null){let t=this.params.getDefaultMaterialColor(),r=new q;r.color=t,r.isDefault=!0,this.defaultMaterialIndex=e.AddMaterial(r)}return this.defaultMaterialIndex}Reset(){this.defaultMaterialIndex=null}};function ri(o,e){new un(e).Finalize(o)}function hn(o){function e(n){return n!=null}function t(n){return!(!e(n)||isNaN(n))}function r(n,s){return!(!t(n)||n<0||n>=s)}function i(n,s){function l(a,u,h){return!(!r(h.v0,u.VertexCount())||!r(h.v1,u.VertexCount())||!r(h.v2,u.VertexCount())||h.HasVertexColors()&&(!r(h.c0,u.VertexColorCount())||!r(h.c1,u.VertexColorCount())||!r(h.c2,u.VertexColorCount()))||!r(h.n0,u.NormalCount())||!r(h.n1,u.NormalCount())||!r(h.n2,u.NormalCount())||h.HasTextureUVs()&&(!r(h.u0,u.TextureUVCount())||!r(h.u1,u.TextureUVCount())||!r(h.u2,u.TextureUVCount()))||!r(h.mat,a.MaterialCount())||!t(h.curve))}for(let a=0;a<s.VertexCount();a++){let u=s.GetVertex(a);if(!t(u.x)||!t(u.y)||!t(u.z))return!1}for(let a=0;a<s.VertexColorCount();a++){let u=s.GetVertexColor(a);if(!t(u.r)||!t(u.g)||!t(u.b))return!1}for(let a=0;a<s.NormalCount();a++){let u=s.GetNormal(a);if(!t(u.x)||!t(u.y)||!t(u.z))return!1}for(let a=0;a<s.TextureUVCount();a++){let u=s.GetTextureUV(a);if(!t(u.x)||!t(u.y))return!1}for(let a=0;a<s.TriangleCount();a++){let u=s.GetTriangle(a);if(!l(n,s,u))return!1}return!0}for(let n=0;n<o.MeshCount();n++){let s=o.GetMesh(n);if(!i(o,s))return!1}return!0}var H=class{constructor(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null}Import(e,t,r,i){this.Clear(),this.name=e,this.extension=t,this.callbacks=i,this.model=new $t,this.error=!1,this.message=null,this.ResetContent(),this.ImportContent(r,()=>{this.CreateResult(i)})}Clear(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null,this.ClearContent()}CreateResult(e){if(this.error){e.onError(),e.onComplete();return}if(Gt(this.model)){this.SetError("The model doesn't contain any meshes."),e.onError(),e.onComplete();return}ri(this.model,{getDefaultMaterialColor:this.callbacks.getDefaultMaterialColor}),e.onSuccess(),e.onComplete()}CanImportExtension(e){return!1}GetUpDirection(){return v.Z}ClearContent(){}ResetContent(){}ImportContent(e,t){}GetModel(){return this.model}SetError(e){this.error=!0,e!=null&&(this.message=e)}WasError(){return this.error}GetErrorMessage(){return this.message}};function ze(o,e,t){let r=o.substring(e),i=r.indexOf(t);return i!==-1&&(r=r.substring(0,i)),r.trim()}function Re(o,e){if(e!==null){let t=o.indexOf(e);t!==-1&&(o=o.substring(0,t).trim())}return o.split(/\s+/u)}function be(o,e){function t(n,s){let l=n.trim();l.length>0&&s(l)}let r=0,i=o.indexOf(`
`,r);for(;i!==-1;)t(o.substring(r,i),e),r=i+1,i=o.indexOf(`
`,r);t(o.substring(r),e)}function Di(o){return(o&o-1)===0}function fn(o){if(Di(o))return o;let e=Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)));return parseInt(e,10)}function oe(o){o.transparent=!1,Ct(o.opacity,1)&&(o.transparent=!0)}var er=class extends H{constructor(){super();this.rhino=null}CanImportExtension(e){return e==="3dm"}GetUpDirection(){return v.Z}ClearContent(){this.instanceIdToObject=null,this.instanceIdToDefinition=null}ResetContent(){this.instanceIdToObject=new Map,this.instanceIdToDefinition=new Map}ImportContent(e,t){this.rhino===null?ae("loaders/rhino3dm.min.js").then(()=>{rhino3dm().then(r=>{this.rhino=r,this.ImportRhinoContent(e),t()})}).catch(()=>{t()}):(this.ImportRhinoContent(e),t())}ImportRhinoContent(e){let t=this.rhino.File3dm.fromByteArray(e);if(t===null){this.SetError("Failed to read Rhino file.");return}this.ImportRhinoDocument(t),Gt(this.model)&&this.SetError("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino.")}ImportRhinoDocument(e){this.InitRhinoInstances(e),this.ImportRhinoUserStrings(e),this.ImportRhinoGeometry(e)}InitRhinoInstances(e){let t=e.objects();for(let i=0;i<t.count;i++){let n=t.get(i),s=n.attributes();s.isInstanceDefinitionObject&&this.instanceIdToObject.set(s.id,n)}let r=e.instanceDefinitions();for(let i=0;i<r.count();i++){let n=r.get(i);this.instanceIdToDefinition.set(n.id,n)}}ImportRhinoUserStrings(e){let t=e.strings();if(t.count()>0){let r=new Ie("Document user texts");for(let i=0;i<t.count();i++){let n=t.get(i);r.AddProperty(new ne(he.Text,n[0],n[1]))}this.model.AddPropertyGroup(r)}}ImportRhinoGeometry(e){let t=e.objects();for(let r=0;r<t.count;r++){let i=t.get(r);this.ImportRhinoGeometryObject(e,i,[])}}ImportRhinoGeometryObject(e,t,r){let i=t.geometry(),n=t.attributes(),s=i.objectType;if(n.isInstanceDefinitionObject&&r.length===0)return;let l=null,a=!1;if(s===this.rhino.ObjectType.Mesh)l=i,a=!1;else if(s===this.rhino.ObjectType.Extrusion)l=i.getMesh(this.rhino.MeshType.Any),a=!0;else if(s===this.rhino.ObjectType.Brep){l=new this.rhino.Mesh;let u=i.faces();for(let h=0;h<u.count;h++){let f=u.get(h),d=f.getMesh(this.rhino.MeshType.Any);d&&(l.append(d),d.delete()),f.delete()}u.delete(),l.compact(),a=!0}else if(s===this.rhino.ObjectType.SubD)i.subdivide(3),l=this.rhino.Mesh.createFromSubDControlNet(i),a=!0;else if(s===this.rhino.ObjectType.InstanceReference){let u=i.parentIdefId;if(this.instanceIdToDefinition.has(u)){let f=this.instanceIdToDefinition.get(u).getObjectIds();for(let d=0;d<f.length;d++){let c=f[d];if(this.instanceIdToObject.has(c)){let p=this.instanceIdToObject.get(c);r.push(t),this.ImportRhinoGeometryObject(e,p,r),r.pop()}}}}l!==null&&(this.ImportRhinoMesh(e,l,t,r),a&&l.delete())}ImportRhinoMesh(e,t,r,i){let n=r.attributes(),s=this.GetMaterialIndex(e,r,i),l=t.toThreejsJSON(),a=qe(l.data,s);a.SetName(n.name);let u=n.getUserStrings();if(u.length>0){let h=new Ie("User texts");for(let f=0;f<u.length;f++){let d=u[f];h.AddProperty(new ne(he.Text,d[0],d[1]))}a.AddPropertyGroup(h)}if(i.length!==0){let h=new L().CreateIdentity();for(let d=i.length-1;d>=0;d--){let m=i[d].geometry().xform.toFloatArray(!1),g=new L(m);h=h.MultiplyMatrix(g)}let f=new k(h);Ue(a,f)}this.model.AddMeshToRootNode(a)}GetMaterialIndex(e,t,r){function i(l,a,u){let h=a.attributes();if(h.materialSource===l.ObjectMaterialSource.MaterialFromObject){let f=h.materialIndex;if(f>-1)return e.materials().get(f)}else if(h.materialSource===l.ObjectMaterialSource.MaterialFromLayer){let f=h.layerIndex;if(f>-1){let c=e.layers().get(f).renderMaterialIndex;if(c>-1)return e.materials().get(c)}}else if(h.materialSource===l.ObjectMaterialSource.MaterialFromParent&&u.length!==0)return i(l,u[0],[]);return null}function n(l,a){function u(c,p){c.Set(p.r,p.g,p.b)}function h(c){return c.r===0&&c.g===0&&c.b===0}function f(c){return c.r===255&&c.g===255&&c.b===255}let d=null;if(a===null)d=new q,d.color.Set(255,255,255);else{let c=a.physicallyBased();c.supported?(d=new je,d.metalness=c.metallic?1:0,d.roughness=c.roughness):(d=new q,u(d.ambient,a.ambientColor),u(d.specular,a.specularColor)),d.name=a.name,u(d.color,a.diffuseColor),d.opacity=1-a.transparency,oe(d),h(d.color)&&!f(a.reflectionColor)&&u(d.color,a.reflectionColor),h(d.color)&&!f(a.transparentColor)&&u(d.color,a.transparentColor)}for(let c=0;c<l.MaterialCount();c++)if(l.GetMaterial(c).IsEqual(d))return c;return l.AddMaterial(d)}let s=i(this.rhino,t,r);return n(this.model,s)}};var de=class{constructor(e,t){this.arrayBuffer=e,this.dataView=new DataView(e),this.isLittleEndian=t,this.position=0}GetPosition(){return this.position}SetPosition(e){this.position=e}GetByteLength(){return this.arrayBuffer.byteLength}Skip(e){this.position=this.position+e}End(){return this.position>=this.arrayBuffer.byteLength}ReadArrayBuffer(e){let t=new Uint8Array(this.arrayBuffer),r=new ArrayBuffer(e),i=new Uint8Array(r),n=t.subarray(this.position,this.position+e);return i.set(n,0),this.position+=e,r}ReadBoolean8(){let e=this.dataView.getInt8(this.position);return this.position=this.position+1,!!e}ReadCharacter8(){let e=this.dataView.getInt8(this.position);return this.position=this.position+1,e}ReadUnsignedCharacter8(){let e=this.dataView.getUint8(this.position);return this.position=this.position+1,e}ReadInteger16(){let e=this.dataView.getInt16(this.position,this.isLittleEndian);return this.position=this.position+2,e}ReadUnsignedInteger16(){let e=this.dataView.getUint16(this.position,this.isLittleEndian);return this.position=this.position+2,e}ReadInteger32(){let e=this.dataView.getInt32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadUnsignedInteger32(){let e=this.dataView.getUint32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadFloat32(){let e=this.dataView.getFloat32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadDouble64(){let e=this.dataView.getFloat64(this.position,this.isLittleEndian);return this.position=this.position+8,e}};var A={MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_INSTANCE_NAME:45073,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104},dn=class{constructor(){this.id=-1,this.name="",this.flags=-1,this.parentId=-1,this.instanceName="",this.pivot=[0,0,0],this.positions=[],this.rotations=[],this.scales=[]}},mn=class{constructor(){this.nodes=[],this.nodeIdToNode=new Map}IsEmpty(){return this.nodes.length===0}AddNode(e){this.nodes.push(e),this.nodeIdToNode.set(e.nodeId,e)}GetNodes(){return this.nodes}},tr=class extends H{constructor(){super()}CanImportExtension(e){return e==="3ds"}GetUpDirection(){return v.Z}ClearContent(){this.materialNameToIndex=null,this.meshNameToIndex=null,this.nodeList=null}ResetContent(){this.materialNameToIndex=new Map,this.meshNameToIndex=new Map,this.nodeList=new mn}ImportContent(e,t){this.ProcessBinary(e),t()}ProcessBinary(e){let t=new de(e,!0),r=t.GetByteLength();this.ReadChunks(t,r,(i,n)=>{i===A.MAIN3DS?this.ReadMainChunk(t,n):this.SkipChunk(t,n)})}ReadMainChunk(e,t){let r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(i,n)=>{i===A.EDIT3DS?this.ReadEditorChunk(e,n):i===A.KF3DS?this.ReadKeyFrameChunk(e,n):this.SkipChunk(e,n)}),this.BuildNodeHierarchy()}ReadEditorChunk(e,t){let r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(i,n)=>{i===A.EDIT_MATERIAL?this.ReadMaterialChunk(e,n):i===A.EDIT_OBJECT?this.ReadObjectChunk(e,n):this.SkipChunk(e,n)})}ReadMaterialChunk(e,t){let r=new q,i=this.GetChunkEnd(e,t),n=null,s=null;this.ReadChunks(e,i,(a,u)=>{a===A.MAT_NAME?r.name=this.ReadName(e):a===A.MAT_AMBIENT?r.ambient=this.ReadColorChunk(e,u):a===A.MAT_DIFFUSE?r.color=this.ReadColorChunk(e,u):a===A.MAT_SPECULAR?r.specular=this.ReadColorChunk(e,u):a===A.MAT_SHININESS?n=this.ReadPercentageChunk(e,u):a===A.MAT_SHININESS_STRENGTH?s=this.ReadPercentageChunk(e,u):a===A.MAT_TRANSPARENCY?(r.opacity=1-this.ReadPercentageChunk(e,u),oe(r)):a===A.MAT_TEXMAP?(r.diffuseMap=this.ReadTextureMapChunk(e,u),oe(r)):this.SkipChunk(e,u)}),n!==null&&s!==null&&(r.shininess=n*s/10);let l=this.model.AddMaterial(r);this.materialNameToIndex.set(r.name,l)}ReadTextureMapChunk(e,t){let r=new Se,i=this.GetChunkEnd(e,t);return this.ReadChunks(e,i,(n,s)=>{if(n===A.MAT_TEXMAP_NAME){let l=this.ReadName(e),a=this.callbacks.getTextureBuffer(l);r.name=l,a!==null&&(r.url=a.url,r.buffer=a.buffer)}else n===A.MAT_TEXMAP_UOFFSET?r.offset.x=e.ReadFloat32():n===A.MAT_TEXMAP_VOFFSET?r.offset.y=e.ReadFloat32():n===A.MAT_TEXMAP_USCALE?r.scale.x=e.ReadFloat32():n===A.MAT_TEXMAP_VSCALE?r.scale.y=e.ReadFloat32():n===A.MAT_TEXMAP_ROTATION?r.rotation=e.ReadFloat32()*Ke:this.SkipChunk(e,s)}),r}ReadColorChunk(e,t){let r=new N(0,0,0),i=this.GetChunkEnd(e,t),n=!1;return this.ReadChunks(e,i,(s,l)=>{s===A.MAT_COLOR?n||(r.r=e.ReadUnsignedCharacter8(),r.g=e.ReadUnsignedCharacter8(),r.b=e.ReadUnsignedCharacter8()):s===A.MAT_LIN_COLOR?(r.r=e.ReadUnsignedCharacter8(),r.g=e.ReadUnsignedCharacter8(),r.b=e.ReadUnsignedCharacter8(),n=!0):s===A.MAT_COLOR_F?n||(r.r=ue(e.ReadFloat32()),r.g=ue(e.ReadFloat32()),r.b=ue(e.ReadFloat32())):s===A.MAT_LIN_COLOR_F?(r.r=ue(e.ReadFloat32()),r.g=ue(e.ReadFloat32()),r.b=ue(e.ReadFloat32()),n=!0):this.SkipChunk(e,l)}),r}ReadPercentageChunk(e,t){let r=0,i=this.GetChunkEnd(e,t);return this.ReadChunks(e,i,(n,s)=>{n===A.PERCENTAGE?r=e.ReadUnsignedInteger16()/100:n===A.PERCENTAGE_F?r=e.ReadFloat32():this.SkipChunk(e,s)}),r}ReadObjectChunk(e,t){let r=this.GetChunkEnd(e,t),i=this.ReadName(e);this.ReadChunks(e,r,(n,s)=>{n===A.OBJ_TRIMESH?this.ReadMeshChunk(e,s,i):this.SkipChunk(e,s)})}ReadMeshChunk(e,t,r){function i(h,f){if(!f.IsValid())return;let d=f.Determinant(),c=_e(d);c&&(f=new L().CreateScale(-1,1,1).MultiplyMatrix(f));let p=f.Invert();if(p===null)return;let m=new k(p);Ue(h,m),c&&qr(h)}let n=new j;n.SetName(r);let s=this.GetChunkEnd(e,t),l=null;if(this.ReadChunks(e,s,(h,f)=>{h===A.TRI_VERTEX?this.ReadVerticesChunk(n,e):h===A.TRI_TEXVERTEX?this.ReadTextureVerticesChunk(n,e):h===A.TRI_FACE?this.ReadFacesChunk(n,e,f):h===A.TRI_TRANSFORMATION?l=this.ReadTransformationChunk(e):this.SkipChunk(e,f)}),n.VertexCount()===n.TextureUVCount())for(let h=0;h<n.TriangleCount();h++){let f=n.GetTriangle(h);f.SetTextureUVs(f.v0,f.v1,f.v2)}let a=new L(l);i(n,a);let u=this.model.AddMesh(n);this.meshNameToIndex.set(n.GetName(),u)}ReadVerticesChunk(e,t){let r=t.ReadUnsignedInteger16();for(let i=0;i<r;i++){let n=t.ReadFloat32(),s=t.ReadFloat32(),l=t.ReadFloat32();e.AddVertex(new M(n,s,l))}}ReadTextureVerticesChunk(e,t){let r=t.ReadUnsignedInteger16();for(let i=0;i<r;i++){let n=t.ReadFloat32(),s=t.ReadFloat32();e.AddTextureUV(new F(n,s))}}ReadFacesChunk(e,t,r){let i=this.GetChunkEnd(t,r),n=t.ReadUnsignedInteger16();for(let s=0;s<n;s++){let l=t.ReadUnsignedInteger16(),a=t.ReadUnsignedInteger16(),u=t.ReadUnsignedInteger16();t.ReadUnsignedInteger16(),e.AddTriangle(new z(l,a,u))}this.ReadChunks(t,i,(s,l)=>{s===A.TRI_MATERIAL?this.ReadFaceMaterialsChunk(e,t):s===A.TRI_SMOOTH?this.ReadFaceSmoothingGroupsChunk(e,n,t):this.SkipChunk(t,l)})}ReadFaceMaterialsChunk(e,t){let r=this.ReadName(t),i=this.materialNameToIndex.get(r),n=t.ReadUnsignedInteger16();for(let s=0;s<n;s++){let l=t.ReadUnsignedInteger16(),a=e.GetTriangle(l);i!==void 0&&(a.mat=i)}}ReadFaceSmoothingGroupsChunk(e,t,r){for(let i=0;i<t;i++){let n=r.ReadUnsignedInteger32(),s=e.GetTriangle(i);s.curve=n}}ReadTransformationChunk(e){let t=[];for(let r=0;r<4;r++){for(let i=0;i<3;i++)t.push(e.ReadFloat32());r<3?t.push(0):t.push(1)}return t}ReadKeyFrameChunk(e,t){let r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(i,n)=>{i===A.OBJECT_NODE?this.ReadObjectNodeChunk(e,n):this.SkipChunk(e,n)})}BuildNodeHierarchy(){function e(r,i){function n(u){return u.positions.length===0?[0,0,0]:u.positions[0]}function s(u){function h(d){let c=[0,0,0,1],p=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);if(p>0){let m=d[3]*-.5,g=Math.sin(m)/p;c=[g*d[0],g*d[1],g*d[2],Math.cos(m)]}return c}if(u.rotations.length===0)return[0,0,0,1];let f=u.rotations[0];return h(f)}function l(u){return u.scales.length===0?[1,1,1]:u.scales[0]}let a=new L;if(a.ComposeTRS(Ae(n(r)),$e(s(r)),Ae(l(r))),i){let u=r.pivot;a=new L().CreateTranslation(-u[0],-u[1],-u[2]).MultiplyMatrix(a)}return new k(a)}let t=this.model.GetRootNode();if(this.nodeList.IsEmpty())for(let r=0;r<this.model.MeshCount();r++)t.AddMeshIndex(r);else{let r=new Map;for(let i of this.nodeList.GetNodes()){let n=new Ce;i.name.length>0&&i.name!=="$$$DUMMY"&&(n.SetName(i.name),i.instanceName.length>0&&n.SetName(n.GetName()+" "+i.instanceName)),i.parentId===65535||!r.has(i.parentId)?t.AddChildNode(n):r.get(i.parentId).AddChildNode(n),r.set(i.id,n);let s=this.meshNameToIndex.has(i.name);n.SetTransformation(e(i,s)),s&&(n.SetType(Ge.MeshNode),n.AddMeshIndex(this.meshNameToIndex.get(i.name)))}}}ReadObjectNodeChunk(e,t){function r(s,l,a){let u=[];l.Skip(10);let h=l.ReadInteger32();for(let f=0;f<h;f++){l.ReadInteger32(),l.ReadUnsignedInteger16()!==0&&l.ReadFloat32();let c=null;if(a===A.OBJECT_ROTATION){let p=l.ReadFloat32();c=s.ReadVector(l),c[3]=p}else c=s.ReadVector(l);u.push(c)}return u}let i=new dn,n=this.GetChunkEnd(e,t);this.ReadChunks(e,n,(s,l)=>{s===A.OBJECT_HIERARCHY?(i.name=this.ReadName(e),i.flags=e.ReadUnsignedInteger32(),i.parentId=e.ReadUnsignedInteger16()):s===A.OBJECT_INSTANCE_NAME?i.instanceName=this.ReadName(e):s===A.OBJECT_PIVOT?i.pivot=this.ReadVector(e):s===A.OBJECT_POSITION?i.positions=r(this,e,A.OBJECT_POSITION):s===A.OBJECT_ROTATION?i.rotations=r(this,e,A.OBJECT_ROTATION):s===A.OBJECT_SCALE?i.scales=r(this,e,A.OBJECT_SCALE):s===A.OBJECT_ID?i.id=e.ReadUnsignedInteger16():this.SkipChunk(e,l)}),this.nodeList.AddNode(i)}ReadName(e){let t="",r=0,i=0;for(;i<64&&(r=e.ReadCharacter8(),r!==0);)t=t+String.fromCharCode(r),i=i+1;return t}ReadVector(e){return[e.ReadFloat32(),e.ReadFloat32(),e.ReadFloat32()]}ReadChunks(e,t,r){for(;e.GetPosition()<=t-6;){let i=e.ReadUnsignedInteger16(),n=e.ReadUnsignedInteger32();r(i,n)}}GetChunkEnd(e,t){return e.GetPosition()+t-6}SkipChunk(e,t){e.Skip(t-6)}};var Te={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},Fe={SCALAR:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6},ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Vi={GLTF_STRING:1179937895,JSON_CHUNK_TYPE:1313821514,BINARY_CHUNK_TYPE:5130562};function rr(o){return Pe(st(o[0]),st(o[1]),st(o[2]))}function qn(o,e){function t(r,i){let n=r;return i!==Te.FLOAT&&(n/=255),ue(st(n))}return new N(t(o[0],e),t(o[1],e),t(o[2],e))}var cn=class{constructor(e){this.reader=new de(e,!0),this.componentType=null,this.dataType=null,this.byteStride=null,this.dataCount=null,this.sparseReader=null}SetComponentType(e){this.componentType=e}SetDataType(e){e==="SCALAR"?this.dataType=Fe.SCALAR:e==="VEC2"?this.dataType=Fe.VEC2:e==="VEC3"?this.dataType=Fe.VEC3:e==="VEC4"?this.dataType=Fe.VEC4:e==="MAT2"?this.dataType=Fe.MAT2:e==="MAT3"?this.dataType=Fe.MAT3:e==="MAT4"&&(this.dataType=Fe.MAT4)}SetByteStride(e){this.byteStride=e}SetDataCount(e){this.dataCount=e}SetSparseReader(e,t){this.sparseReader={indexReader:e,valueReader:t}}ReadArrayBuffer(e){return this.reader.ReadArrayBuffer(e)}GetDataCount(){return this.dataCount}ReadData(){if(this.dataType===null)return null;if(this.dataType===Fe.SCALAR){let e=this.ReadComponent();return this.SkipBytesByStride(1),e}else if(this.dataType===Fe.VEC2){let e=this.ReadComponent(),t=this.ReadComponent();return this.SkipBytesByStride(2),new F(e,t)}else if(this.dataType===Fe.VEC3){let e=this.ReadComponent(),t=this.ReadComponent(),r=this.ReadComponent();return this.SkipBytesByStride(3),new M(e,t,r)}else if(this.dataType===Fe.VEC4){let e=this.ReadComponent(),t=this.ReadComponent(),r=this.ReadComponent(),i=this.ReadComponent();return this.SkipBytesByStride(4),new Me(e,t,r,i)}return null}EnumerateData(e){if(this.sparseReader===null)for(let t=0;t<this.dataCount;t++)e(this.ReadData());else{let t=[];for(let i=0;i<this.sparseReader.indexReader.GetDataCount();i++){let n=this.sparseReader.indexReader.ReadData(),s=this.sparseReader.valueReader.ReadData();t.push({index:n,value:s})}let r=0;for(let i=0;i<this.dataCount;i++){let n=this.ReadData();r<t.length&&t[r].index===i?(e(t[r].value),r+=1):e(n)}}}SkipBytes(e){this.reader.Skip(e)}ReadComponent(){return this.componentType===null?null:this.componentType===Te.BYTE?this.reader.ReadCharacter8():this.componentType===Te.UNSIGNED_BYTE?this.reader.ReadUnsignedCharacter8():this.componentType===Te.SHORT?this.reader.ReadInteger16():this.componentType===Te.UNSIGNED_SHORT?this.reader.ReadUnsignedInteger16():this.componentType===Te.UNSIGNED_INT?this.reader.ReadInteger32():this.componentType===Te.FLOAT?this.reader.ReadFloat32():null}SkipBytesByStride(e){if(this.byteStride===null)return;let t=e*this.GetComponentSize();this.reader.Skip(this.byteStride-t)}GetComponentSize(){return this.componentType===Te.BYTE||this.componentType===Te.UNSIGNED_BYTE?1:this.componentType===Te.SHORT||this.componentType===Te.UNSIGNED_SHORT?2:this.componentType===Te.UNSIGNED_INT||this.componentType===Te.FLOAT?4:0}},pn=class{constructor(){this.supportedExtensions=["KHR_draco_mesh_compression","KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"],this.draco=null}LoadLibraries(e,t){if(e===void 0){t.onSuccess();return}this.draco===null&&e.indexOf("KHR_draco_mesh_compression")!==-1?ae("loaders/draco_decoder.js").then(()=>{DracoDecoderModule().then(r=>{this.draco=r,t.onSuccess()})}).catch(()=>{t.onError()}):t.onSuccess()}GetUnsupportedExtensions(e){let t=[];if(e===void 0)return t;for(let r=0;r<e.length;r++){let i=e[r];this.supportedExtensions.indexOf(i)===-1&&t.push(i)}return t}ProcessMaterial(e,t,r){if(e.extensions===void 0)return null;let i=e.extensions.KHR_materials_pbrSpecularGlossiness;if(i===void 0)return null;let n=new q,s=i.diffuseFactor;s!==void 0&&(n.color=rr(s),n.opacity=s[3]);let l=i.diffuseTexture;l!==void 0&&(n.diffuseMap=r(l));let a=i.specularFactor;a!==void 0&&(n.specular=rr(a));let u=i.specularGlossinessTexture;u!==void 0&&(n.specularMap=r(u));let h=i.glossinessFactor;return h!==void 0&&(n.shininess=h),n}ProcessTexture(e,t){if(e.extensions===void 0)return;let r=e.extensions.KHR_texture_transform;r!==void 0&&(r.offset!==void 0&&(t.offset.x=r.offset[0],t.offset.y=-r.offset[1]),r.scale!==void 0&&(t.scale.x=r.scale[0],t.scale.y=r.scale[1]),r.rotation!==void 0&&(t.rotation=-r.rotation))}ProcessPrimitive(e,t,r,i){function n(R,D,V,te,U){let me=D.GetAttributeByUniqueId(V,te),De=me.num_components(),dt=V.num_points()*De,mt=dt*4,it=R._malloc(mt);D.GetAttributeDataArrayForAllPoints(V,me,R.DT_FLOAT32,mt,it);let Q=new Float32Array(R.HEAPF32.buffer,it,dt).slice();if(De===2)for(let _=0;_<Q.length;_+=2)U(new F(Q[_+0],Q[_+1]));else if(De===3)for(let _=0;_<Q.length;_+=3)U(new M(Q[_+0],Q[_+1],Q[_+2]));else if(De===4)for(let _=0;_<Q.length;_+=4)U(new Me(Q[_+0],Q[_+1],Q[_+2],Q[_+3]));R._free(it)}if(this.draco===null||r.extensions===void 0||r.extensions.KHR_draco_mesh_compression===void 0)return!1;let s=new this.draco.Decoder,l=new this.draco.DecoderBuffer,a=r.extensions.KHR_draco_mesh_compression,u=t.bufferViews[a.bufferView],f=e.GetReaderFromBufferView(u).ReadArrayBuffer(u.byteLength);if(l.Init(new Int8Array(f),f.byteLength),s.GetEncodedGeometryType(l)!==this.draco.TRIANGULAR_MESH)return!0;let c=new this.draco.Mesh;if(!s.DecodeBufferToMesh(l,c).ok())return!0;let m=a.attributes.POSITION!==void 0,g=!1,x=a.attributes.NORMAL!==void 0,C=a.attributes.TEXCOORD_0!==void 0;if(!m)return!0;let E=i.VertexCount(),T=i.VertexColorCount(),I=i.NormalCount(),w=i.TextureUVCount();n(this.draco,s,c,a.attributes.POSITION,R=>{i.AddVertex(R)}),x&&n(this.draco,s,c,a.attributes.NORMAL,R=>{i.AddNormal(R)}),C&&n(this.draco,s,c,a.attributes.TEXCOORD_0,R=>{R.y=-R.y,i.AddTextureUV(R)});let S=c.num_faces()*3,b=S*4,G=this.draco._malloc(b);s.GetTrianglesUInt32Array(c,b,G);let O=new Uint32Array(this.draco.HEAPU32.buffer,G,S).slice();for(let R=0;R<O.length;R+=3){let D=O[R],V=O[R+1],te=O[R+2];e.AddTriangle(r,i,D,V,te,g,x,C,E,T,I,w)}return this.draco._free(G),!0}},ir=class extends H{constructor(){super();this.gltfExtensions=new pn}CanImportExtension(e){return e==="gltf"||e==="glb"}GetUpDirection(){return v.Y}ClearContent(){this.bufferContents=null,this.imageIndexToTextureParams=null}ResetContent(){this.bufferContents=[],this.imageIndexToTextureParams=new Map}ImportContent(e,t){this.extension==="gltf"?this.ProcessGltf(e,t):this.extension==="glb"&&this.ProcessBinaryGltf(e,t)}ProcessGltf(e,t){let r=K(e),i=JSON.parse(r);if(i.asset.version!=="2.0"){this.SetError("Invalid glTF version."),t();return}for(let n=0;n<i.buffers.length;n++){let s=null,l=i.buffers[n],a=ot(l.uri);if(a!==null)s=a.buffer;else{let u=this.callbacks.getFileBuffer(l.uri);u!==null&&(s=u)}if(s===null){this.SetError("One of the requested buffers is missing."),t();return}this.bufferContents.push(s)}this.ProcessMainFile(i,t)}ProcessBinaryGltf(e,t){function r(u){let h=u.ReadUnsignedInteger32(),f=u.ReadUnsignedInteger32(),d=u.ReadArrayBuffer(h);return{type:f,buffer:d}}let i=new de(e,!0);if(i.ReadUnsignedInteger32()!==Vi.GLTF_STRING){this.SetError("Invalid glTF file."),t();return}if(i.ReadUnsignedInteger32()!==2){this.SetError("Invalid glTF version."),t();return}if(i.ReadUnsignedInteger32()!==i.GetByteLength()){this.SetError("Invalid glTF file."),t();return}let a=null;for(;!i.End();){let u=r(i);u.type===Vi.JSON_CHUNK_TYPE?a=K(u.buffer):u.type===Vi.BINARY_CHUNK_TYPE&&this.bufferContents.push(u.buffer)}if(a!==null){let u=JSON.parse(a);this.ProcessMainFile(u,t)}}ProcessMainFile(e,t){let r=this.gltfExtensions.GetUnsupportedExtensions(e.extensionsRequired);if(r.length>0){this.SetError("Unsupported extension: "+r.join(", ")+"."),t();return}this.gltfExtensions.LoadLibraries(e.extensionsRequired,{onSuccess:()=>{this.ImportModel(e),t()},onError:()=>{this.SetError("Failed to load draco decoder."),t()}})}ImportModel(e){let t=e.materials;if(t!==void 0)for(let i of t)this.ImportMaterial(e,i);let r=e.meshes;if(r!==void 0)for(let i of r)this.ImportMesh(e,i);this.ImportNodes(e),this.ImportModelProperties(e)}ImportModelProperties(e){function t(r,i,n){let s=new Ie(i);for(let l in n)if(Object.prototype.hasOwnProperty.call(n,l)&&typeof n[l]=="string"){let a=new ne(he.Text,l,n[l]);s.AddProperty(a)}return s.PropertyCount()>0&&r.AddPropertyGroup(s),s}t(this.model,"Asset properties",e.asset),e.asset.extras&&t(this.model,"Extras",e.asset.extras)}GetDefaultScene(e){let t=e.scene||0;return t>=e.scenes.length?null:e.scenes[t]}ImportMaterial(e,t){let r=new je;if(t.name!==void 0&&(r.name=t.name),r.color=rr([1,1,1]),t.pbrMetallicRoughness!==void 0){let n=t.pbrMetallicRoughness.baseColorFactor;n!==void 0&&(r.color=rr(n),r.opacity=n[3]);let s=t.pbrMetallicRoughness.metallicFactor;s!==void 0&&(r.metalness=s);let l=t.pbrMetallicRoughness.roughnessFactor;l!==void 0&&(r.roughness=l);let a=t.emissiveFactor;a!==void 0&&(r.emissive=rr(a)),r.diffuseMap=this.ImportTexture(e,t.pbrMetallicRoughness.baseColorTexture),r.metalnessMap=this.ImportTexture(e,t.pbrMetallicRoughness.metallicRoughnessTexture),r.normalMap=this.ImportTexture(e,t.normalTexture),r.emissiveMap=this.ImportTexture(e,t.emissiveTexture),r.diffuseMap!==null&&(r.multiplyDiffuseMap=!0);let u=t.alphaMode;u!==void 0&&(u==="BLEND"?r.transparent=!0:u==="MASK"&&(r.transparent=!0,r.alphaTest=t.alphaCutoff||.5))}let i=this.gltfExtensions.ProcessMaterial(t,r,n=>this.ImportTexture(e,n));i!==null&&(r=i),this.model.AddMaterial(r)}ImportTexture(e,t){if(t==null)return null;let r=new Se,n=e.textures[t.index].source,s=e.images[n],l=null;if(this.imageIndexToTextureParams.has(n))l=this.imageIndexToTextureParams.get(n);else{l={name:null,url:null,buffer:null};let a=n.toString();if(s.uri!==void 0){let u=ot(s.uri);if(u!==null)l.name="Embedded_"+a+"."+Qe(u.mimeType),l.url=_t(u.buffer,u.mimeType),l.buffer=u.buffer;else{let h=this.callbacks.getTextureBuffer(s.uri);l.name=s.uri,h!==null&&(l.url=h.url,l.buffer=h.buffer)}}else if(s.bufferView!==void 0){let u=e.bufferViews[s.bufferView],h=this.GetReaderFromBufferView(u);if(h!==null){let f=h.ReadArrayBuffer(u.byteLength);l.name="Binary_"+a+"."+Qe(s.mimeType),l.url=_t(f,s.mimeType),l.buffer=f}}this.imageIndexToTextureParams.set(n,l)}return r.name=l.name,r.url=l.url,r.buffer=l.buffer,this.gltfExtensions.ProcessTexture(t,r),r}ImportMesh(e,t){let r=new j;this.model.AddMesh(r),t.name!==void 0&&r.SetName(t.name);for(let i=0;i<t.primitives.length;i++){let n=t.primitives[i];this.ImportPrimitive(e,n,r)}}ImportPrimitive(e,t,r){if(this.gltfExtensions.ProcessPrimitive(this,e,t,r)||t.attributes===void 0)return;let i=t.attributes.POSITION!==void 0,n=t.attributes.COLOR_0!==void 0,s=t.attributes.NORMAL!==void 0,l=t.attributes.TEXCOORD_0!==void 0,a=t.indices!==void 0,u=ut.TRIANGLES;if(t.mode!==void 0&&(u=t.mode),u!==ut.TRIANGLES&&u!==ut.TRIANGLE_STRIP&&u!==ut.TRIANGLE_FAN)return;let h=r.VertexCount(),f=r.VertexColorCount(),d=r.NormalCount(),c=r.TextureUVCount();if(i){let m=e.accessors[t.attributes.POSITION],g=this.GetReaderFromAccessor(e,m);if(g===null)return;g.EnumerateData(x=>{r.AddVertex(x)})}else return;if(n){let m=e.accessors[t.attributes.COLOR_0],g=this.GetReaderFromAccessor(e,m);if(g===null)return;g.EnumerateData(x=>{let C=qn([x.x,x.y,x.z],g.componentType);r.AddVertexColor(C)})}if(s){let m=e.accessors[t.attributes.NORMAL],g=this.GetReaderFromAccessor(e,m);if(g===null)return;g.EnumerateData(x=>{r.AddNormal(x)})}if(l){let m=e.accessors[t.attributes.TEXCOORD_0],g=this.GetReaderFromAccessor(e,m);if(g===null)return;g.EnumerateData(x=>{x.y=-x.y,r.AddTextureUV(x)})}let p=[];if(a){let m=e.accessors[t.indices],g=this.GetReaderFromAccessor(e,m);if(g===null)return;g.EnumerateData(x=>{p.push(x)})}else for(let m=0;m<r.VertexCount();m++)p.push(m);if(u===ut.TRIANGLES)for(let m=0;m<p.length;m+=3){let g=p[m],x=p[m+1],C=p[m+2];this.AddTriangle(t,r,g,x,C,n,s,l,h,f,d,c)}else if(u===ut.TRIANGLE_STRIP)for(let m=0;m<p.length-2;m++){let g=p[m],x=p[m+1],C=p[m+2];if(m%2===1){let E=x;x=C,C=E}this.AddTriangle(t,r,g,x,C,n,s,l,h,f,d,c)}else if(u===ut.TRIANGLE_FAN)for(let m=1;m<p.length-1;m++){let g=p[0],x=p[m],C=p[m+1];this.AddTriangle(t,r,g,x,C,n,s,l,h,f,d,c)}}AddTriangle(e,t,r,i,n,s,l,a,u,h,f,d){let c=new z(u+r,u+i,u+n);s&&c.SetVertexColors(h+r,h+i,h+n),l&&c.SetNormals(f+r,f+i,f+n),a&&c.SetTextureUVs(d+r,d+i,d+n),e.material!==void 0&&(c.mat=e.material),t.AddTriangle(c)}ImportNodes(e){let t=this.GetDefaultScene(e);if(t===null)return;let r=this.model.GetRootNode();for(let i of t.nodes){let n=e.nodes[i];this.ImportNode(e,n,r)}}ImportNode(e,t,r){function i(s){let l=new L().CreateIdentity();if(s.matrix!==void 0)l.Set(s.matrix);else{let a=[0,0,0],u=[0,0,0,1],h=[1,1,1];s.translation!==void 0&&(a=s.translation),s.rotation!==void 0&&(u=s.rotation),s.scale!==void 0&&(h=s.scale),l.ComposeTRS(Ae(a),$e(u),Ae(h))}return new k(l)}if(t.children===void 0&&t.mesh===void 0)return;let n=new Ce;if(t.name!==void 0&&n.SetName(t.name),n.SetTransformation(i(t)),r.AddChildNode(n),t.children!==void 0)for(let s of t.children){let l=e.nodes[s];this.ImportNode(e,l,n)}t.mesh!==void 0&&((t.children===void 0||t.children.length===0)&&n.SetType(Ge.MeshNode),n.AddMeshIndex(t.mesh))}GetReaderFromBufferView(e){let t=e.buffer||0,r=this.bufferContents[t];if(r==null)return null;let i=new cn(r);i.SkipBytes(e.byteOffset||0);let n=e.byteStride;return n!==void 0&&n!==0&&i.SetByteStride(n),i}GetReaderFromAccessor(e,t){let r=t.bufferView||0,i=e.bufferViews[r],n=this.GetReaderFromBufferView(i);if(n===null)return null;if(n.SetComponentType(t.componentType),n.SetDataType(t.type),n.SetDataCount(t.count),n.SkipBytes(t.byteOffset||0),t.sparse!==void 0){let s=this.GetReaderFromSparseAccessor(e,t.sparse.indices,t.sparse.indices.componentType,"SCALAR",t.sparse.count),l=this.GetReaderFromSparseAccessor(e,t.sparse.values,t.componentType,t.type,t.sparse.count);s!==null&&l!==null&&n.SetSparseReader(s,l)}return n}GetReaderFromSparseAccessor(e,t,r,i,n){if(t.bufferView===void 0)return null;let s=e.bufferViews[t.bufferView],l=this.GetReaderFromBufferView(s);return l===null?null:(l.SetComponentType(r),l.SetDataType(i),l.SetDataCount(n),l.SkipBytes(t.byteOffset||0),l)}};var nr=class extends H{constructor(){super();this.ifc=null}CanImportExtension(e){return e==="ifc"}GetUpDirection(){return v.Y}ClearContent(){this.materialNameToIndex=null,this.expressIDToMesh=null}ResetContent(){this.materialNameToIndex=new Map,this.expressIDToMesh=new Map}ImportContent(e,t){this.ifc===null?ae("loaders/web-ifc-api-browser.js").then(()=>{this.ifc=new WebIFC.IfcAPI,this.ifc.Init().then(()=>{this.ImportIfcContent(e),t()})}).catch(()=>{t()}):(this.ImportIfcContent(e),t())}ImportIfcContent(e){let t=new Uint8Array(e),r=this.ifc.OpenModel(t,{COORDINATE_TO_ORIGIN:!0}),i=this.ifc.LoadAllGeometry(r);for(let n=0;n<i.size();n++){let s=i.get(n);s.geometries.size()>0&&this.ImportIfcMesh(r,s)}this.ImportProperties(r),this.ifc.CloseModel(r)}ImportIfcMesh(e,t){let r=new j;r.SetName("Mesh "+t.expressID.toString());let i=0,n=t.geometries;for(let s=0;s<n.size();s++){let l=n.get(s),a=this.ifc.GetGeometry(e,l.geometryExpressID),u=this.ifc.GetVertexArray(a.GetVertexData(),a.GetVertexDataSize()),h=this.ifc.GetIndexArray(a.GetIndexData(),a.GetIndexDataSize()),f=this.GetMaterialIndexByColor(l.color),d=new L(l.flatTransformation),c=new k(d);for(let p=0;p<u.length;p+=6){let m=u[p],g=u[p+1],x=u[p+2],C=new M(m,g,x),E=c.TransformCoord3D(C);r.AddVertex(E)}for(let p=0;p<h.length;p+=3){let m=h[p],g=h[p+1],x=h[p+2],C=new z(i+m,i+g,i+x);C.SetMaterial(f),r.AddTriangle(C)}i+=u.length/6}this.expressIDToMesh.set(t.expressID,r),this.model.AddMeshToRootNode(r)}ImportProperties(e){let t=this.ifc.GetLineIDsWithType(e,WebIFC.IFCRELDEFINESBYPROPERTIES);for(let r=0;r<t.size();r++){let i=t.get(r),n=this.ifc.GetLine(e,i);Array.isArray(n.RelatingPropertyDefinition)||n.RelatedObjects.forEach(s=>{let l=null;if(this.expressIDToMesh.has(s.value)?l=this.expressIDToMesh.get(s.value):this.ifc.GetLine(e,s.value,!0).type===WebIFC.IFCBUILDING&&(l=this.model),l===null)return;let a=n.RelatingPropertyDefinition,u=this.ifc.GetLine(e,a.value,!0);if(!u||!u.HasProperties)return;let h=new Ie(u.Name.value);u.HasProperties.forEach(f=>{if(!f||!f.Name||!f.NominalValue)return;let d=null,c=this.GetIFCString(f.Name.value),p=null;switch(f.NominalValue.label){case"IFCTEXT":case"IFCLABEL":case"IFCIDENTIFIER":d=new ne(he.Text,c,this.GetIFCString(f.NominalValue.value));break;case"IFCBOOLEAN":case"IFCLOGICAL":p="Unknown",f.NominalValue.value==="T"?p="True":f.NominalValue.value==="F"&&(p="False"),d=new ne(he.Text,c,p);break;case"IFCINTEGER":case"IFCCOUNTMEASURE":d=new ne(he.Integer,c,f.NominalValue.value);break;case"IFCREAL":case"IFCLENGTHMEASURE":case"IFCPOSITIVELENGTHMEASURE":case"IFCAREAMEASURE":case"IFCVOLUMEMEASURE":case"IFCRATIOMEASURE":case"IFCPOSITIVERATIOMEASURE":case"IFCMASSMEASURE":case"IFCMASSPERLENGTHMEASURE":case"IFCPLANEANGLEMEASURE":case"IFCTHERMALTRANSMITTANCEMEASURE":d=new ne(he.Number,c,f.NominalValue.value);break;default:console.log(f.NominalValue.label),console.log(f.NominalValue.value);break}d!==null&&h.AddProperty(d)}),h.PropertyCount()>0&&l.AddPropertyGroup(h)})}}GetMaterialIndexByColor(e){let t=Pe(e.x,e.y,e.z),r="Color "+re(t.r)+re(t.g)+re(t.b)+re(parseInt(e.w*255,10));if(this.materialNameToIndex.has(r))return this.materialNameToIndex.get(r);{let i=new q;i.name=r,i.color=t,i.opacity=e.w,oe(i);let n=this.model.AddMaterial(i);return this.materialNameToIndex.set(r,n),n}}GetIFCString(e){let t=this.DecodeIFCString(e);return t.length===0&&(t="-"),t}DecodeIFCString(e){let t=/\\X2\\(.*?)\\X0\\/uig,r=e,i=t.exec(e);for(;i;){let n=String.fromCharCode(parseInt(i[1],16));r=r.replace(i[0],n),i=t.exec(e)}return r}};var Nt=class{constructor(){this.name=null,this.material=null}SetName(e){return this.name=e,this}SetMaterial(e){return this.material=e,this}},ht=class{constructor(e){this.params=e||new Nt,this.mesh=new j,this.params.name!==null&&this.mesh.SetName(this.params.name),this.curve=null}GetMesh(){return this.mesh}AddVertex(e,t,r){let i=new M(e,t,r);return this.mesh.AddVertex(i)}AddVertices(e){let t=[];for(let r=0;r<e.length;r++){let i=e[r];t.push(this.AddVertex(i.x,i.y,i.z))}return t}SetCurve(e){this.curve=e}ResetCurve(){this.curve=null}AddTriangle(e,t,r){let i=new z(e,t,r);return this.params.material!==null&&(i.mat=this.params.material),this.curve!==null&&i.SetCurve(this.curve),this.mesh.AddTriangle(i)}AddTriangleInverted(e,t,r){this.AddTriangle(e,r,t)}AddConvexPolygon(e){for(let t=0;t<e.length-2;t++)this.AddTriangle(e[0],e[t+1],e[t+2])}AddConvexPolygonInverted(e){for(let t=0;t<e.length-2;t++)this.AddTriangleInverted(e[0],e[t+1],e[t+2])}},sr=class{constructor(e){this.generator=e}GenerateSurfaceBetweenPolygons(e,t){if(e.length!==t.length)return;let r=e.length;for(let i=0;i<r;i++){let n=i,s=i<r-1?n+1:0;this.generator.AddConvexPolygon([e[n],e[s],t[s],t[n]])}}GenerateTriangleFan(e,t){let r=e.length;for(let i=0;i<r;i++){let n=i,s=i<r-1?n+1:0;this.generator.AddTriangle(t,e[n],e[s])}}};function gn(o,e){return new F(o*Math.cos(e),o*Math.sin(e))}function ii(o,e,t,r){if(!ye(e)||!ye(t)||!ye(r))return null;let i=new ht(o);return i.AddVertex(0,0,0),i.AddVertex(e,0,0),i.AddVertex(e,t,0),i.AddVertex(0,t,0),i.AddVertex(0,0,r),i.AddVertex(e,0,r),i.AddVertex(e,t,r),i.AddVertex(0,t,r),i.AddConvexPolygon([0,3,2,1]),i.AddConvexPolygon([0,1,5,4]),i.AddConvexPolygon([1,2,6,5]),i.AddConvexPolygon([2,3,7,6]),i.AddConvexPolygon([3,0,4,7]),i.AddConvexPolygon([4,5,6,7]),i.GetMesh()}function or(o,e,t,r,i,n){if(_e(e)||_e(t)||!ye(r)||i<3)return null;let s=nt(e),l=nt(t);if(s&&l)return null;let a=new ht(o),u=new sr(a),h=2*Math.PI/i,f=n?1:null,d=[];if(s)d.push(a.AddVertex(0,0,r));else for(let p=0;p<i;p++){let m=gn(e,p*h);d.push(a.AddVertex(m.x,m.y,r))}let c=[];if(l)c.push(a.AddVertex(0,0,0));else for(let p=0;p<i;p++){let m=gn(t,p*h);c.push(a.AddVertex(m.x,m.y,0))}return s?(a.SetCurve(f),u.GenerateTriangleFan(c,d[0]),a.ResetCurve(),a.AddConvexPolygonInverted(c)):l?(a.SetCurve(f),u.GenerateTriangleFan(d.slice().reverse(),c[0]),a.ResetCurve(),a.AddConvexPolygon(d)):(a.SetCurve(f),u.GenerateSurfaceBetweenPolygons(c,d),a.ResetCurve(),a.AddConvexPolygonInverted(c),a.AddConvexPolygon(d)),a.GetMesh()}function ni(o,e,t,r,i){return or(o,e,e,t,r,i)}function si(o,e,t,r){function i(c,p,m){return new M(c*Math.sin(p)*Math.cos(m),c*Math.sin(p)*Math.sin(m),c*Math.cos(p))}if(!ye(e)||t<3)return null;let n=new ht(o),s=new sr(n);n.SetCurve(r?1:null);let l=[],a=t+1,u=Math.PI/t,h=2*Math.PI/t;for(let c=1;c<a-1;c++){let p=[],m=c*u;for(let g=0;g<t;g++){let x=g*h,C=i(e,m,-x);p.push(n.AddVertex(C.x,C.y,C.z))}c>1&&s.GenerateSurfaceBetweenPolygons(l[l.length-1],p),l.push(p)}let f=n.AddVertex(0,0,e),d=n.AddVertex(0,0,-e);return s.GenerateTriangleFan(l[0].slice().reverse(),f),s.GenerateTriangleFan(l[l.length-1],d),n.ResetCurve(),n.GetMesh()}function oi(o,e,t){function r(n,s,l,a,u){let h=new M(l,a,u);h.MultiplyScalar(s/h.Length()),n.AddVertex(h.x,h.y,h.z)}if(!ye(t))return null;let i=new ht(o);if(e==="tetrahedron"){let n=1;r(i,t,+n,+n,+n),r(i,t,-n,-n,+n),r(i,t,-n,+n,-n),r(i,t,+n,-n,-n),i.AddTriangle(0,1,3),i.AddTriangle(0,2,1),i.AddTriangle(0,3,2),i.AddTriangle(1,2,3)}else if(e==="hexahedron"){let n=1;r(i,t,+n,+n,+n),r(i,t,+n,+n,-n),r(i,t,+n,-n,+n),r(i,t,+n,-n,-n),r(i,t,-n,+n,+n),r(i,t,-n,+n,-n),r(i,t,-n,-n,+n),r(i,t,-n,-n,-n),i.AddConvexPolygon([0,1,5,4]),i.AddConvexPolygon([0,2,3,1]),i.AddConvexPolygon([0,4,6,2]),i.AddConvexPolygon([1,3,7,5]),i.AddConvexPolygon([2,6,7,3]),i.AddConvexPolygon([4,5,7,6])}else if(e==="octahedron"){let n=1,s=0;r(i,t,+n,+s,+s),r(i,t,-n,+s,+s),r(i,t,+s,+n,+s),r(i,t,+s,-n,+s),r(i,t,+s,+s,+n),r(i,t,+s,+s,-n),i.AddTriangle(0,2,4),i.AddTriangle(0,3,5),i.AddTriangle(0,4,3),i.AddTriangle(0,5,2),i.AddTriangle(1,2,5),i.AddTriangle(1,3,4),i.AddTriangle(1,4,2),i.AddTriangle(1,5,3)}else if(e==="dodecahedron"){let n=1,s=0,l=(1+Math.sqrt(5))/2,a=1/l;r(i,t,+n,+n,+n),r(i,t,+n,+n,-n),r(i,t,+n,-n,+n),r(i,t,-n,+n,+n),r(i,t,+n,-n,-n),r(i,t,-n,+n,-n),r(i,t,-n,-n,+n),r(i,t,-n,-n,-n),r(i,t,+s,+a,+l),r(i,t,+s,+a,-l),r(i,t,+s,-a,+l),r(i,t,+s,-a,-l),r(i,t,+a,+l,+s),r(i,t,+a,-l,+s),r(i,t,-a,+l,+s),r(i,t,-a,-l,+s),r(i,t,+l,+s,+a),r(i,t,-l,+s,+a),r(i,t,+l,+s,-a),r(i,t,-l,+s,-a),i.AddConvexPolygon([0,8,10,2,16]),i.AddConvexPolygon([0,16,18,1,12]),i.AddConvexPolygon([0,12,14,3,8]),i.AddConvexPolygon([1,9,5,14,12]),i.AddConvexPolygon([1,18,4,11,9]),i.AddConvexPolygon([2,10,6,15,13]),i.AddConvexPolygon([2,13,4,18,16]),i.AddConvexPolygon([3,14,5,19,17]),i.AddConvexPolygon([3,17,6,10,8]),i.AddConvexPolygon([4,13,15,7,11]),i.AddConvexPolygon([5,9,11,7,19]),i.AddConvexPolygon([6,17,19,7,15])}else if(e==="icosahedron"){let n=1,s=0,l=(1+Math.sqrt(5))/2;r(i,t,+s,+n,+l),r(i,t,+s,+n,-l),r(i,t,+s,-n,+l),r(i,t,+s,-n,-l),r(i,t,+n,+l,+s),r(i,t,+n,-l,+s),r(i,t,-n,+l,+s),r(i,t,-n,-l,+s),r(i,t,+l,+s,+n),r(i,t,+l,+s,-n),r(i,t,-l,+s,+n),r(i,t,-l,+s,-n),i.AddTriangle(0,2,8),i.AddTriangle(0,4,6),i.AddTriangle(0,6,10),i.AddTriangle(0,8,4),i.AddTriangle(0,10,2),i.AddTriangle(1,3,11),i.AddTriangle(1,4,9),i.AddTriangle(1,6,4),i.AddTriangle(1,9,3),i.AddTriangle(1,11,6),i.AddTriangle(2,5,8),i.AddTriangle(2,7,5),i.AddTriangle(2,10,7),i.AddTriangle(3,5,7),i.AddTriangle(3,7,11),i.AddTriangle(3,9,5),i.AddTriangle(4,8,9),i.AddTriangle(5,9,8),i.AddTriangle(6,11,10),i.AddTriangle(7,10,11)}return i.GetMesh()}var lr=class extends H{constructor(){super()}CanImportExtension(e){return e==="o3dv"}GetUpDirection(){return v.Z}ClearContent(){}ResetContent(){}ImportContent(e,t){let r=K(e),i=JSON.parse(r);if(i.root===void 0){t();return}if(i.materials!==void 0)for(let s=0;s<i.materials.length;s++){let l=i.materials[s];this.ImportMaterial(l)}if(i.meshes!==void 0)for(let s=0;s<i.meshes.length;s++){let l=i.meshes[s];this.ImportMesh(l)}let n=i.nodes[i.root];this.ImportNode(i,n,this.model.GetRootNode()),this.ImportProperties(this.model,i),t()}ImportMaterial(e){let t=new je;t.color.Set(255,255,255),e.name!==void 0&&(t.name=e.name),e.color!==void 0&&(t.color=Br(e.color)),t.metalness=Ee(e.metalness,0),t.roughness=Ee(e.roughness,1),this.model.AddMaterial(t)}ImportMesh(e){let t=new Nt;e.name!==void 0&&t.SetName(e.name),e.material!==void 0&&t.SetMaterial(e.material);let r=e.parameters;if(r===void 0)return;let i=null;if(e.type==="cuboid"){if(r.size_x===void 0||r.size_y===void 0||r.size_z===void 0)return;i=ii(t,r.size_x,r.size_y,r.size_z)}else if(e.type==="cylinder"){if(r.radius===void 0||r.height===void 0)return;let n=Ee(r.segments,25),s=Ee(r.smooth,!0);i=ni(t,r.radius,r.height,n,s)}else if(e.type==="cone"){if(r.top_radius===void 0||r.bottom_radius===void 0||r.height===void 0)return;let n=Ee(r.segments,25),s=Ee(r.smooth,!0);i=or(t,r.top_radius,r.bottom_radius,r.height,n,s)}else if(e.type==="sphere"){if(r.radius===void 0)return;let n=Ee(r.segments,20),s=Ee(r.smooth,!0);i=si(t,r.radius,n,s)}else if(e.type==="platonic"){if(r.solid_type===void 0)return;let n=Ee(r.radius,1);i=oi(t,r.solid_type,n)}i!==null&&(this.ImportProperties(i,e),this.model.AddMesh(i))}ImportNode(e,t,r){if(t.name!==void 0&&r.SetName(t.name),t.transformation!==void 0){let i=this.GetTransformation(t.transformation);r.SetTransformation(i)}if(t.children!==void 0)for(let i of t.children){let n=e.nodes[i],s=new Ce;r.AddChildNode(s),this.ImportNode(e,n,s)}t.mesh!==void 0&&((t.children===void 0||t.children.length===0)&&r.SetType(Ge.MeshNode),r.AddMeshIndex(t.mesh))}ImportProperties(e,t){if(t.properties!==void 0){let r=new Ie("Properties");e.AddPropertyGroup(r);for(let i of t.properties){let n=new ne(he.Text,i.name,i.value);r.AddProperty(n)}}}GetTransformation(e){let t=new M(0,0,0),r=new ge(0,0,0,1),i=new M(1,1,1);e.translation!==void 0&&(t=Ae(e.translation)),e.rotation!==void 0&&(r=$e(e.rotation)),e.scale!==void 0&&(i=Ae(e.scale));let n=new L().ComposeTRS(t,r,i);return new k(n)}};var xn=class{constructor(e){this.mesh=e,this.globalToMeshVertices=new Map,this.globalToMeshVertexColors=new Map,this.globalToMeshNormals=new Map,this.globalToMeshUvs=new Map}AddVertex(e,t){return this.GetLocalIndex(e,t,this.globalToMeshVertices,r=>this.mesh.AddVertex(new M(r.x,r.y,r.z)))}AddVertexColor(e,t){return this.GetLocalIndex(e,t,this.globalToMeshVertexColors,r=>this.mesh.AddVertexColor(new N(r.r,r.g,r.b)))}AddNormal(e,t){return this.GetLocalIndex(e,t,this.globalToMeshNormals,r=>this.mesh.AddNormal(new M(r.x,r.y,r.z)))}AddUV(e,t){return this.GetLocalIndex(e,t,this.globalToMeshUvs,r=>this.mesh.AddTextureUV(new F(r.x,r.y)))}AddTriangle(e){this.mesh.AddTriangle(e)}GetLocalIndex(e,t,r,i){if(isNaN(e)||e<0||e>=t.length)return null;if(r.has(e))return r.get(e);{let n=t[e],s=i(n);return r.set(e,s),s}}};function li(o,e,t){return Pe(parseFloat(o),parseFloat(e),parseFloat(t))}var ar=class extends H{constructor(){super()}CanImportExtension(e){return e==="obj"}GetUpDirection(){return v.Y}ClearContent(){this.globalVertices=null,this.globalVertexColors=null,this.globalNormals=null,this.globalUvs=null,this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=null,this.materialNameToIndex=null}ResetContent(){this.globalVertices=[],this.globalVertexColors=[],this.globalNormals=[],this.globalUvs=[],this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=new Map,this.materialNameToIndex=new Map}ImportContent(e,t){let r=K(e);be(r,i=>{this.WasError()||this.ProcessLine(i)}),t()}ProcessLine(e){if(e[0]==="#")return;let t=Re(e,"#");if(t.length===0)return;let r=t[0].toLowerCase();t.shift(),!this.ProcessMeshParameter(r,t,e)&&!this.ProcessMaterialParameter(r,t,e)}AddNewMesh(e){if(this.meshNameToConverter.has(e))this.currentMeshConverter=this.meshNameToConverter.get(e);else{let t=new j;t.SetName(e),this.model.AddMeshToRootNode(t),this.currentMeshConverter=new xn(t),this.meshNameToConverter.set(e,this.currentMeshConverter)}}ProcessMeshParameter(e,t,r){if(e==="g"||e==="o"){if(t.length===0)return!0;let i=ze(r,e.length,"#");return this.AddNewMesh(i),!0}else{if(e==="v")return t.length<3||(this.globalVertices.push(new M(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),t.length>=6&&this.globalVertexColors.push(li(t[3],t[4],t[5]))),!0;if(e==="vn")return t.length<3||this.globalNormals.push(new M(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),!0;if(e==="vt")return t.length<2||this.globalUvs.push(new F(parseFloat(t[0]),parseFloat(t[1]))),!0;if(e==="f")return t.length<3||this.ProcessFace(t),!0}return!1}ProcessMaterialParameter(e,t,r){function i(n,s,l){let a=new Se,u=ze(s,n.length,"#"),h=l.getTextureBuffer(u);return a.name=u,h!==null&&(a.url=h.url,a.buffer=h.buffer),a}if(e==="newmtl"){if(t.length===0)return!0;let n=new q,s=ze(r,e.length,"#"),l=this.model.AddMaterial(n);return n.name=s,this.currentMaterial=n,this.materialNameToIndex.set(s,l),!0}else if(e==="usemtl"){if(t.length===0)return!0;let n=ze(r,e.length,"#");return this.materialNameToIndex.has(n)&&(this.currentMaterialIndex=this.materialNameToIndex.get(n)),!0}else if(e==="mtllib"){if(t.length===0)return!0;let n=ze(r,e.length,"#"),s=this.callbacks.getFileBuffer(n);if(s!==null){let l=K(s);be(l,a=>{this.WasError()||this.ProcessLine(a)})}return!0}else{if(e==="map_kd")return this.currentMaterial===null||t.length===0||(this.currentMaterial.diffuseMap=i(e,r,this.callbacks),oe(this.currentMaterial)),!0;if(e==="map_ks")return this.currentMaterial===null||t.length===0||(this.currentMaterial.specularMap=i(e,r,this.callbacks)),!0;if(e==="map_bump"||e==="bump")return this.currentMaterial===null||t.length===0||(this.currentMaterial.bumpMap=i(e,r,this.callbacks)),!0;if(e==="ka")return this.currentMaterial===null||t.length<3||(this.currentMaterial.ambient=li(t[0],t[1],t[2])),!0;if(e==="kd")return this.currentMaterial===null||t.length<3||(this.currentMaterial.color=li(t[0],t[1],t[2])),!0;if(e==="ks")return this.currentMaterial===null||t.length<3||(this.currentMaterial.specular=li(t[0],t[1],t[2])),!0;if(e==="ns")return this.currentMaterial===null||t.length<1||(this.currentMaterial.shininess=parseFloat(t[0])/1e3),!0;if(e==="tr")return this.currentMaterial===null||t.length<1||(this.currentMaterial.opacity=1-parseFloat(t[0]),oe(this.currentMaterial)),!0;if(e==="d")return this.currentMaterial===null||t.length<1||(this.currentMaterial.opacity=parseFloat(t[0]),oe(this.currentMaterial)),!0}return!1}ProcessFace(e){function t(l,a){return l>0?l-1:a+l}let r=[],i=[],n=[],s=[];for(let l=0;l<e.length;l++){let a=e[l].split("/");r.push(t(parseInt(a[0],10),this.globalVertices.length)),this.globalVertices.length===this.globalVertexColors.length&&i.push(t(parseInt(a[0],10),this.globalVertices.length)),a.length>1&&a[1].length>0&&s.push(t(parseInt(a[1],10),this.globalUvs.length)),a.length>2&&a[2].length>0&&n.push(t(parseInt(a[2],10),this.globalNormals.length))}this.currentMeshConverter===null&&this.AddNewMesh("");for(let l=0;l<r.length-2;l++){let a=this.currentMeshConverter.AddVertex(r[0],this.globalVertices),u=this.currentMeshConverter.AddVertex(r[l+1],this.globalVertices),h=this.currentMeshConverter.AddVertex(r[l+2],this.globalVertices);if(a===null||u===null||h===null){this.SetError("Invalid vertex index.");break}let f=new z(a,u,h);if(i.length===r.length){let d=this.currentMeshConverter.AddVertexColor(i[0],this.globalVertexColors),c=this.currentMeshConverter.AddVertexColor(i[l+1],this.globalVertexColors),p=this.currentMeshConverter.AddVertexColor(i[l+2],this.globalVertexColors);if(d===null||c===null||p===null){this.SetError("Invalid vertex color index.");break}f.SetVertexColors(d,c,p)}if(n.length===r.length){let d=this.currentMeshConverter.AddNormal(n[0],this.globalNormals),c=this.currentMeshConverter.AddNormal(n[l+1],this.globalNormals),p=this.currentMeshConverter.AddNormal(n[l+2],this.globalNormals);if(d===null||c===null||p===null){this.SetError("Invalid normal index.");break}f.SetNormals(d,c,p)}if(s.length===r.length){let d=this.currentMeshConverter.AddUV(s[0],this.globalUvs),c=this.currentMeshConverter.AddUV(s[l+1],this.globalUvs),p=this.currentMeshConverter.AddUV(s[l+2],this.globalUvs);if(d===null||c===null||p===null){this.SetError("Invalid uv index.");break}f.SetTextureUVs(d,c,p)}this.currentMaterialIndex!==null&&(f.mat=this.currentMaterialIndex),this.currentMeshConverter.AddTriangle(f)}}};var ur=class extends H{constructor(){super()}CanImportExtension(e){return e==="off"}GetUpDirection(){return v.Y}ClearContent(){this.mesh=null,this.status=null}ResetContent(){this.mesh=new j,this.model.AddMeshToRootNode(this.mesh),this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0}}ImportContent(e,t){let r=K(e);be(r,i=>{this.WasError()||this.ProcessLine(i)}),t()}ProcessLine(e){if(e[0]==="#")return;let t=Re(e,"#");if(t.length!==0&&t[0]!=="OFF"){if(this.status.vertexCount===0&&this.status.faceCount===0){t.length>1&&(this.status.vertexCount=parseInt(t[0],10),this.status.faceCount=parseInt(t[1],10));return}if(this.status.foundVertex<this.status.vertexCount){t.length>=3&&(this.mesh.AddVertex(new M(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),this.status.foundVertex+=1);return}if(this.status.foundFace<this.status.faceCount){if(t.length>=4){let r=parseInt(t[0],10);if(t.length<r+1)return;for(let i=0;i<r-2;i++){let n=parseInt(t[1]),s=parseInt(t[i+2]),l=parseInt(t[i+3]),a=new z(n,s,l);this.mesh.AddTriangle(a)}this.status.foundFace+=1}return}}}};var rt={Ok:1,NoVertices:2,NoFaces:3,UnknownError:4},Cn=class{constructor(){this.format=null,this.elements=[]}SetFormat(e){this.format=e}AddElement(e,t){this.elements.push({name:e,count:t,format:[]})}GetElements(){return this.elements}AddSingleFormat(e,t){this.elements[this.elements.length-1].format.push({name:t,isSingle:!0,elemType:e})}AddListFormat(e,t,r){this.elements[this.elements.length-1].format.push({name:r,isSingle:!1,countType:e,elemType:t})}GetElement(e){for(let t=0;t<this.elements.length;t++){let r=this.elements[t];if(r.name===e)return r}return null}Check(){let e=this.GetElement("vertex");if(e===null||e.length===0||e.format.length<3)return rt.NoVertices;let t=this.GetElement("face");if(this.format==="ascii"){if(t===null||t.count===0||t.format.length<0)return rt.NoFaces}else if(this.format==="binary_little_endian"||this.format==="binary_big_endian"){let r=this.GetElement("tristrips"),i=t!==null&&t.count>0&&t.format.length>0,n=r!==null&&r.count>0&&r.format.length>0;if(!i&&!n)return rt.NoFaces}else return rt.UnknownError;return rt.Ok}},Tn=class{constructor(e){this.model=e,this.colorToMaterial=new Map}GetMaterialIndexByColor(e){let t="Color "+re(e[0])+re(e[1])+re(e[2])+re(e[3]);if(this.colorToMaterial.has(t))return this.colorToMaterial.get(t);{let r=new q;r.name=t,r.color=new N(e[0],e[1],e[2]),r.opacity=e[3]/255,oe(r);let i=this.model.AddMaterial(r);return this.colorToMaterial.set(t,i),i}}},hr=class extends H{constructor(){super()}CanImportExtension(e){return e==="ply"}GetUpDirection(){return v.Y}ClearContent(){this.mesh=null}ResetContent(){this.mesh=new j,this.model.AddMeshToRootNode(this.mesh)}ImportContent(e,t){let r=this.GetHeaderContent(e),i=this.ReadHeader(r),n=i.Check();if(n===rt.Ok)if(i.format==="ascii"){let s=K(e);s=s.substring(r.length),this.ReadAsciiContent(i,s)}else(i.format==="binary_little_endian"||i.format==="binary_big_endian")&&this.ReadBinaryContent(i,e,r.length);else n===rt.NoVertices?this.SetError("The model contains no vertices."):n===rt.NoFaces?this.SetError("The model contains no faces."):this.SetError("Invalid header information.");t()}GetHeaderContent(e){let t="",r=new Uint8Array(e),i=0;for(i=0;i<e.byteLength&&(t+=String.fromCharCode(r[i]),!t.endsWith("end_header"));i++);for(i+=1;i<e.byteLength;){let n=String.fromCharCode(r[i]);if(t+=n,i+=1,n===`
`)break}return t}ReadHeader(e){let t=new Cn;return be(e,r=>{let i=Re(r,null);i.length===0||i[0]==="comment"||i[0]!=="ply"&&(i[0]==="format"&&i.length>=2?t.SetFormat(i[1]):i[0]==="element"&&i.length>=3?t.AddElement(i[1],parseInt(i[2],10)):i[0]==="property"&&i.length>=3&&(i[1]==="list"&&i.length>=5?t.AddListFormat(i[2],i[3],i[4]):t.AddSingleFormat(i[1],i[2])))}),t}ReadAsciiContent(e,t){let r=e.GetElement("vertex"),i=e.GetElement("face"),n=0,s=0;be(t,l=>{if(this.WasError())return;let a=Re(l,null);if(!(a.length===0||a[0]==="comment")){if(n<r.count){a.length>=3&&(this.mesh.AddVertex(new M(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),n+=1);return}if(i!==null&&s<i.count){if(a.length>=4){let u=parseInt(a[0],10);if(a.length<u+1)return;for(let h=0;h<u-2;h++){let f=parseInt(a[1]),d=parseInt(a[h+2]),c=parseInt(a[h+3]),p=new z(f,d,c);this.mesh.AddTriangle(p)}s+=1}return}}})}ReadBinaryContent(e,t,r){function i(h,f){function d(c,p){return p==="char"||p==="int8"?c.ReadCharacter8():p==="uchar"||p==="uint8"?c.ReadUnsignedCharacter8():p==="short"||p==="int16"?c.ReadInteger16():p==="ushort"||p==="uint16"?c.ReadUnsignedInteger16():p==="int"||p==="int32"?c.ReadInteger32():p==="uint"||p==="uint32"?c.ReadUnsignedInteger32():p==="float"||p==="float32"?c.ReadFloat32():p==="double"||p==="double64"?c.ReadDouble64():null}if(f.isSingle)return d(h,f.elemType);{let c=[],p=d(h,f.countType);for(let m=0;m<p;m++)c.push(d(h,f.elemType));return c}}function n(h,f,d){for(let c=d;c<f.length;c++)i(h,f[c])}function s(h,f,d){let c=null,p=null,m=null,g=255;for(let x=d;x<f.length;x++){let C=f[x],E=i(h,C);C.name==="red"?c=E:C.name==="green"?p=E:C.name==="blue"?m=E:C.name==="alpha"&&(g=E)}return c!==null&&p!==null&&m!==null?[c,p,m,g]:null}let l=null;if(e.format==="binary_little_endian")l=new de(t,!0);else if(e.format==="binary_big_endian")l=new de(t,!1);else return;l.Skip(r);let a=new Tn(this.model),u=e.GetElements();for(let h=0;h<u.length;h++){let f=u[h];if(f.name==="vertex")for(let d=0;d<f.count;d++){let c=i(l,f.format[0]),p=i(l,f.format[1]),m=i(l,f.format[2]),g=s(l,f.format,3);g!==null&&this.mesh.AddVertexColor(new N(g[0],g[1],g[2])),this.mesh.AddVertex(new M(c,p,m))}else if(f.name==="face")for(let d=0;d<f.count;d++){let c=i(l,f.format[0]),p=s(l,f.format,1);for(let m=0;m<c.length-2;m++){let g=c[0],x=c[m+1],C=c[m+2],E=new z(g,x,C);p!==null?E.mat=a.GetMaterialIndexByColor(p):this.mesh.VertexColorCount()>0&&E.SetVertexColors(g,x,C),this.mesh.AddTriangle(E)}}else if(f.name==="tristrips")for(let d=0;d<f.count;d++){let c=i(l,f.format[0]);n(l,f.format,1);let p=!0;for(let m=0;m<c.length-2;m++){let g=c[m],x=c[m+1],C=c[m+2];if(C===-1){m+=2,p=!0;continue}if(!p){let T=x;x=C,C=T}p=!p;let E=new z(g,x,C);this.mesh.AddTriangle(E)}}else n(l,f.format,0)}}};var fr=class extends H{constructor(){super();this.worker=null}CanImportExtension(e){return e==="stp"||e==="step"}GetUpDirection(){return v.Y}ClearContent(){}ResetContent(){}ImportContent(e,t){if(this.worker===null){let n=Pt("loaders/occt-import-js-worker.js");this.worker=new Worker(n)}let r=n=>{console.log("converted"),this.ImportStepContent(n.data,t),this.worker.removeEventListener("message",r)};this.worker.addEventListener("message",r);let i=new Uint8Array(e);this.worker.postMessage(i)}ImportStepContent(e,t){if(!!e.success){console.log(e);for(let r of e.meshes){let i=qe(r,null);this.model.AddMeshToRootNode(i)}t()}}};var dr=class extends H{constructor(){super()}CanImportExtension(e){return e==="stl"}GetUpDirection(){return v.Z}ClearContent(){this.mesh=null,this.triangle=null}ResetContent(){this.mesh=new j,this.model.AddMeshToRootNode(this.mesh),this.triangle=null}ImportContent(e,t){if(this.IsBinaryStlFile(e))this.ProcessBinary(e);else{let r=K(e);be(r,i=>{this.WasError()||this.ProcessLine(i)})}t()}IsBinaryStlFile(e){let t=e.byteLength;if(t<84)return!1;let r=new de(e,!0);r.Skip(80);let i=r.ReadUnsignedInteger32();return t===i*50+84}ProcessLine(e){if(e[0]==="#")return;let t=Re(e,"#");if(t.length===0)return;let r=t[0];if(r==="solid"){if(t.length>1){let i=ze(e,r.length,"#");this.mesh.SetName(i)}return}if(r==="facet"){if(this.triangle=new z(-1,-1,-1),t.length>=5&&t[1]==="normal"){let i=new M(parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]));if(ye(i.Length())){let n=this.mesh.AddNormal(i);this.triangle.SetNormals(n,n,n)}}return}if(r==="vertex"&&this.triangle!==null){if(t.length>=4){let i=this.mesh.AddVertex(new M(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])));this.triangle.v0===-1?this.triangle.v0=i:this.triangle.v1===-1?this.triangle.v1=i:this.triangle.v2===-1&&(this.triangle.v2=i)}return}if(r==="endfacet"&&this.triangle!==null){this.triangle.v0!==-1&&this.triangle.v1!==-1&&this.triangle.v2!==null&&this.mesh.AddTriangle(this.triangle),this.triangle=null;return}}ProcessBinary(e){function t(s){let l=new M;return l.x=s.ReadFloat32(),l.y=s.ReadFloat32(),l.z=s.ReadFloat32(),l}function r(s,l){let a=t(l);return s.AddVertex(a)}let i=new de(e,!0);i.Skip(80);let n=i.ReadUnsignedInteger32();for(let s=0;s<n;s++){let l=t(i),a=r(this.mesh,i),u=r(this.mesh,i),h=r(this.mesh,i);i.Skip(2);let f=new z(a,u,h);if(ye(l.Length())){let d=this.mesh.AddNormal(l);f.SetNormals(d,d,d)}this.mesh.AddTriangle(f)}}};var Xe=class extends H{constructor(){super()}GetExternalLibraries(){return null}CreateLoader(e){return null}GetMainObject(e){return e}IsMeshVisible(e){return!0}ClearContent(){this.loader=null,this.materialIdToIndex=null,this.objectUrlToFileName=null}ResetContent(){this.loader=null,this.materialIdToIndex=new Map,this.objectUrlToFileName=new Map}ImportContent(e,t){async function r(n,s,l){try{for(let a=0;a<n.length;a++)await ae(n[a])}catch{l()}s()}let i=this.GetExternalLibraries();if(i===null){t();return}r(i,()=>{this.LoadModel(e,t)},()=>{t()})}LoadModel(e,t){let r=!1,i=new THREE.LoadingManager(()=>{r=!0}),n=lt(e);i.setURLModifier(l=>{if(l===n)return l;let a=J(l);if(Ve(l).length>0){let h=this.callbacks.getFileBuffer(l);if(h!==null){let f=lt(h);return this.objectUrlToFileName.set(f,a),f}}return l});let s=this.CreateLoader(i);if(s===null){t();return}s.load(n,l=>{Rr(()=>r?(this.OnThreeObjectsLoaded(l,t),!1):!0)},()=>{},l=>{this.SetError(l),t()})}OnThreeObjectsLoaded(e,t){function r(l){let a=new L().CreateIdentity();return l.updateMatrix(),l.matrix!==void 0&&l.matrix!==null&&a.Set(l.matrix.elements),new k(a)}function i(l,a,u,h){let f=new Ce;u.name!==void 0&&f.SetName(u.name),f.SetTransformation(r(u)),h.AddChildNode(f);for(let d of u.children)i(l,a,d,f);if(u.isMesh&&l.IsMeshVisible(u)){u.children.length===0&&f.SetType(Ge.MeshNode);let d=l.ConvertThreeMesh(u),c=a.AddMesh(d);f.AddMeshIndex(c)}}let n=this.GetMainObject(e),s=this.model.GetRootNode();s.SetTransformation(r(n));for(let l of n.children)i(this,this.model,l,s);t()}ConvertThreeMesh(e){let t=null;if(Array.isArray(e.material)){if(t=qe(e.geometry,null),e.geometry.attributes.color===void 0||e.geometry.attributes.color===null){let r=[];for(let i=0;i<e.material.length;i++){let n=e.material[i],s=this.FindOrCreateMaterial(n);r.push(s)}for(let i=0;i<e.geometry.groups.length;i++){let n=e.geometry.groups[i],s=null;n.count===1/0?s=t.TriangleCount():s=n.start/3+n.count/3;for(let l=n.start/3;l<s;l++)t.GetTriangle(l).SetMaterial(r[n.materialIndex])}}}else{let r=this.FindOrCreateMaterial(e.material);t=qe(e.geometry,r)}return e.name!==void 0&&e.name!==null&&t.SetName(e.name),t}FindOrCreateMaterial(e){if(this.materialIdToIndex.has(e.id))return this.materialIdToIndex.get(e.id);let t=this.ConvertThreeMaterial(e),r=this.model.AddMaterial(t);return this.materialIdToIndex.set(e.id,r),r}ConvertThreeMaterial(e){function t(i,n){function s(l){if(l.data!==void 0&&l.data!==null){let a=new ImageData(l.width,l.height),u=l.width*l.height*4;for(let h=0;h<u;h++)a.data[h]=l.data[h];return THREE.ImageUtils.getDataURL(a)}else return THREE.ImageUtils.getDataURL(l)}if(i==null||i.image===void 0||i.image===null)return null;try{let l=s(i.image),a=ot(l),u=new Se,h=null;return n.has(i.image.src)?h=n.get(i.image.src):i.name!==void 0&&i.name!==null?h=i.name+"."+Qe(a.mimeType):h="Embedded_"+i.id.toString()+"."+Qe(a.mimeType),u.name=h,u.url=l,u.buffer=a.buffer,u.rotation=i.rotation,u.offset.x=i.offset.x,u.offset.y=i.offset.y,u.scale.x=i.repeat.x,u.scale.y=i.repeat.y,u}catch{return null}}let r=new q;return r.name=e.name,r.color=Rt(e.color),r.opacity=e.opacity,r.transparent=e.transparent,r.alphaTest=e.alphaTest,e.type==="MeshPhongMaterial"&&(r.specular=Rt(e.specular),r.shininess=e.shininess/100),r.diffuseMap=t(e.map,this.objectUrlToFileName),r.normalMap=t(e.normalMap,this.objectUrlToFileName),r.bumpMap=t(e.bumpMap,this.objectUrlToFileName),r}},mr=class extends Xe{constructor(){super()}CanImportExtension(e){return e==="fbx"}GetUpDirection(){return v.Y}GetExternalLibraries(){return["loaders/fflate.min.js","three_loaders/TGALoader.js","three_loaders/FBXLoader.js"]}CreateLoader(e){return e.addHandler(/\.tga$/i,new THREE.TGALoader(e)),new THREE.FBXLoader(e)}GetMainObject(e){return e}},cr=class extends Xe{constructor(){super()}CanImportExtension(e){return e==="dae"}GetUpDirection(){return v.Y}GetExternalLibraries(){return["three_loaders/TGALoader.js","three_loaders/ColladaLoader.js"]}CreateLoader(e){return e.addHandler(/\.tga$/i,new THREE.TGALoader(e)),new THREE.ColladaLoader(e)}GetMainObject(e){return e.scene}},pr=class extends Xe{constructor(){super()}CanImportExtension(e){return e==="wrl"}GetUpDirection(){return v.Y}GetExternalLibraries(){return["three_loaders/chevrotain.min.js","three_loaders/VRMLLoader.js"]}CreateLoader(e){return new THREE.VRMLLoader(e)}GetMainObject(e){return e}IsMeshVisible(e){let t=!0;if(Array.isArray(e.material)){for(let r=0;r<e.material.length;r++)if(e.material[r].side===THREE.BackSide){t=!1;break}}else t=e.material.side!==THREE.BackSide;return t}},gr=class extends Xe{constructor(){super()}CanImportExtension(e){return e==="3mf"}GetUpDirection(){return v.Z}GetExternalLibraries(){return["loaders/fflate.min.js","three_loaders/3MFLoader.js"]}CreateLoader(e){return new THREE.ThreeMFLoader(e)}GetMainObject(e){return e}};var xr=class{constructor(){this.defaultColor=new N(200,200,200)}},He={NoImportableFile:1,FailedToLoadFile:2,ImportFailed:3,UnknownError:4},ft=class{constructor(e){this.code=e,this.mainFile=null,this.message=null}},ai=class{constructor(){this.model=null,this.mainFile=null,this.upVector=null,this.usedFiles=null,this.missingFiles=null}},ui=class{constructor(e){this.getBufferCallback=e,this.fileBuffers=new Map,this.textureBuffers=new Map}GetFileBuffer(e){let t=J(e);if(this.fileBuffers.has(t))return this.fileBuffers.get(t);let r=this.getBufferCallback(t);return this.fileBuffers.set(t,r),r}GetTextureBuffer(e){let t=J(e);if(this.textureBuffers.has(t))return this.textureBuffers.get(t);let r=null,i=this.getBufferCallback(t);return i!==null&&(r={url:lt(i),buffer:i}),this.textureBuffers.set(t,r),r}},Cr=class{constructor(){this.importers=[new ar,new dr,new ur,new hr,new tr,new ir,new lr,new er,new nr,new fr,new mr,new cr,new pr,new gr],this.fileList=new At,this.model=null,this.usedFiles=[],this.missingFiles=[]}AddImporter(e){this.importers.push(e)}ImportFiles(e,t,r,i){this.LoadFiles(e,t,()=>{i.onFilesLoaded(),Vt(()=>{this.ImportLoadedFiles(r,i)})})}LoadFiles(e,t,r){let i=new At;t===Y.Url?i.FillFromFileUrls(e):t===Y.File&&i.FillFromFileObjects(e);let n=!1;if(this.HasImportableFile(i))n=!0;else{let s=!1;for(let l=0;l<this.missingFiles.length;l++){let a=this.missingFiles[l];i.ContainsFileByPath(a)&&(s=!0)}if(!s)n=!0;else{let l=i.GetFiles();this.fileList.ExtendFromFileList(l),n=!1}}n&&(this.fileList=i),this.fileList.GetContent(()=>{this.DecompressArchives(this.fileList,()=>{r()})})}ImportLoadedFiles(e,t){let r=this.GetImportableFiles(this.fileList);if(r.length===0){t.onImportError(new ft(He.NoImportableFile));return}if(r.length===1||!t.onSelectMainFile){let i=r[0];this.ImportLoadedMainFile(i,e,t)}else{let i=r.map(n=>n.file.name);t.onSelectMainFile(i,n=>{if(n===null){t.onImportError(new ft(He.NoImportableFile));return}Vt(()=>{let s=r[n];this.ImportLoadedMainFile(s,e,t)})})}}ImportLoadedMainFile(e,t,r){if(e===null||e.file===null||e.file.content===null){let s=new ft(He.FailedToLoadFile);e!==null&&e.file!==null&&(s.mainFile=e.file.name),r.onImportError(s);return}this.RevokeModelUrls(),this.model=null,this.usedFiles=[],this.missingFiles=[],this.usedFiles.push(e.file.name);let i=e.importer,n=new ui(s=>{let l=null,a=this.fileList.FindFileByPath(s);return a===null||a.content===null?(this.missingFiles.push(s),l=null):(this.usedFiles.push(s),l=a.content),l});i.Import(e.file.name,e.file.extension,e.file.content,{getDefaultMaterialColor:()=>t.defaultColor,getFileBuffer:s=>n.GetFileBuffer(s),getTextureBuffer:s=>n.GetTextureBuffer(s),onSuccess:()=>{this.model=i.GetModel();let s=new ai;s.mainFile=e.file.name,s.model=this.model,s.usedFiles=this.usedFiles,s.missingFiles=this.missingFiles,s.upVector=i.GetUpDirection(),r.onImportSuccess(s)},onError:()=>{let s=new ft(He.ImportFailed);s.mainFile=e.file.name,s.message=i.GetErrorMessage(),r.onImportError(s)},onComplete:()=>{i.Clear()}})}DecompressArchives(e,t){let r=e.GetFiles(),i=[];for(let n of r)n.extension==="zip"&&i.push(n);if(i.length===0){t();return}ae("loaders/fflate.min.js").then(()=>{for(let n=0;n<i.length;n++){let s=i[n],l=new Uint8Array(s.content),a=fflate.unzipSync(l);for(let u in a)if(Object.prototype.hasOwnProperty.call(a,u)){let h=new vt(u,Y.Decompressed);h.SetContent(a[u].buffer),e.AddFile(h)}}t()}).catch(()=>{t()})}GetFileList(){return this.fileList}HasImportableFile(e){return this.GetImportableFiles(e).length>0}GetImportableFiles(e){function t(n,s){for(let l=0;l<s.length;l++){let a=s[l];if(a.CanImportExtension(n.extension))return a}return null}let r=[],i=e.GetFiles();for(let n=0;n<i.length;n++){let s=i[n],l=t(s,this.importers);l!==null&&r.push({file:s,importer:l})}return r}RevokeModelUrls(){if(this.model!==null)for(let e=0;e<this.model.MaterialCount();e++)this.model.GetMaterial(e).EnumerateTextureMaps(r=>{r.url!==null&&kr(r.url)})}};var Pi=class extends Xe{constructor(){super()}CanImportExtension(e){return e==="svg"}GetUpDirection(){return v.Z}GetExternalLibraries(){return["three_loaders/SVGLoader.js"]}CreateLoader(e){return new THREE.SVGLoader(e)}GetMainObject(e){function t(s){let l=s.userData.style;return!(l.fill===void 0||l.fill==="none")}function r(s,l,a){let u=null;for(let h of s)if(h.style===l&&h.opacity===a){u=h.material;break}return u===null&&(u=new THREE.MeshPhongMaterial({color:new THREE.Color().setStyle(l),opacity:a,transparent:a<1}),s.push({style:l,opacity:a,material:u})),u}let i=[],n=new THREE.Object3D;n.rotation.x=Math.PI;for(let s of e.paths){let l=THREE.SVGLoader.createShapes(s);if(t(s)){let a=s.userData.style,u=r(i,a.fill,a.opacity);for(let h of l){let f=new THREE.ExtrudeGeometry(h,{depth:10,bevelEnabled:!1}),d=new THREE.Mesh(f,u);d.name=s.userData.node.id,n.add(d)}}}return n}};function Oi(o,e,t){let r=pe(o,e),i=pe(e,t),n=pe(o,t),s=(r+i+n)/2,l=s*(s-r)*(s-i)*(s-n);return l<0?0:Math.sqrt(l)}function Bi(o,e,t){return Ht(o,ve(e,t))/6}function En(o){let e=0;return o.EnumerateTriangleVertices((t,r,i)=>{e+=Bi(t,r,i)}),e}function yn(o){let e=0;return o.EnumerateTriangleVertices((t,r,i)=>{e+=Oi(t,r,i)}),e}var Ne=class{constructor(e,t,r){this.eye=e,this.center=t,this.up=r}Clone(){return new Ne(this.eye.Clone(),this.center.Clone(),this.up.Clone())}};function hi(o,e){return ce(o.eye,e.eye)&&ce(o.center,e.center)&&ce(o.up,e.up)}var X={IntegerToString(o){return o.toString()},StringToInteger(o){return parseInt(o,10)},NumberToString(o){let e=5;return o.toPrecision(e)},StringToNumber(o){return parseFloat(o)},ModelUrlsToString:function(o){return o===null?null:o.join(",")},StringToModelUrls:function(o){return o===null||o.length===0?null:o.split(",")},CameraToString:function(o){return o===null?null:[this.NumberToString(o.eye.x),this.NumberToString(o.eye.y),this.NumberToString(o.eye.z),this.NumberToString(o.center.x),this.NumberToString(o.center.y),this.NumberToString(o.center.z),this.NumberToString(o.up.x),this.NumberToString(o.up.y),this.NumberToString(o.up.z)].join(",")},StringToCamera:function(o){if(o===null||o.length===0)return null;let e=o.split(",");return e.length!==9?null:new Ne(new M(this.StringToNumber(e[0]),this.StringToNumber(e[1]),this.StringToNumber(e[2])),new M(this.StringToNumber(e[3]),this.StringToNumber(e[4]),this.StringToNumber(e[5])),new M(this.StringToNumber(e[6]),this.StringToNumber(e[7]),this.StringToNumber(e[8])))},ColorToString:function(o){return o===null?null:[this.IntegerToString(o.r),this.IntegerToString(o.g),this.IntegerToString(o.b)].join(",")},StringToColor:function(o){if(o===null||o.length===0)return null;let e=o.split(",");return e.length!==3?null:new N(this.StringToInteger(e[0]),this.StringToInteger(e[1]),this.StringToInteger(e[2]))},EnvironmentSettingsToString(o){return o===null?null:[o.environmentMapName,o.backgroundIsEnvMap?"on":"off"].join(",")},StringToEnvironmentSettings:function(o){if(o===null||o.length===0)return null;let e=o.split(",");return e.length!==2?null:{environmentMapName:e[0],backgroundIsEnvMap:e[1]==="on"}},EdgeSettingsToString:function(o){return o===null?null:[o.showEdges?"on":"off",this.ColorToString(o.edgeColor),this.IntegerToString(o.edgeThreshold)].join(",")},StringToEdgeSettings:function(o){if(o===null||o.length===0)return null;let e=o.split(",");return e.length!==5?null:{showEdges:e[0]==="on",edgeColor:new N(this.StringToInteger(e[1]),this.StringToInteger(e[2]),this.StringToInteger(e[3])),edgeThreshold:this.StringToInteger(e[4])}}},fi=class{constructor(e){this.separator=e,this.paramList=""}AddModelUrls(e){return this.AddUrlPart("model",X.ModelUrlsToString(e)),this}AddCamera(e){return this.AddUrlPart("camera",X.CameraToString(e)),this}AddEnvironmentSettings(e){return this.AddUrlPart("envsettings",X.EnvironmentSettingsToString(e)),this}AddBackgroundColor(e){return this.AddUrlPart("backgroundcolor",X.ColorToString(e)),this}AddDefaultColor(e){return this.AddUrlPart("defaultcolor",X.ColorToString(e)),this}AddEdgeSettings(e){return this.AddUrlPart("edgesettings",X.EdgeSettingsToString(e)),this}AddUrlPart(e,t){e===null||t===null||(this.paramList.length>0&&(this.paramList+=this.separator),this.paramList+=e+"="+t)}GetParameterList(){return this.paramList}},di=class{constructor(e,t){this.separator=t,this.paramList=e}GetModelUrls(){if(this.paramList.indexOf("=")===-1)return this.paramList.split(",");let e=this.GetKeywordParams("model");return X.StringToModelUrls(e)}GetCamera(){let e=this.GetKeywordParams("camera");return X.StringToCamera(e)}GetEnvironmentSettings(){let e=this.GetKeywordParams("envsettings");return X.StringToEnvironmentSettings(e)}GetBackgroundColor(){let e=this.GetKeywordParams("backgroundcolor");return X.StringToColor(e)}GetDefaultColor(){let e=this.GetKeywordParams("defaultcolor");return X.StringToColor(e)}GetEdgeSettings(){let e=this.GetKeywordParams("edgesettings");return X.StringToEdgeSettings(e)}GetKeywordParams(e){if(this.paramList===null||this.paramList.length===0)return null;let t=e+"=",r=this.paramList.split(this.separator);for(let i=0;i<r.length;i++){let n=r[i];if(n.startsWith(t))return n.substring(t.length)}return null}};function Li(){return new fi("$")}function Mn(o){return new di(o,"$")}function In(o){let e=Li();return e.AddModelUrls(o),e.GetParameterList()}var Tr=class{constructor(){this.forceMediumpForMaterials=!1}},Er=class{constructor(){this.defaultMaterial=null}},mi=class{constructor(e){this.callbacks=e,this.texturesNeeded=0,this.texturesLoaded=0,this.threeObject=null}OnTextureNeeded(){this.texturesNeeded+=1}OnTextureLoaded(){this.texturesLoaded+=1,this.callbacks.onTextureLoaded(),this.Finish()}OnModelLoaded(e){this.threeObject=e,this.Finish()}Finish(){this.threeObject!==null&&this.texturesNeeded===this.texturesLoaded&&this.callbacks.onModelLoaded(this.threeObject)}},ci=class{constructor(e,t){this.meshInstances=[],this.AddNode(e,t)}AddNode(e,t){let r=e.GetTransformation().GetMatrix(),i=new THREE.Matrix4().fromArray(r.Get());t.applyMatrix4(i);for(let n of e.GetChildNodes()){let s=new THREE.Object3D;t.add(s),this.AddNode(n,s)}for(let n of e.GetMeshIndices())this.meshInstances.push({node:e,threeNode:t,meshIndex:n})}GetMeshInstances(){return this.meshInstances}};function pi(o,e,t,r){function i(d,c,p,m,g,x){function C(b,G){G.wrapS=THREE.RepeatWrapping,G.wrapT=THREE.RepeatWrapping,G.rotation=b.rotation,G.offset.x=b.offset.x,G.offset.y=b.offset.y,G.repeat.x=b.scale.x,G.repeat.y=b.scale.y}function E(b,G,O,R){if(O===null||!O.IsValid())return;let D=new THREE.TextureLoader;b.OnTextureNeeded(),D.load(O.url,V=>{C(O,V),G.needsUpdate=!0,R(V),b.OnTextureLoaded()},null,V=>{b.OnTextureLoaded()})}let T=c.GetMaterial(p),I=fe(T.color);T.vertexColors&&I.setRGB(1,1,1);let w={color:I,vertexColors:T.vertexColors,opacity:T.opacity,transparent:T.transparent,alphaTest:T.alphaTest,side:THREE.DoubleSide};g.forceMediumpForMaterials&&(w.precision="mediump");let y=null;if(m===se.Phong){if(y=new THREE.MeshPhongMaterial(w),T.type===$.Phong){let b=fe(T.specular);P(T.shininess,0)&&b.setRGB(0,0,0),y.specular=b,y.shininess=T.shininess*100,E(d,y,T.specularMap,G=>{y.specularMap=G})}}else m===se.Physical&&(y=new THREE.MeshStandardMaterial(w),T.type===$.Physical&&(y.metalness=T.metalness,y.roughness=T.roughness,E(d,y,T.metalnessMap,b=>{y.metalness=1,y.roughness=1,y.metalnessMap=b,y.roughnessMap=b})));let S=fe(T.emissive);return y.emissive=S,E(d,y,T.diffuseMap,b=>{T.multiplyDiffuseMap||y.color.setRGB(1,1,1),y.map=b}),E(d,y,T.bumpMap,b=>{y.bumpMap=b}),E(d,y,T.normalMap,b=>{y.normalMap=b}),E(d,y,T.emissiveMap,b=>{y.emissiveMap=b}),T.isDefault&&(x.defaultMaterial=y),y}function n(d,c,p){let m=d.GetMesh(c.meshIndex),g=m.TriangleCount(),x=[];for(let V=0;V<g;V++)x.push(V);x.sort((V,te)=>{let U=m.GetTriangle(V),me=m.GetTriangle(te);return U.mat-me.mat});let C=new THREE.BufferGeometry,E=[],T=[],I=new Map,w=[],y=[],S=[],b=[],G=[];G.push({start:0,end:-1});let O=m.VertexColorCount()>0,R=m.TextureUVCount()>0;for(let V=0;V<x.length;V++){let te=x[V],U=m.GetTriangle(te),me=m.GetVertex(U.v0),De=m.GetVertex(U.v1),vr=m.GetVertex(U.v2);if(w.push(me.x,me.y,me.z,De.x,De.y,De.z,vr.x,vr.y,vr.z),U.HasVertexColors()){let _=fe(m.GetVertexColor(U.c0)),ct=fe(m.GetVertexColor(U.c1)),pt=fe(m.GetVertexColor(U.c2));y.push(_.r,_.g,_.b,ct.r,ct.g,ct.b,pt.r,pt.g,pt.b)}else O&&y.push(0,0,0,0,0,0,0,0,0);let dt=m.GetNormal(U.n0),mt=m.GetNormal(U.n1),it=m.GetNormal(U.n2);if(S.push(dt.x,dt.y,dt.z,mt.x,mt.y,mt.z,it.x,it.y,it.z),U.HasTextureUVs()){let _=m.GetTextureUV(U.u0),ct=m.GetTextureUV(U.u1),pt=m.GetTextureUV(U.u2);b.push(_.x,_.y,ct.x,ct.y,pt.x,pt.y)}else R&&b.push(0,0,0,0,0,0);let Q=U.mat;I.has(Q)||(I.set(Q,E.length),E.push(p[Q]),T.push(Q),V>0&&(G[G.length-1].end=V-1,G.push({start:G[G.length-1].end+1,end:-1})))}G[G.length-1].end=g-1,C.setAttribute("position",new THREE.Float32BufferAttribute(w,3)),y.length!==0&&C.setAttribute("color",new THREE.Float32BufferAttribute(y,3)),C.setAttribute("normal",new THREE.Float32BufferAttribute(S,3)),b.length!==0&&C.setAttribute("uv",new THREE.Float32BufferAttribute(b,2));for(let V=0;V<G.length;V++){let te=G[V];C.addGroup(te.start*3,(te.end-te.start+1)*3,V)}let D=new THREE.Mesh(C,E);return D.userData={originalMeshId:c,originalMaterials:T,threeMaterials:null},D}function s(d,c,p,m){let g=c.GetMesh(p.meshIndex);if(et(g)===Le.TriangleMesh){let C=n(c,p,m);d.add(C)}}function l(d,c,p,m){let g=c.GetRootNode(),C=new ci(g,d).GetMeshInstances();Gr(C.length,100,{runTask:(E,T,I)=>{for(let w=E;w<=T;w++){let y=C[w],S=y.node,b=y.threeNode,G=new tt(S.GetId(),y.meshIndex);s(b,c,G,p)}I()},onReady:()=>{m.OnModelLoaded(d)}})}let a=new mi(r),u=ti(o),h=[];for(let d=0;d<o.MaterialCount();d++){let c=i(a,o,d,u,e,t);h.push(c)}let f=new THREE.Object3D;l(f,o,h,a)}var yr=class{constructor(){this.importer=new Cr,this.inProgress=!1,this.defaultMaterial=null,this.hasHighpDriverIssue=ei()}InProgress(){return this.inProgress}LoadModel(e,t,r,i){this.inProgress||(this.inProgress=!0,i.onLoadStart(),this.importer.ImportFiles(e,t,r,{onFilesLoaded:()=>{i.onImportStart()},onSelectMainFile:(n,s)=>{i.onSelectMainFile?i.onSelectMainFile(n,s):s(0)},onImportSuccess:n=>{i.onVisualizationStart();let s=new Tr;s.forceMediumpForMaterials=this.hasHighpDriverIssue;let l=new Er;pi(n.model,s,l,{onTextureLoaded:()=>{i.onTextureLoaded()},onModelLoaded:a=>{if(this.defaultMaterial=l.defaultMaterial,n.upVector===v.X){let u=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,0,1),Math.PI/2);a.quaternion.multiply(u)}else if(n.upVector===v.Z){let u=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);a.quaternion.multiply(u)}i.onModelFinished(n,a),this.inProgress=!1}})},onImportError:n=>{i.onLoadError(n),this.inProgress=!1}}))}GetImporter(){return this.importer}GetDefaultMaterial(){return this.defaultMaterial}ReplaceDefaultMaterialColor(e){this.defaultMaterial!==null&&!this.defaultMaterial.vertexColors&&(this.defaultMaterial.color=fe(e))}};function Z(o){return Math.round(parseFloat(o))}function gi(o){let e=Z(o.paddingLeft)+Z(o.paddingRight),t=Z(o.borderLeftWidth)+Z(o.borderRightWidth),r=Z(o.marginLeft)+Z(o.marginRight);return e+t+r}function xi(o){let e=Z(o.paddingTop)+Z(o.paddingBottom),t=Z(o.borderTopWidth)+Z(o.borderBottomWidth),r=Z(o.marginTop)+Z(o.marginBottom);return e+t+r}function Ci(o,e,t){let r=getComputedStyle(o),i=e-gi(r),n=t-xi(r);return{width:i,height:n}}function Je(o,e,t){if(o.getBoundingClientRect){let r=o.getBoundingClientRect();e-=r.left,t-=r.top}return window.pageXOffset&&window.pageYOffset&&(e+=window.pageXOffset,t+=window.pageYOffset),new F(e,t)}function Ti(o,e,t){let r=document.createElement(o);return e&&(r.className=e),t&&(r.innerHTML=t),r}function Ye(o,e,t,r){let i=Ti(e,t,r);return o.appendChild(i),i}function Mr(o,e,t){return Ye(o,"div",e,t)}function bn(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function wn(o,e){e.parentNode.insertBefore(o,e)}function Sn(o,e){e.parentNode.insertBefore(o,e.nextSibling)}function vn(o,e){e?o.style.display="block":o.style.display="none"}function An(o){return o.offsetParent!==null}function Ui(o,e){o.style.width=e.toString()+"px"}function zi(o,e){o.style.height=e.toString()+"px"}function Gn(o){let e=getComputedStyle(o);return o.offsetWidth+Z(e.marginLeft)+Z(e.marginRight)}function Rn(o){let e=getComputedStyle(o);return o.offsetHeight+Z(e.marginTop)+Z(e.marginBottom)}function Fn(o,e){let t=getComputedStyle(o);Ui(o,e-gi(t))}function Nn(o,e){let t=getComputedStyle(o);zi(o,e-xi(t))}function Dn(o,e,t,r,i){let n=Ye(o,"label");n.setAttribute("for",e);let s=Ye(n,"input","ov_checkbox");return s.setAttribute("type","checkbox"),s.setAttribute("id",e),s.checked=r,Ye(n,"span",null,t),i&&s.addEventListener("change",i),s}function Vn(o,e,t){let r=Ye(o,"input","ov_slider");return r.setAttribute("type","range"),r.setAttribute("min",e.toString()),r.setAttribute("max",t.toString()),r}function Pn(o,e,t,r){let i=Mr(o,"ov_select_container"),n=Ye(i,"select","ov_select");for(let s of e)Ye(n,"option",null,s);return n.selectedIndex=t,r&&n.addEventListener("change",()=>{r(n.selectedIndex)}),n}function On(o,e){function t(l,a){a?l.classList.add("on"):l.classList.remove("on")}let r=!1,i=null,n="ov_toggle";e&&(n+=" "+e);let s=Mr(o,n);return Mr(s,"ov_toggle_slider"),s.addEventListener("click",()=>{r=!r,t(s,r),i&&i()}),{element:s,GetStatus:()=>r,SetStatus:l=>{r=l,t(s,r)},OnChange:l=>{i=l}}}function Bn(o,e){return Ti("div",o,e)}var Ei=class{constructor(){this.prev=new F(0,0),this.curr=new F(0,0),this.diff=new F(0,0),this.buttons=[]}Down(e,t){this.buttons.push(t.which),this.curr=this.GetPositionFromEvent(e,t),this.prev=this.curr.Clone()}Move(e,t){this.curr=this.GetPositionFromEvent(e,t),this.diff=Lt(this.curr,this.prev),this.prev=this.curr.Clone()}Up(e,t){let r=this.buttons.indexOf(t.which);r!==-1&&this.buttons.splice(r,1),this.curr=this.GetPositionFromEvent(e,t)}Leave(e,t){this.buttons=[],this.curr=this.GetPositionFromEvent(e,t)}IsButtonDown(){return this.buttons.length>0}GetButton(){let e=this.buttons.length;return e===0?0:this.buttons[e-1]}GetPosition(){return this.curr}GetMoveDiff(){return this.diff}GetPositionFromEvent(e,t){return Je(e,t.clientX,t.clientY)}},yi=class{constructor(){this.prevPos=new F(0,0),this.currPos=new F(0,0),this.diffPos=new F(0,0),this.prevDist=0,this.currDist=0,this.diffDist=0,this.fingers=0}Start(e,t){t.touches.length!==0&&(this.fingers=t.touches.length,this.currPos=this.GetPositionFromEvent(e,t),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.prevDist=this.currDist)}Move(e,t){t.touches.length!==0&&(this.currPos=this.GetPositionFromEvent(e,t),this.diffPos=Lt(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)}End(e,t){t.touches.length!==0&&(this.fingers=0,this.currPos=this.GetPositionFromEvent(e,t),this.currDist=this.GetTouchDistanceFromEvent(e,t))}IsFingerDown(){return this.fingers!==0}GetFingerCount(){return this.fingers}GetPosition(){return this.currPos}GetMoveDiff(){return this.diffPos}GetDistanceDiff(){return this.diffDist}GetPositionFromEvent(e,t){let r=null;if(t.touches.length!==0){let i=t.touches[0];r=Je(e,i.pageX,i.pageY)}return r}GetTouchDistanceFromEvent(e,t){if(t.touches.length!==2)return 0;let r=t.touches[0],i=t.touches[1];return Ut(Je(e,r.pageX,r.pageY),Je(e,i.pageX,i.pageY))}},Mi=class{constructor(){this.isClick=!1,this.startPosition=null}Start(e){this.isClick=!0,this.startPosition=e}Move(e){!this.isClick||(this.startPosition!==null?Ut(this.startPosition,e)>3&&this.Cancel():this.Cancel())}End(){this.startPosition=null}Cancel(){this.isClick=!1,this.startPosition=null}IsClick(){return this.isClick}},le={None:0,Orbit:1,Pan:2,Zoom:3},Ir=class{constructor(e,t,r){this.canvas=e,this.camera=t,this.callbacks=r,this.fixUpVector=!0,this.mouse=new Ei,this.touch=new yi,this.clickDetector=new Mi,this.onMouseClick=null,this.onMouseMove=null,this.onContext=null,this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("wheel",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchcancel",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this))),document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))}SetMouseClickHandler(e){this.onMouseClick=e}SetMouseMoveHandler(e){this.onMouseMove=e}SetContextMenuHandler(e){this.onContext=e}IsFixUpVector(){return this.fixUpVector}SetFixUpVector(e){this.fixUpVector=e}GetCamera(){return this.camera}SetCamera(e){this.camera=e}MoveCamera(e,t){function r(i,n,s,l){i.camera.eye=n.eye[l],i.camera.center=n.center[l],i.camera.up=n.up[l],i.Update(),l<s-1&&requestAnimationFrame(()=>{r(i,n,s,l+1)})}if(e!==null){if(t===0||hi(this.camera,e))this.camera=e;else{let i=Yr,n={eye:St(this.camera.eye,e.eye,t,i),center:St(this.camera.center,e.center,t,i),up:St(this.camera.up,e.up,t,i)};requestAnimationFrame(()=>{r(this,n,t,0)})}this.Update()}}GetFitToSphereCamera(e,t,r){if(nt(t))return null;let i=this.camera.Clone(),n=ee(i.center,e);i.eye=ee(i.eye,n),i.center=e.Clone();let s=ee(i.eye,i.center).Normalize(),l=r/2;this.canvas.width<this.canvas.height&&(l=l*this.canvas.width/this.canvas.height);let a=t/Math.sin(l*Ke);return i.eye=i.center.Clone().Offset(s,a),i}OnMouseDown(e){e.preventDefault(),this.mouse.Down(this.canvas,e),this.clickDetector.Start(this.mouse.GetPosition())}OnMouseMove(e){if(this.mouse.Move(this.canvas,e),this.clickDetector.Move(this.mouse.GetPosition()),this.onMouseMove){let n=Je(this.canvas,e.clientX,e.clientY);this.onMouseMove(n)}if(!this.mouse.IsButtonDown())return;let t=this.mouse.GetMoveDiff(),r=this.mouse.GetButton(),i=le.None;if(r===1?e.ctrlKey?i=le.Zoom:e.shiftKey?i=le.Pan:i=le.Orbit:(r===2||r===3)&&(i=le.Pan),i===le.Orbit){let n=.5;this.Orbit(t.x*n,t.y*n)}else if(i===le.Pan){let n=pe(this.camera.eye,this.camera.center),s=.001*n;this.Pan(t.x*s,t.y*s)}else if(i===le.Zoom){let n=.005;this.Zoom(-t.y*n)}this.Update()}OnMouseUp(e){if(this.mouse.Up(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){let t=this.mouse.GetPosition();this.Click(e.which,t)}}OnMouseLeave(e){this.mouse.Leave(this.canvas,e),this.clickDetector.Cancel()}OnTouchStart(e){e.preventDefault(),this.touch.Start(this.canvas,e),this.clickDetector.Start(this.touch.GetPosition())}OnTouchMove(e){if(e.preventDefault(),this.touch.Move(this.canvas,e),this.clickDetector.Move(this.touch.GetPosition()),!this.touch.IsFingerDown())return;let t=this.touch.GetMoveDiff(),r=this.touch.GetDistanceDiff(),i=this.touch.GetFingerCount(),n=le.None;if(i===1?n=le.Orbit:i===2&&(n=le.Pan),n===le.Orbit){let s=.5;this.Orbit(t.x*s,t.y*s)}else if(n===le.Pan){let s=.005;this.Zoom(r*s);let l=.001*pe(this.camera.eye,this.camera.center);this.Pan(t.x*l,t.y*l)}this.Update()}OnTouchEnd(e){if(e.preventDefault(),this.touch.End(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){let t=this.touch.GetPosition();this.touch.GetFingerCount()===1&&this.Click(1,t)}}OnMouseWheel(e){let t=e||window.event;t.preventDefault();let r=-t.deltaY/40,i=.1;r<0&&(i=i*-1),this.Zoom(i),this.Update()}OnContextMenu(e){e.preventDefault(),this.clickDetector.IsClick()&&(this.Context(e.clientX,e.clientY),this.clickDetector.Cancel())}Orbit(e,t){let r=e*Ke,i=t*Ke,n=ee(this.camera.center,this.camera.eye).Normalize(),s=ve(n,this.camera.up).Normalize();if(this.fixUpVector){let a=zr(n,this.camera.up)+i;Pr(a,0)&&Ct(a,Math.PI)&&this.camera.eye.Rotate(s,-i,this.camera.center),this.camera.eye.Rotate(this.camera.up,-r,this.camera.center)}else{let l=ve(s,n).Normalize();this.camera.eye.Rotate(s,-i,this.camera.center),this.camera.eye.Rotate(l,-r,this.camera.center),this.camera.up=l}}Pan(e,t){let r=ee(this.camera.center,this.camera.eye).Normalize(),i=ve(r,this.camera.up).Normalize(),n=ve(i,r).Normalize();this.camera.eye.Offset(i,-e),this.camera.center.Offset(i,-e),this.camera.eye.Offset(n,t),this.camera.center.Offset(n,t)}Zoom(e){let t=ee(this.camera.center,this.camera.eye),i=t.Length()*e;this.camera.eye.Offset(t,i)}Update(){this.callbacks.onUpdate()}Click(e,t){this.onMouseClick&&this.onMouseClick(e,t)}Context(e,t){if(this.onContext){let r={x:e,y:t},i=Je(this.canvas,e,t);this.onContext(r,i)}}};function Ii(o,e){function t(r,i){for(let n of r)n.polygonOffset=i,n.polygonOffsetUnit=1,n.polygonOffsetFactor=1}t(o.material,e),o.userData.threeMaterials&&t(o.userData.threeMaterials,e)}var br=class{constructor(e){this.scene=e,this.mainObject=null,this.mainGridObject=null,this.mainEdgeObject=null,this.gridSettings={showGrid:!1},this.edgeSettings={showEdges:!1,edgeColor:new N(0,0,0),edgeThreshold:1}}SetMainObject(e){this.mainObject=e,this.scene.add(this.mainObject),this.gridSettings.showGrid&&this.GenerateMainGridObject(),this.edgeSettings.showEdges&&this.GenerateMainEdgeObject()}UpdateWorldMatrix(){this.mainObject!==null&&this.mainObject.updateWorldMatrix(!0,!0)}SetGridSettings(e){this.gridSettings.showGrid=e,this.mainObject!==null&&(this.gridSettings.showGrid?(this.ClearMainGridObject(),this.GenerateMainGridObject()):this.ClearMainGridObject())}SetEdgeSettings(e,t,r){let i=!1;if(e&&(!this.edgeSettings.showEdges||this.edgeSettings.edgeThreshold!==r)&&(i=!0),this.edgeSettings.showEdges=e,this.edgeSettings.edgeThreshold=r,this.edgeSettings.edgeColor=t,this.mainObject!==null)if(this.edgeSettings.showEdges)if(i)this.ClearMainEdgeObject(),this.GenerateMainEdgeObject();else{let n=fe(this.edgeSettings.edgeColor);this.EnumerateEdges(s=>{s.material.color=n})}else this.ClearMainEdgeObject()}GenerateMainGridObject(){function e(m,g,x){let C=[m,g],E=new THREE.BufferGeometry().setFromPoints(C);return new THREE.Line(E,x)}this.UpdateWorldMatrix();let t=this.GetBoundingBox(m=>!0);if(t===null)return;this.mainGridObject=new THREE.Object3D;let r=new THREE.LineBasicMaterial({color:8947848}),i=new THREE.LineBasicMaterial({color:14540253}),n=new THREE.Vector3;t.getSize(n);let s=1,l=new THREE.Vector2(t.min.z-s,t.min.x-s),a=new THREE.Vector2(t.max.z+s,t.max.x+s),u=1,h=new THREE.Vector2(Math.floor(l.x/u)*u,Math.floor(l.y/u)*u),f=new THREE.Vector2(Math.ceil(a.x/u)*u,Math.ceil(a.y/u)*u),d=t.min.y,c=Math.floor((f.x-h.x)/u),p=Math.floor((f.y-h.y)/u);for(let m=0;m<c+1;m++){let g=h.x+m*u,x=new THREE.Vector3(h.y,d,g),C=new THREE.Vector3(f.y,d,g),E=P(g,0)?r:i;this.mainGridObject.add(e(x,C,E))}for(let m=0;m<p+1;m++){let g=h.y+m*u,x=new THREE.Vector3(g,d,h.x),C=new THREE.Vector3(g,d,f.x),E=P(g,0)?r:i;this.mainGridObject.add(e(x,C,E))}this.scene.add(this.mainGridObject)}GenerateMainEdgeObject(){let e=fe(this.edgeSettings.edgeColor);this.mainEdgeObject=new THREE.Object3D,this.UpdateWorldMatrix(),this.EnumerateMeshes(t=>{Ii(t,!0);let r=new THREE.EdgesGeometry(t.geometry,this.edgeSettings.edgeThreshold),i=new THREE.LineSegments(r,new THREE.LineBasicMaterial({color:e}));i.applyMatrix4(t.matrixWorld),i.userData=t.userData,i.visible=t.visible,this.mainEdgeObject.add(i)}),this.scene.add(this.mainEdgeObject)}GetBoundingBox(e){let t=!1,r=new THREE.Box3;return this.EnumerateMeshes(i=>{e(i.userData)&&(r.union(new THREE.Box3().setFromObject(i)),t=!0)}),t?r:null}GetBoundingSphere(e){let t=this.GetBoundingBox(e);if(t===null)return null;let r=new THREE.Sphere;return t.getBoundingSphere(r),r}Clear(){this.ClearMainObject(),this.ClearMainGridObject(),this.ClearMainEdgeObject()}ClearMainObject(){this.mainObject!==null&&(this.EnumerateMeshes(e=>{e.geometry.dispose()}),this.scene.remove(this.mainObject),this.mainObject=null)}ClearMainGridObject(){this.mainGridObject!==null&&(this.mainGridObject.traverse(e=>{e.isLineSegments&&e.geometry.dispose()}),this.scene.remove(this.mainGridObject),this.mainGridObject=null)}ClearMainEdgeObject(){this.mainEdgeObject!==null&&(this.EnumerateMeshes(e=>{Ii(e,!1)}),this.EnumerateEdges(e=>{e.geometry.dispose()}),this.scene.remove(this.mainEdgeObject),this.mainEdgeObject=null)}EnumerateMeshes(e){this.mainObject!==null&&this.mainObject.traverse(t=>{t.isMesh&&e(t)})}EnumerateEdges(e){this.mainEdgeObject!==null&&this.mainEdgeObject.traverse(t=>{t.isLineSegments&&e(t)})}GetMeshIntersectionUnderMouse(e,t,r,i){if(this.mainObject===null)return null;let n=new THREE.Raycaster,s=new THREE.Vector2;s.x=e.x/r*2-1,s.y=-(e.y/i)*2+1,n.setFromCamera(s,t);let l=n.intersectObject(this.mainObject,!0);for(let a=0;a<l.length;a++){let u=l[a];if(u.object.type==="Mesh"&&u.object.visible)return u}return null}},wr=class{constructor(e){this.scene=e,this.mainObject=null}AddObject(e){this.mainObject===null&&(this.mainObject=new THREE.Object3D,this.scene.add(this.mainObject)),this.mainObject.add(e)}Clear(){this.mainObject!==null&&(this.mainObject.traverse(e=>{(e.isMesh||e.isLineSegments)&&e.geometry.dispose()}),this.scene.remove(this.mainObject),this.mainObject=null)}};function bi(o){return o===v.X?new Ne(new M(2,-3,1.5),new M(0,0,0),new M(1,0,0)):o===v.Y?new Ne(new M(-1.5,2,3),new M(0,0,0),new M(0,1,0)):o===v.Z?new Ne(new M(-1.5,-3,2),new M(0,0,0),new M(0,0,1)):null}function wi(o,e){if(!e(o))return!1;for(let t of o.children)if(!wi(t,e))return!1;return!0}function Hi(o){let e=null;return wi(o,t=>{if(t.isMesh)for(let r of t.material)return r.type==="MeshPhongMaterial"?e=se.Phong:r.type==="MeshStandardMaterial"&&(e=se.Physical),!1;return!0}),e}var Si=class{constructor(){this.direction=v.Z,this.isFixed=!0,this.isFlipped=!1}SetDirection(e,t){this.direction=e,this.isFlipped=!1;let r=bi(this.direction),i=ee(r.eye,r.center),n=pe(t.center,t.eye),s=t.center.Clone().Offset(i,n),l=t.Clone();return this.direction===v.X?(l.up=new M(1,0,0),l.eye=s):this.direction===v.Y?(l.up=new M(0,1,0),l.eye=s):this.direction===v.Z&&(l.up=new M(0,0,1),l.eye=s),l}SetFixed(e,t){return this.isFixed=e,this.isFixed?this.SetDirection(this.direction,t):null}Flip(e){this.isFlipped=!this.isFlipped;let t=e.Clone();return t.up.MultiplyScalar(-1),t}},vi=class{constructor(e){this.scene=e,this.type=se.Phong,this.ambientLight=new THREE.AmbientLight(8947848),this.directionalLight=new THREE.DirectionalLight(8947848),this.environment=null,this.backgroundIsEnvMap=!1,this.scene.add(this.ambientLight),this.scene.add(this.directionalLight)}SetType(e){this.type=e,this.UpdateShading()}UpdateShading(){this.type===se.Phong?(this.ambientLight.color.set(8947848),this.directionalLight.color.set(8947848),this.scene.environment=null,this.scene.background=null):this.type===se.Physical&&(this.ambientLight.color.set(0),this.directionalLight.color.set(5592405),this.scene.environment=this.environment,this.backgroundIsEnvMap?this.scene.background=this.environment:this.scene.background=null)}SetEnvironment(e,t,r){let i=new THREE.CubeTextureLoader;this.environment=i.load(e,()=>{r()}),this.backgroundIsEnvMap=t}UpdateByCamera(e){let t=ee(e.eye,e.center);this.directionalLight.position.set(t.x,t.y,t.z)}CreateHighlightMaterial(e,t){let r=null;return this.type===se.Phong?r=new THREE.MeshPhongMaterial({color:e,side:THREE.DoubleSide}):this.type===se.Physical&&(r=new THREE.MeshStandardMaterial({color:e,side:THREE.DoubleSide})),r!==null&&t&&(r.polygonOffset=!0,r.polygonOffsetUnit=1,r.polygonOffsetFactor=1),r}},Sr=class{constructor(){this.canvas=null,this.renderer=null,this.scene=null,this.geometry=null,this.extraGeometry=null,this.camera=null,this.shading=null,this.navigation=null,this.upVector=null,this.settings={animationSteps:40}}Init(e){this.canvas=e,this.canvas.id="viewer";let t={canvas:this.canvas,antialias:!0};this.renderer=new THREE.WebGLRenderer(t),window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor("#ffffff",1),this.renderer.setSize(this.canvas.width,this.canvas.height),this.scene=new THREE.Scene,this.geometry=new br(this.scene),this.extraGeometry=new wr(this.scene),this.InitNavigation(),this.InitShading(),this.Render()}SetMouseClickHandler(e){this.navigation.SetMouseClickHandler(e)}SetMouseMoveHandler(e){this.navigation.SetMouseMoveHandler(e)}SetContextMenuHandler(e){this.navigation.SetContextMenuHandler(e)}SetEnvironmentMapSettings(e,t){this.shading.SetEnvironment(e,t,()=>{this.Render()}),this.shading.UpdateShading(),this.Render()}SetBackgroundColor(e){let t="#"+Or(e);this.renderer.setClearColor(t,1),this.Render()}SetGridSettings(e){this.geometry.SetGridSettings(e),this.Render()}SetEdgeSettings(e,t,r){this.geometry.SetEdgeSettings(e,t,r),this.Render()}GetCanvas(){return this.canvas}GetCamera(){return this.navigation.GetCamera()}SetCamera(e){this.navigation.SetCamera(e),this.Render()}Resize(e,t){let r=Ci(this.canvas,e,t);this.ResizeRenderer(r.width,r.height)}ResizeRenderer(e,t){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.Render()}FitSphereToWindow(e,t){if(e===null)return;let r=new M(e.center.x,e.center.y,e.center.z),i=e.radius,n=this.camera.fov,s=this.navigation.GetFitToSphereCamera(r,i,n);this.navigation.MoveCamera(s,t?this.settings.animationSteps:0)}AdjustClippingPlanesToSphere(e){e!==null&&(e.radius<10?(this.camera.near=.01,this.camera.far=100):e.radius<100?(this.camera.near=.1,this.camera.far=1e3):e.radius<1e3?(this.camera.near=10,this.camera.far=1e4):(this.camera.near=100,this.camera.far=1e6),this.camera.updateProjectionMatrix(),this.Render())}IsFixUpVector(){return this.navigation.IsFixUpVector()}SetFixUpVector(e){let t=this.navigation.GetCamera(),r=this.upVector.SetFixed(e,t);this.navigation.SetFixUpVector(e),r!==null&&this.navigation.MoveCamera(r,this.settings.animationSteps),this.Render()}SetUpVector(e,t){let r=this.navigation.GetCamera(),i=this.upVector.SetDirection(e,r),n=t?this.settings.animationSteps:0;this.navigation.MoveCamera(i,n),this.Render()}FlipUpVector(){let e=this.navigation.GetCamera(),t=this.upVector.Flip(e);this.navigation.MoveCamera(t,0),this.Render()}Render(){let e=this.navigation.GetCamera();this.camera.position.set(e.eye.x,e.eye.y,e.eye.z),this.camera.up.set(e.up.x,e.up.y,e.up.z),this.camera.lookAt(new THREE.Vector3(e.center.x,e.center.y,e.center.z)),this.shading.UpdateByCamera(e),this.renderer.render(this.scene,this.camera)}SetMainObject(e){let t=Hi(e);this.geometry.SetMainObject(e),this.shading.SetType(t),this.Render()}AddExtraObject(e){this.extraGeometry.AddObject(e),this.Render()}Clear(){this.geometry.Clear(),this.extraGeometry.Clear(),this.Render()}ClearExtra(){this.extraGeometry.Clear(),this.Render()}SetMeshesVisibility(e){this.geometry.EnumerateMeshes(t=>{let r=e(t.userData);t.visible!==r&&(t.visible=r)}),this.geometry.EnumerateEdges(t=>{let r=e(t.userData);t.visible!==r&&(t.visible=r)}),this.Render()}SetMeshesHighlight(e,t){function r(n,s){let l=[];for(let a=0;a<n.length;a++)l.push(s);return l}let i=this.CreateHighlightMaterial(e);this.geometry.EnumerateMeshes(n=>{t(n.userData)?n.userData.threeMaterials===null&&(n.userData.threeMaterials=n.material,n.material=r(n.material,i)):n.userData.threeMaterials!==null&&(n.material=n.userData.threeMaterials,n.userData.threeMaterials=null)}),this.Render()}CreateHighlightMaterial(e){let t=this.geometry.edgeSettings.showEdges;return this.shading.CreateHighlightMaterial(e,t)}GetMeshUserDataUnderMouse(e){let t=this.GetMeshIntersectionUnderMouse(e);return t===null?null:t.object.userData}GetMeshIntersectionUnderMouse(e){let t=this.GetCanvasSize(),r=this.geometry.GetMeshIntersectionUnderMouse(e,this.camera,t.width,t.height);return r===null?null:r}GetBoundingBox(e){return this.geometry.GetBoundingBox(e)}GetBoundingSphere(e){return this.geometry.GetBoundingSphere(e)}EnumerateMeshesUserData(e){this.geometry.EnumerateMeshes(t=>{e(t.userData)})}InitNavigation(){this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1e3),this.scene.add(this.camera);let e=this.renderer.domElement,t=bi(v.Z);this.navigation=new Ir(e,t,{onUpdate:()=>{this.Render()}}),this.upVector=new Si}InitShading(){this.shading=new vi(this.scene)}GetShadingType(){return this.shading.type}GetImageSize(){let e=new THREE.Vector2;return this.renderer.getSize(e),{width:parseInt(e.x,10),height:parseInt(e.y,10)}}GetCanvasSize(){let e=this.canvas.width,t=this.canvas.height;return window.devicePixelRatio&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),{width:e,height:t}}GetImageAsDataUrl(e,t){let r=this.GetImageSize(),i=e,n=t;window.devicePixelRatio&&(i/=window.devicePixelRatio,n/=window.devicePixelRatio),this.ResizeRenderer(i,n),this.Render();let s=this.renderer.domElement.toDataURL();return this.ResizeRenderer(r.width,r.height),s}};var Ai=class{constructor(e,t){this.parentElement=e,this.parameters={},gt(t)&&(this.parameters=t),this.canvas=document.createElement("canvas"),this.parentElement.appendChild(this.canvas),this.viewer=new Sr,this.viewer.Init(this.canvas);let r=this.parentElement.clientWidth,i=this.parentElement.clientHeight;if(this.viewer.Resize(r,i),this.parameters.backgroundColor&&this.viewer.SetBackgroundColor(this.parameters.backgroundColor),this.parameters.edgeSettings&&this.viewer.SetEdgeSettings(this.parameters.edgeSettings.showEdges,this.parameters.edgeSettings.edgeColor,this.parameters.edgeSettings.edgeThreshold),this.parameters.environmentSettings){let n=this.parameters.environmentSettings.environmentMap,s=this.parameters.environmentSettings.backgroundIsEnvMap;this.viewer.SetEnvironmentMapSettings(n,s)}window.addEventListener("resize",()=>{this.Resize()})}LoadModelFromUrls(e){if(this.viewer.Clear(),e===null||e.length===0)return null;Vr(e);let t=new xr;this.parameters.defaultColor&&(t.defaultColor=this.parameters.defaultColor);let r=null;new yr().LoadModel(e,Y.Url,t,{onLoadStart:()=>{this.canvas.style.display="none",r=document.createElement("div"),r.innerHTML="Loading model...",this.parentElement.appendChild(r)},onImportStart:()=>{r.innerHTML="Importing model..."},onVisualizationStart:()=>{r.innerHTML="Visualizing model..."},onModelFinished:(n,s)=>{this.parentElement.removeChild(r),this.canvas.style.display="inherit",this.viewer.SetMainObject(s);let l=this.viewer.GetBoundingSphere(a=>!0);this.viewer.AdjustClippingPlanesToSphere(l),this.parameters.camera?this.viewer.SetCamera(this.parameters.camera):this.viewer.SetUpVector(v.Y,!1),this.viewer.FitSphereToWindow(l,!1)},onTextureLoaded:()=>{this.viewer.Render()},onLoadError:n=>{let s="Unknown error";n.code===He.NoImportableFile?s="No importable file found":n.code===He.FailedToLoadFile?s="Failed to load file for import.":n.code===He.ImportFailed&&(s="Failed to import model."),n.message!==null&&(s+=" ("+n.message+")"),r.innerHTML=s}})}GetViewer(){return this.viewer}Resize(){let e=this.parentElement.clientWidth,t=this.parentElement.clientHeight;this.viewer.Resize(e,t)}};function _i(o,e,t){let r=new Ai(o,t);return r.LoadModelFromUrls(e),r}function Ln(o){function e(r){let i=null,n=r.getAttribute("camera");n&&(i=X.StringToCamera(n));let s=null,l=r.getAttribute("backgroundcolor");l&&(s=X.StringToColor(l));let a=null,u=r.getAttribute("defaultcolor");u&&(a=X.StringToColor(u));let h=null,f=r.getAttribute("edgesettings");f&&(h=X.StringToEdgeSettings(f));let d=null,c=r.getAttribute("environmentmap");if(c){let g=c.split(",");if(g.length===6){let x=!1,C=r.getAttribute("environmentmapbg");C&&C==="true"&&(x=!0),d={environmentMap:g,backgroundIsEnvMap:x}}}let p=null,m=r.getAttribute("model");return m&&(p=X.StringToModelUrls(m)),_i(r,p,{camera:i,backgroundColor:s,defaultColor:a,edgeSettings:h,environmentSettings:d})}let t=[];window.addEventListener("load",()=>{let r=document.getElementsByClassName("online_3d_viewer");for(let i=0;i<r.length;i++){let n=r[i],s=e(n);t.push(s)}o!=null&&o(t)})}var ki=class{constructor(){this.viewer=null,this.highlightColor=null,this.isActive=!1,this.markers=[]}Init(e,t){this.viewer=e,this.highlightColor=t}IsActive(){return this.isActive}SetActive(e){this.isActive=e,this.isActive||this.Clear()}Click(e){let t=this.viewer.GetMeshIntersectionUnderMouse(e);if(t===null){this.Clear();return}this.markers.length===2&&this.Clear(),this.AddMarker(t)}GetMarkerCount(){return this.markers.length}AddMarker(e){this.markers.push(e),this.GenerateMarker(e)}Calculate(){if(this.markers.length!==2)return null;let e=this.markers[0],t=this.markers[1],r={pointsDistance:null,parallelFacesDistance:null,facesAngle:null},i=this.GetFaceWorldNormal(e),n=this.GetFaceWorldNormal(t);if(r.pointsDistance=e.point.distanceTo(t.point),r.facesAngle=i.angleTo(n),Bt(r.facesAngle,0,1e-4)||Bt(r.facesAngle,Math.PI,1e-4)){let s=new THREE.Plane().setFromNormalAndCoplanarPoint(i,e.point);r.parallelFacesDistance=Math.abs(s.distanceToPoint(t.point))}return r}Clear(){this.viewer.ClearExtra(),this.markers=[]}GenerateMarker(e){let r=this.viewer.GetBoundingSphere(u=>!0).radius/5,i=r/2,n=new THREE.ConeGeometry(i,r,32);n.translate(0,-r/2,0),n.rotateX(-Math.PI/2);let s=this.viewer.CreateHighlightMaterial(this.highlightColor);s.opacity=.6,s.transparent=!0;let l=new THREE.Mesh(n,s),a=this.GetFaceWorldNormal(e);l.lookAt(a),l.position.set(e.point.x,e.point.y,e.point.z),this.viewer.AddExtraObject(l)}GetFaceWorldNormal(e){let t=new THREE.Matrix4;e.object.updateWorldMatrix(!0,!1),t.extractRotation(e.object.matrixWorld);let r=e.face.normal.clone();return r.applyMatrix4(t),r}};return Wn(Xn);})();
